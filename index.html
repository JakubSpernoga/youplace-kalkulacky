<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>YouPlace - Stavební kalkulačky</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { 
      --gold: #c9a270; 
      --gold-light: #e8d4bc; 
      --gold-dark: #b8956a; 
      --gold-glow: rgba(201,162,112,0.15);
      --bg: #fff; 
      --text: #1a1a1a; 
      --g50: #fafafa;
      --g100: #f5f5f5; 
      --g200: #e5e5e5; 
      --g300: #d4d4d4; 
      --g400: #a3a3a3; 
      --g500: #737373; 
      --g600: #525252; 
    }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--g100); min-height: 100vh; }
    .app-container { max-width: 500px; margin: 0 auto; min-height: 100vh; background: var(--bg); display: flex; flex-direction: column; }
    @media (min-width: 500px) { body { display: flex; align-items: center; justify-content: center; padding: 20px; } .app-container { min-height: auto; height: 90vh; max-height: 900px; border-radius: 24px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); border: 1px solid var(--g200); overflow: hidden; } }
    .logo-section { text-align: center; padding: 60px 20px 0; }
    .logo { font-size: 28px; letter-spacing: -1px; }
    .logo-you { font-weight: 300; color: var(--text); }
    .logo-amp { font-weight: 700; color: var(--gold); }
    .logo-place { font-weight: 700; color: var(--text); }
    .logo-sub { font-size: 10px; color: var(--g400); text-transform: uppercase; letter-spacing: 2px; margin-top: 8px; }
    .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 20px 20px; flex: 1; align-content: center; }
    .menu-item { border: 1px solid var(--g200); border-radius: 14px; padding: 20px 12px; text-align: center; cursor: pointer; background: var(--bg); transition: all 0.2s ease; }
    .menu-item:active { transform: scale(0.97); background: var(--g100); }
    .menu-item.active { border-color: var(--gold); border-width: 2px; background: linear-gradient(135deg, rgba(232,212,188,0.15), rgba(184,149,106,0.08)); }
    .menu-item.disabled { opacity: 0.5; pointer-events: none; }
    .menu-icon { margin-bottom: 10px; display: flex; justify-content: center; }
    .menu-icon svg { width: 28px; height: 28px; stroke: var(--gold-dark); stroke-width: 1.5; fill: none; }
    .menu-label { font-size: 13px; font-weight: 600; color: var(--text); }
    .menu-desc { font-size: 11px; color: var(--g500); margin-top: 4px; }
    .header { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--g200); flex-shrink: 0; background: linear-gradient(135deg, rgba(232,212,188,0.1), rgba(184,149,106,0.05)); }
    .back-btn { width: 36px; height: 36px; border-radius: 50%; background: var(--bg); border: 1px solid var(--g200); display: flex; align-items: center; justify-content: center; cursor: pointer; margin-right: 12px; }
    .back-btn svg { width: 18px; height: 18px; stroke: var(--gold-dark); stroke-width: 2; fill: none; }
    .header-title { font-size: 18px; font-weight: 600; color: var(--text); }
    .content { flex: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
    .tabs { display: flex; gap: 8px; margin-bottom: 16px; }
    .tab { flex: 1; padding: 12px; border: 1px solid var(--g200); border-radius: 12px; font-size: 12px; font-weight: 500; background: var(--bg); cursor: pointer; text-align: center; color: var(--g500); font-family: inherit; transition: all 0.2s; }
    .tab.active { background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); color: #fff; border-color: var(--gold); }
    .card { background: var(--bg); border: 1px solid var(--g200); border-radius: 16px; padding: 16px; margin-bottom: 16px; }
    .card-title { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--gold-dark); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
    .card-title::before { content: ''; width: 3px; height: 14px; background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); border-radius: 2px; }
    .form-group { margin-bottom: 12px; }
    .form-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--g500); margin-bottom: 6px; display: block; }
    .form-input, .form-select { width: 100%; padding: 12px 14px; border: 1px solid var(--g300); border-radius: 12px; font-size: 15px; font-family: inherit; outline: none; background: var(--bg); transition: all 0.2s; }
    .form-input:focus, .form-select:focus { border-color: var(--gold); box-shadow: 0 0 0 3px var(--gold-glow); }
    .form-input.large { font-size: 18px; font-weight: 600; text-align: center; padding: 14px 16px; }
    .section-title { font-size: 10px; font-weight: 600; color: var(--gold-dark); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 10px; margin-top: 8px; display: flex; align-items: center; gap: 8px; }
    .section-title::after { content: ''; flex: 1; height: 1px; background: var(--g200); }
    .option { display: flex; align-items: flex-start; padding: 12px 14px; border: 1px solid var(--g200); border-radius: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s ease; }
    .option:active { background: var(--g100); }
    .option.active { border-color: var(--gold); border-width: 2px; background: linear-gradient(135deg, rgba(232,212,188,0.1), rgba(184,149,106,0.05)); }
    .option-dot { width: 20px; height: 20px; border-radius: 50%; border: 2px solid var(--g300); margin-right: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; transition: all 0.2s; }
    .option.active .option-dot { border-color: var(--gold); background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); }
    .option-dot svg { width: 12px; height: 12px; stroke: #fff; stroke-width: 3; fill: none; display: none; }
    .option.active .option-dot svg { display: block; }
    .option-text { flex: 1; min-width: 0; }
    .option-title { font-size: 13px; font-weight: 500; color: var(--text); display: flex; align-items: center; flex-wrap: wrap; gap: 4px; }
    .option-desc { font-size: 11px; color: var(--g500); margin-top: 2px; }
    .option-meta { display: flex; gap: 6px; align-items: center; flex-shrink: 0; margin-left: 8px; }
    .badge { font-size: 9px; font-weight: 600; padding: 4px 8px; border-radius: 8px; background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); color: #fff; }
    .badge-blue { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
    .badge-green { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
    .badge-yellow { background: rgba(234, 179, 8, 0.2); color: #ca8a04; }
    .option-vrstvy { font-size: 11px; color: var(--g400); }
    .toggle-btns { display: flex; gap: 8px; margin-bottom: 12px; }
    .toggle-btn { flex: 1; padding: 10px; border: 1px solid var(--g200); border-radius: 10px; font-size: 12px; font-weight: 500; background: var(--bg); cursor: pointer; text-align: center; color: var(--g500); font-family: inherit; transition: all 0.2s; }
    .toggle-btn.active { background: linear-gradient(135deg, rgba(232,212,188,0.3), rgba(184,149,106,0.15)); color: var(--gold-dark); border-color: var(--gold); font-weight: 600; }
    .result { background: linear-gradient(135deg, rgba(232,212,188,0.15), rgba(184,149,106,0.08)); border: 1px solid var(--gold-light); border-radius: 16px; padding: 16px; margin-top: 16px; }
    .result-item { display: flex; justify-content: space-between; align-items: flex-start; padding: 12px; background: var(--bg); border-radius: 10px; margin-bottom: 8px; border: 1px solid var(--g100); }
    .result-item-info { flex: 1; min-width: 0; }
    .result-item-name { font-size: 13px; font-weight: 500; color: var(--text); display: flex; align-items: center; flex-wrap: wrap; gap: 4px; }
    .result-item-detail { font-size: 11px; color: var(--g500); margin-top: 4px; }
    .result-item-schnuti { font-size: 10px; color: var(--g400); margin-top: 4px; }
    .result-item-badges { display: flex; gap: 4px; margin-top: 6px; flex-wrap: wrap; }
    .result-item-badges .badge { font-size: 8px; padding: 3px 6px; }
    .result-item-price { font-size: 15px; font-weight: 600; color: var(--gold-dark); margin-left: 12px; white-space: nowrap; }
    .result-total { display: flex; justify-content: space-between; align-items: center; padding: 16px; background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); border-radius: 12px; margin-top: 12px; }
    .result-total-label { font-size: 14px; font-weight: 600; color: #fff; }
    .result-total-value { font-size: 24px; font-weight: 700; color: #fff; }
    .result-per-m2 { text-align: center; font-size: 12px; color: var(--g500); margin-top: 8px; }
    .detail-panel { background: var(--g100); border-radius: 12px; padding: 14px; margin-top: 12px; }
    .detail-panel-title { font-size: 11px; font-weight: 600; color: var(--g500); text-transform: uppercase; margin-bottom: 10px; }
    .detail-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--g200); font-size: 12px; gap: 12px; }
    .detail-row:last-child { border-bottom: none; }
    .detail-label { color: var(--g500); flex-shrink: 0; }
    .detail-value { color: var(--text); text-align: right; }
    .detail-warning { margin-top: 10px; padding: 10px; background: rgba(201, 162, 112, 0.1); border: 1px solid var(--gold-light); border-radius: 8px; font-size: 11px; color: var(--gold-dark); }
    .reserve-row { display: flex; align-items: center; gap: 10px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--g200); }
    .reserve-label { font-size: 12px; color: var(--g500); }
    .reserve-select { padding: 6px 10px; border: 1px solid var(--g300); border-radius: 8px; font-size: 12px; font-family: inherit; background: var(--bg); }
    .home-indicator { display: flex; justify-content: center; padding: 12px 0 20px; flex-shrink: 0; }
    .home-indicator-bar { width: 100px; height: 4px; background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); border-radius: 2px; }
    .page { display: none; flex-direction: column; flex: 1; overflow: hidden; }
    .page.active { display: flex; }
    .podklady-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .podklad-item { padding: 10px; border: 1px solid var(--g200); border-radius: 10px; text-align: center; cursor: pointer; font-size: 12px; transition: all 0.2s; }
    .podklad-item.active { border-color: var(--gold); border-width: 2px; background: linear-gradient(135deg, rgba(232,212,188,0.15), rgba(184,149,106,0.08)); }
    .podklad-item-name { font-weight: 500; color: var(--text); }
    .podklad-item-note { font-size: 10px; color: var(--gold-dark); margin-top: 2px; }
    .info-box { background: linear-gradient(135deg, rgba(232,212,188,0.15), rgba(184,149,106,0.08)); border: 1px solid var(--gold-light); border-radius: 10px; padding: 10px 12px; font-size: 11px; color: var(--gold-dark); margin-top: 8px; }
    .checkbox-label { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text); cursor: pointer; padding: 8px 0; }
    .checkbox-label input[type="checkbox"] { width: 20px; height: 20px; accent-color: var(--gold); cursor: pointer; }
    .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 16px; }
    .summary-box { background: linear-gradient(135deg, rgba(232,212,188,0.2), rgba(184,149,106,0.1)); border: 1px solid var(--gold-light); padding: 10px 8px; border-radius: 12px; text-align: center; }
    .summary-box-label { font-size: 9px; color: var(--gold-dark); text-transform: uppercase; letter-spacing: 0.5px; }
    .summary-box-value { font-size: 14px; font-weight: 700; color: var(--gold-dark); margin-top: 2px; }
    .flow-steps { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
    .flow-step { background: linear-gradient(135deg, rgba(232,212,188,0.3), rgba(184,149,106,0.15)); color: var(--gold-dark); padding: 6px 10px; border-radius: 8px; font-size: 10px; font-weight: 500; }
    .flow-arrow { color: var(--g300); font-size: 12px; }
    .footer-note { text-align: center; font-size: 11px; color: var(--g400); margin-top: 16px; padding-bottom: 20px; }
    .mistnost-card { background: var(--bg); border: 1px solid var(--g200); border-radius: 12px; padding: 12px; margin-bottom: 10px; border-left: 4px solid var(--gold); }
    .mistnost-card.vlhka { border-left-color: #3b82f6; }
    .mistnost-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .mistnost-name { font-weight: 500; font-size: 13px; color: var(--text); border: none; background: transparent; width: 120px; }
    .mistnost-remove { font-size: 18px; color: var(--g400); background: none; border: none; cursor: pointer; padding: 0 4px; }
    .mistnost-remove:hover { color: var(--gold-dark); }
    .mistnost-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; }
    .mistnost-input { display: flex; justify-content: space-between; align-items: center; font-size: 10px; }
    .mistnost-input span { color: var(--g500); }
    .mistnost-input input { width: 36px; padding: 3px; font-size: 11px; text-align: center; border: 1px solid var(--g200); border-radius: 4px; }
    .special-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .special-item { padding: 10px; border: 1px solid var(--g200); border-radius: 10px; cursor: pointer; transition: all 0.2s; }
    .special-item.active { border-color: var(--gold); background: linear-gradient(135deg, rgba(232,212,188,0.15), rgba(184,149,106,0.08)); }
    .special-item-name { font-size: 11px; font-weight: 500; color: var(--text); }
    .special-item.active .special-item-name { color: var(--gold-dark); }
    .special-item-detail { font-size: 10px; color: var(--g400); margin-top: 2px; }
    .special-item-check { width: 14px; height: 14px; border-radius: 4px; border: 1px solid var(--g300); float: right; }
    .special-item.active .special-item-check { background: linear-gradient(135deg, var(--gold-light), var(--gold-dark)); border-color: var(--gold); }
    .info-tooltip { position: relative; display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; border-radius: 50%; background: var(--g300); color: var(--g600); font-size: 11px; font-weight: 600; cursor: help; flex-shrink: 0; }
    .info-tooltip:hover .info-tooltip-content, .info-tooltip:focus .info-tooltip-content { display: block; }
    .info-tooltip-content { display: none; position: absolute; z-index: 1000; left: 0; top: 100%; margin-top: 8px; width: 250px; max-width: calc(100vw - 60px); padding: 12px; background: var(--g600); color: #fff; border-radius: 10px; font-size: 12px; font-weight: 400; line-height: 1.5; box-shadow: 0 4px 20px rgba(0,0,0,0.3); text-align: left; }
    .info-tooltip-content::before { content: ''; position: absolute; bottom: 100%; left: 12px; border: 8px solid transparent; border-bottom-color: var(--g600); }
    .vyvod-btn { padding: 6px 10px; border: 1px solid var(--g300); border-radius: 8px; background: var(--bg); color: var(--g500); font-size: 11px; font-weight: 500; cursor: pointer; font-family: inherit; transition: all 0.2s; }
    .vyvod-btn:hover { border-color: var(--gold); color: var(--gold-dark); }
    .vyvod-card { background: var(--bg); border: 1px solid var(--g200); border-radius: 10px; padding: 10px; margin-bottom: 8px; }
    .vyvod-card.sv-tv { border-left: 3px solid #3b82f6; }
    .vyvod-card.sv-only { border-left: 3px solid #22c55e; }
    .vyvod-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .vyvod-name { font-size: 12px; font-weight: 500; color: var(--text); flex: 1; border: none; background: transparent; }
    .vyvod-typ { font-size: 10px; color: var(--g400); margin-right: 8px; }
    .vyvod-inputs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
    .vyvod-input { display: flex; flex-direction: column; }
    .vyvod-input label { font-size: 9px; color: var(--g400); margin-bottom: 2px; }
    .vyvod-input input { padding: 5px; border: 1px solid var(--g200); border-radius: 6px; font-size: 11px; text-align: center; width: 100%; }
    .vyvod-input input:disabled { background: var(--g100); color: var(--g400); }
    .klima-orient { padding: 8px; border: 1px solid var(--g300); border-radius: 8px; background: var(--bg); color: var(--g500); font-size: 12px; font-weight: 500; cursor: pointer; font-family: inherit; transition: all 0.2s; }
    .klima-orient:hover { border-color: #06b6d4; }
    .klima-orient.active { background: #06b6d4; border-color: #06b6d4; color: #fff; }
    .klima-mistnost { background: var(--bg); border: 1px solid var(--g200); border-radius: 10px; padding: 10px; margin-bottom: 8px; border-left: 3px solid #06b6d4; }
    .klima-jednotka { background: var(--g50); border: 1px solid var(--g200); border-radius: 10px; padding: 12px; margin-bottom: 8px; }
    .klima-jednotka.doporucena { border-color: #06b6d4; background: linear-gradient(135deg, rgba(6,182,212,0.08), rgba(59,130,246,0.05)); }
    .klima-jednotka-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .klima-jednotka-name { font-weight: 600; font-size: 12px; color: var(--text); }
    .klima-jednotka-badge { padding: 3px 8px; background: #06b6d4; border-radius: 4px; font-size: 9px; font-weight: 600; color: #fff; }
    .klima-jednotka-specs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
    .klima-spec { background: var(--bg); padding: 6px; border-radius: 6px; text-align: center; }
    .klima-spec-label { font-size: 9px; color: var(--g400); }
    .klima-spec-value { font-size: 11px; font-weight: 600; color: var(--text); }
    .klima-jednotka-cena { text-align: right; margin-top: 8px; font-size: 13px; font-weight: 600; color: #06b6d4; }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- MENU PAGE -->
    <div id="menuPage" class="page active">
      <div class="logo-section">
        <div class="logo"><span class="logo-you">You</span><span class="logo-amp">&</span><span class="logo-place">Place</span></div>
        <div class="logo-sub">Stavební kalkulačky</div>
      </div>
      <div class="menu-grid">
        <div class="menu-item" onclick="showPage('barvyPage')">
          <div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/><path d="M12 10v6"/><path d="M8 22c0-2 1-3 4-3s4 1 4 3"/><circle cx="12" cy="16" r="2"/></svg></div>
          <div class="menu-label">Barvy</div>
          <div class="menu-desc">Kov, stěny, dřevo</div>
        </div>
        <div class="menu-item" onclick="showPage('podlahyPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg></div><div class="menu-label">Podlahy</div><div class="menu-desc">Vinyl Arbiton</div></div>
        <div class="menu-item" onclick="showPage('eticsPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><rect x="8" y="3" width="8" height="18" rx="1"/><path d="M4 7c2 0 3 1 3 2s-1 2-3 2"/><path d="M4 13c2 0 3 1 3 2s-1 2-3 2"/><path d="M20 7c-2 0-3 1-3 2s1 2 3 2"/><path d="M20 13c-2 0-3 1-3 2s1 2 3 2"/></svg></div><div class="menu-label">Izolace</div><div class="menu-desc">Zateplení ETICS</div></div>
        <div class="menu-item" onclick="showPage('zakladyPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M2 20h20M4 20V10l8-6 8 6v10"/><rect x="9" y="14" width="6" height="6"/></svg></div><div class="menu-label">Základy</div><div class="menu-desc">Beton, výztuž, hydro</div></div>
        <div class="menu-item" onclick="showPage('vytapeniPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0z"/></svg></div><div class="menu-label">Vytápění</div><div class="menu-desc">Radiátory, podlahové, infra</div></div>
        <div class="menu-item" onclick="showPage('klimaPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg></div><div class="menu-label">Klimatizace</div><div class="menu-desc">Dimenzování, LG jednotky</div></div>
        <div class="menu-item" onclick="showPage('elektroPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M6 3l-3 10h6l-2 8 12-12h-7l3-6z"/></svg></div><div class="menu-label">Elektro</div><div class="menu-desc">Rozvaděče, kabely</div></div>
        <div class="menu-item" onclick="showPage('vodaPage')"><div class="menu-icon"><svg viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg></div><div class="menu-label">Voda a odpad</div><div class="menu-desc">Rozvody, bojler, HT/KG</div></div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- BARVY PAGE -->
    <div id="barvyPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Barvy</div>
      </div>
      <div class="content">
        <div class="tabs">
          <button class="tab active" onclick="selectBarvyTab('kov', this)">Kov</button>
          <button class="tab" onclick="selectBarvyTab('steny', this)">Stěny</button>
          <button class="tab" onclick="selectBarvyTab('drevo', this)">Dřevo</button>
        </div>
        
        <!-- KOV -->
        <div id="kovContent">
          <div class="card">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <img src="https://www.barvy-viton.cz/user/documents/upload/logo.png" alt="VITON" style="height:28px;" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
              <span style="display:none;font-size:18px;font-weight:700;color:#e31e24;">VITON</span>
              <div style="font-size:11px;color:var(--g400);">Cesky vyrobce | barvy-viton.cz</div>
            </div>
            <div class="form-group"><label class="form-label">Plocha (m2)</label><input type="number" class="form-input large" id="kovPlocha" placeholder="0" oninput="vypoctiKov()"></div>
            <div class="toggle-btns" style="margin-bottom:8px;">
              <button class="toggle-btn active" onclick="setKovTyp('rozpoustedlo',this)" id="kovTypRozp">Rozpoustedlove</button>
              <button class="toggle-btn" onclick="setKovTyp('voda',this)" id="kovTypVoda">Vodouredelne</button>
            </div>
            <div class="toggle-btns">
              <button class="toggle-btn active" onclick="setKovRezim('system',this)">Doporucene systemy</button>
              <button class="toggle-btn" onclick="setKovRezim('vlastni',this)">Vlastni vyber</button>
            </div>
            <div id="kovSystemy"><div id="kovSystemyList"></div><div id="kovSystemDetail"></div></div>
            <div id="kovVlastni" style="display:none;">
              <div class="form-group"><label class="form-label">Zaklad</label><select class="form-select" id="kovZaklad" onchange="vypoctiKov()"></select></div>
              <div class="form-group"><label class="form-label">Vrchni</label><select class="form-select" id="kovVrchni" onchange="vypoctiKov()"></select></div>
            </div>
            <div class="reserve-row"><span class="reserve-label">Rezerva:</span><select class="reserve-select" id="kovRezerva" onchange="vypoctiKov()"><option value="5">5%</option><option value="10" selected>10%</option><option value="15">15%</option><option value="20">20%</option></select></div>
          </div>
          <div id="kovResult"></div>
        </div>
        
        <!-- STENY -->
        <div id="stenyContent" style="display:none;">
          <div class="card">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <img src="https://www.jub.cz/themes/developer/img/logo.svg" alt="JUB" style="height:24px;" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
              <span style="display:none;font-size:18px;font-weight:700;color:#e4002b;">JUB</span>
              <div style="font-size:11px;color:var(--g400);">JUPOL barvy | jub.cz</div>
            </div>
            <div class="form-group"><label class="form-label">Plocha (m²)</label><input type="number" class="form-input large" id="stenyPlocha" placeholder="0" oninput="vypoctiSteny()"></div>
            <div class="section-title">Podklad</div>
            <div class="podklady-grid" id="stenyPodkladyList"></div>
            <div id="stenyPodkladDetail"></div>
            <div class="section-title" style="margin-top:16px;">Barva</div>
            <div id="stenyBarvyList"></div>
            <div id="stenyPenetraceSection" style="display:none;"><div class="section-title">Penetrace</div><select class="form-select" id="stenyPenetrace" onchange="vypoctiSteny()"></select></div>
            <div class="reserve-row"><span class="reserve-label">Rezerva:</span><select class="reserve-select" id="stenyRezerva" onchange="vypoctiSteny()"><option value="5">5%</option><option value="10" selected>10%</option><option value="15">15%</option></select></div>
          </div>
          <div id="stenyResult"></div>
        </div>
        
        <!-- DREVO -->
        <div id="drevoContent" style="display:none;">
          <div class="card">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <img src="https://www.icla.cz/wp-content/uploads/2020/01/logo-icla.png" alt="ICLA" style="height:24px;" onerror="this.style.display='none';this.nextElementSibling.style.display='block'">
              <span style="display:none;font-size:18px;font-weight:700;color:#1a4d8f;">ICLA</span>
              <div style="font-size:11px;color:var(--g400);">Profesionální barvy | icla.cz</div>
            </div>
            <div class="form-group"><label class="form-label">Plocha (m²)</label><input type="number" class="form-input large" id="drevoPlocha" placeholder="0" oninput="vypoctiDrevo()"></div>
            <div class="toggle-btns">
              <button class="toggle-btn active" onclick="setDrevoRezim('system',this)">Podle použití</button>
              <button class="toggle-btn" onclick="setDrevoRezim('vlastni',this)">Vlastní výběr</button>
            </div>
            <div id="drevoSystemy"><div id="drevoSystemyList"></div><div id="drevoSystemDetail"></div></div>
            <div id="drevoVlastni" style="display:none;"><div class="form-group"><label class="form-label">Produkt</label><select class="form-select" id="drevoProdukt" onchange="vypoctiDrevo()"></select></div></div>
            <div class="reserve-row"><span class="reserve-label">Rezerva:</span><select class="reserve-select" id="drevoRezerva" onchange="vypoctiDrevo()"><option value="10">10%</option><option value="15" selected>15%</option><option value="20">20%</option></select></div>
          </div>
          <div id="drevoResult"></div>
        </div>
        
        <div style="text-align:center;font-size:11px;color:var(--g400);margin-top:16px;padding-bottom:20px;">Ceny orientační | Pouze ověřené produkty z oficiálních zdrojů</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
  <!-- ZAKLADY PAGE -->
    <div id="zakladyPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Betonování základů</div>
      </div>
      <div class="content">
        
        <!-- SOUHRN NAHOŘE -->
        <div class="summary-grid">
          <div class="summary-box"><div class="summary-box-label">Beton</div><div class="summary-box-value" id="zakladySumBeton">0 Kč</div></div>
          <div class="summary-box"><div class="summary-box-label">Výztuž</div><div class="summary-box-value" id="zakladySumVyztuz">0 Kč</div></div>
          <div class="summary-box"><div class="summary-box-label">Hydro</div><div class="summary-box-value" id="zakladySumHydro">0 Kč</div></div>
          <div class="summary-box"><div class="summary-box-label">Celkem</div><div class="summary-box-value" id="zakladySumCelkem">0 Kč</div></div>
        </div>
        
        <!-- PASY -->
        <div class="card">
          <div class="card-title">Základové pasy</div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Délka (m)</label><input type="number" class="form-input" id="zakladyDelkaPasu" value="52" oninput="vypoctiZaklady()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Šířka (m)</label><input type="number" class="form-input" id="zakladySirkaPasu" value="0.5" step="0.05" oninput="vypoctiZaklady()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Hloubka (m)</label><input type="number" class="form-input" id="zakladyHloubkaPasu" value="0.8" step="0.1" oninput="vypoctiZaklady()"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Beton</label><select class="form-select" id="zakladyBetonPasy" onchange="vypoctiZaklady()"></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Konzistence</label><select class="form-select" id="zakladyKonzPasy" onchange="vypoctiZaklady()"></select></div>
          </div>
          <div id="zakladyPasyInfo" class="info-box"></div>
        </div>
        
        <!-- ZTRACENE BEDNENI -->
        <div class="card">
          <div class="card-title">Ztracené bednění</div>
          <label class="checkbox-label">
            <input type="checkbox" id="zakladyPouzitZB" checked onchange="toggleZakladyZB()">
            Použít ZB (nadezdívka pasů)
          </label>
          <div id="zakladyZBContent">
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Typ tvarovky</label><select class="form-select" id="zakladyTypZB" onchange="vypoctiZaklady()"></select></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Počet řad</label><input type="number" class="form-input" id="zakladyRadyZB" value="3" min="1" max="10" oninput="vypoctiZaklady()"></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Roxory</label><select class="form-select" id="zakladyRoxorZB" onchange="vypoctiZaklady()"></select></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Beton do ZB</label><select class="form-select" id="zakladyBetonZB" onchange="vypoctiZaklady()"></select></div>
            </div>
            <div id="zakladyZBInfo" class="info-box"></div>
          </div>
        </div>
        
        <!-- DESKA -->
        <div class="card">
          <div class="card-title">Základová deska</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Plocha (m²)</label><input type="number" class="form-input" id="zakladyPlochaDesky" value="120" oninput="vypoctiZaklady()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Tloušťka (m)</label><input type="number" class="form-input" id="zakladyTloustkaDesky" value="0.15" step="0.01" oninput="vypoctiZaklady()"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Beton</label><select class="form-select" id="zakladyBetonDeska" onchange="vypoctiZaklady()"></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Konzistence</label><select class="form-select" id="zakladyKonzDeska" onchange="vypoctiZaklady()"></select></div>
          </div>
          <div class="form-group" style="margin-top:8px;margin-bottom:0;"><label class="form-label">KARI síť</label><select class="form-select" id="zakladyTypKari" onchange="vypoctiZaklady()"></select></div>
          <label class="checkbox-label">
            <input type="checkbox" id="zakladyDvojiteKari" onchange="vypoctiZaklady()">
            Dvojité KARI (2 vrstvy)
          </label>
          <div id="zakladyDeskaInfo" class="info-box"></div>
        </div>
        
        <!-- PODKLAD -->
        <div class="card">
          <div class="card-title">Podklad a podsyp</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Typ podsypu</label><select class="form-select" id="zakladyTypPodsypu" onchange="vypoctiZaklady()"></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Tloušťka (m)</label><input type="number" class="form-input" id="zakladyTloustkaPodsypu" value="0.2" step="0.05" oninput="vypoctiZaklady()"></div>
          </div>
          <label class="checkbox-label">
            <input type="checkbox" id="zakladyPodkladniBeton" checked onchange="toggleZakladyPodklad()">
            Podkladní beton C12/15
          </label>
          <div id="zakladyPodkladContent" style="margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Tloušťka podkl. betonu (m)</label><input type="number" class="form-input" id="zakladyTloustkaPodklad" value="0.1" step="0.05" oninput="vypoctiZaklady()"></div>
          </div>
        </div>
        
        <!-- HYDROIZOLACE -->
        <div class="card">
          <div class="card-title">Hydroizolace</div>
          <div class="form-group" style="margin-bottom:8px;"><label class="form-label">Typ pásu</label><select class="form-select" id="zakladyTypHydro" onchange="vypoctiZaklady()"></select></div>
          <label class="checkbox-label">
            <input type="checkbox" id="zakladyDvouvrstva" onchange="vypoctiZaklady()">
            Dvouvrstvá (střední/vysoké namáhání)
          </label>
          <div id="zakladyHydroInfo" class="info-box"></div>
        </div>
        
        <!-- ZEMNENI -->
        <div class="card">
          <div class="card-title">Zemnění (hromosvod)</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Délka pásku (m)</label><input type="number" class="form-input" id="zakladyDelkaZemneni" value="60" step="5" oninput="vypoctiZaklady()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Počet svorek</label><input type="number" class="form-input" id="zakladyPocetSvorek" value="8" min="2" oninput="vypoctiZaklady()"></div>
          </div>
          <div class="info-box">FeZn 30×4 po obvodu, hloubka min. 0,6m. Ukládat PŘED betonáží!</div>
        </div>
        
        <!-- PROSTUPY -->
        <div class="card">
          <div class="card-title">Prostupy (chráničky)</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Kanalizace DN160</label><input type="number" class="form-input" id="zakladyProstupyKanal" value="2" min="0" oninput="vypoctiZaklady()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Voda DN50</label><input type="number" class="form-input" id="zakladyProstupyVoda" value="1" min="0" oninput="vypoctiZaklady()"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Elektro DN63</label><input type="number" class="form-input" id="zakladyProstupyElektro" value="2" min="0" oninput="vypoctiZaklady()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Plyn DN40</label><input type="number" class="form-input" id="zakladyProstupyPlyn" value="1" min="0" oninput="vypoctiZaklady()"></div>
          </div>
        </div>
        
        <!-- CERPADLO -->
        <div class="card">
          <div class="card-title">Čerpadlo a nářadí</div>
          <div class="form-group" style="margin-bottom:8px;"><label class="form-label">Typ čerpadla</label><select class="form-select" id="zakladyTypCerpadla" onchange="toggleZakladyCerpadlo()"><option value="zadne">Bez čerpadla (z mixu)</option><option value="male" selected>Pístové (do 20m)</option><option value="velke">Ramenové (24-47m)</option></select></div>
          <div id="zakladyCerpadloContent">
            <div class="form-group" style="margin-bottom:8px;"><label class="form-label">Hodiny čerpání</label><input type="number" class="form-input" id="zakladyHodinyPumpy" value="4" min="2" oninput="vypoctiZaklady()"></div>
          </div>
          <label class="checkbox-label">
            <input type="checkbox" id="zakladyPronajemVibr" checked onchange="toggleZakladyVibrator()">
            Pronájem vibrátorů
          </label>
          <div id="zakladyVibratorContent" style="margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Dny práce</label><input type="number" class="form-input" id="zakladyDnyPrace" value="3" min="1" oninput="vypoctiZaklady()"></div>
          </div>
        </div>
        
        <div id="zakladyResult"></div>
        
        <!-- POSTUP PRACI -->
        <div class="card" style="margin-top:16px;">
          <div class="card-title">Doporučený postup prací</div>
          <div class="flow-steps">
            <span class="flow-step">1. Výkop rýh</span><span class="flow-arrow">→</span>
            <span class="flow-step">2. Betonáž pasů</span><span class="flow-arrow">→</span>
            <span class="flow-step">3. Ztracené bednění</span><span class="flow-arrow">→</span>
            <span class="flow-step">4. Podsyp + zhutnění</span><span class="flow-arrow">→</span>
            <span class="flow-step">5. Podkladní beton</span><span class="flow-arrow">→</span>
            <span class="flow-step">6. Zemnění + prostupy</span><span class="flow-arrow">→</span>
            <span class="flow-step">7. KARI sítě</span><span class="flow-arrow">→</span>
            <span class="flow-step">8. Betonáž desky</span><span class="flow-arrow">→</span>
            <span class="flow-step">9. Hydroizolace (28 dní)</span>
          </div>
        </div>
        
        <div class="footer-note">Ceny orientační bez DPH | Beton C12/15 až C25/30 | Hydroizolace DEK | 01/2025</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- ELEKTRO PAGE -->
    <div id="elektroPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Elektroinstalace</div>
      </div>
      <div class="content">
        
        <!-- NASTAVENÍ -->
        <div class="card">
          <div class="card-title">Hlavní přívod (Bonega)</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Hlavní jistič</label><select class="form-select" id="elektroHlavniJistic" onchange="vypoctiElektro()"><option value="20">20A</option><option value="25" selected>25A</option><option value="32">32A</option><option value="40">40A</option><option value="50">50A</option><option value="63">63A</option></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Svodič</label><select class="form-select" id="elektroSvodic" onchange="vypoctiElektro()"><option value="zadny">Bez</option><option value="t2_3n" selected>T2 3P+N</option><option value="t1t2_3n">T1+T2 (FVE)</option></select></div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title">Zásuvky a vypínače</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Výrobce</label><select class="form-select" id="elektroVyrobce" onchange="elektroZmenVyrobce()"><option value="abb">ABB</option><option value="schneider">Schneider</option><option value="legrand">Legrand</option><option value="hager">Hager</option></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Série</label><select class="form-select" id="elektroSerie" onchange="vypoctiElektro()"></select></div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title">Smart Home</div>
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text);cursor:pointer;">
            <input type="checkbox" id="elektroGateway" checked onchange="vypoctiElektro()" style="width:18px;height:18px;">
            Zigbee Gateway (650 Kč)
          </label>
          <div style="font-size:11px;color:var(--g400);margin-top:4px;">Termostaty: Tuya HY607W Zigbee</div>
        </div>
        
        <!-- MÍSTNOSTI -->
        <div class="card">
          <div class="card-title">Přidat místnost</div>
          <div id="elektroTypyMistnosti" style="display:flex;flex-wrap:wrap;gap:6px;"></div>
        </div>
        
        <div id="elektroMistnostiList"></div>
        
        <!-- SPECIÁLNÍ SPOTŘEBIČE -->
        <div class="card">
          <div class="card-title">Speciální spotřebiče</div>
          <div id="elektroSpecialniList" style="display:grid;grid-template-columns:1fr 1fr;gap:6px;"></div>
        </div>
        
        <!-- NASTAVENÍ -->
        <div class="card">
          <div style="display:flex;align-items:center;gap:8px;">
            <span class="form-label" style="margin:0;">Rezerva kabelů:</span>
            <select class="form-select" id="elektroRezerva" onchange="vypoctiElektro()" style="width:80px;"><option value="5">5%</option><option value="10" selected>10%</option><option value="15">15%</option><option value="20">20%</option></select>
          </div>
        </div>
        
        <div id="elektroResult"></div>
        
        <div style="text-align:center;font-size:11px;color:var(--g400);margin-top:16px;padding-bottom:20px;">Výzbroj: Bonega | Kabely: NKT | Materiál: Kopos | Ceny 01/2025</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- PODLAHY PAGE -->
    <div id="podlahyPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Vinylové podlahy</div>
      </div>
      <div class="content">
        <div class="card">
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
            <div style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#d4a574,#8b6914);display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:12px;">A</div>
            <div>
              <div style="font-weight:600;color:var(--text);">ARBITON SPC Podlahy</div>
              <div style="font-size:11px;color:var(--g400);">HD Minerální jádro | 100% voděodolné | arbiton.com</div>
            </div>
          </div>
          
          <div class="section-title">Rozměry místnosti</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Plocha (m²)</label><input type="number" class="form-input" id="podlahyPlocha" placeholder="0" oninput="vypoctiPodlahy()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Obvod (bm)</label><input type="number" class="form-input" id="podlahyObvod" placeholder="0" oninput="vypoctiPodlahy()"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Dveře (ks)</label><input type="number" class="form-input" id="podlahyDvere" placeholder="0" oninput="vypoctiPodlahy()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Vnitř. rohy</label><input type="number" class="form-input" id="podlahyVnitrniRohy" placeholder="0" oninput="vypoctiPodlahy()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Vnějš. rohy</label><input type="number" class="form-input" id="podlahyVnejsiRohy" placeholder="0" oninput="vypoctiPodlahy()"></div>
          </div>
          
          <div class="section-title" style="margin-top:12px;">Řada podlahy</div>
          <div id="podlahyKategorieList"></div>
          
          <div class="section-title" style="margin-top:12px;">Typ podlahy</div>
          <select class="form-select" id="podlahyTyp" onchange="vypoctiPodlahy()"></select>
          <div id="podlahyTypInfo" style="margin-top:8px;"></div>
          
          <div class="section-title" style="margin-top:12px;">Podložka</div>
          <div id="podlahyPodlozkaList"></div>
          
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text);cursor:pointer;margin-top:8px;">
            <input type="checkbox" id="podlahyTopeni" onchange="vypoctiPodlahy()" style="width:18px;height:18px;">
            Podlahové topení (max. 27°C)
          </label>
          <div id="podlahyTopeniWarning" style="display:none;margin-top:8px;padding:10px;background:rgba(234,179,8,0.1);border:1px solid rgba(234,179,8,0.3);border-radius:8px;font-size:11px;color:#ca8a04;">
            ⚠️ Pro podlahové topení volte podložku s nízkým tepelným odporem (R < 0,01 m²K/W). Doporučujeme Multiprotec Antislip nebo Super Hardlay.
          </div>
          
          <div class="section-title" style="margin-top:12px;">Soklové lišty</div>
          <div class="toggle-btns" style="margin-bottom:8px;">
            <button class="toggle-btn active" onclick="setPodlahySoklTyp('vigo',this)">VIGO (Duropolymer)</button>
            <button class="toggle-btn" onclick="setPodlahySoklTyp('indo',this)">INDO (MDF)</button>
          </div>
          <select class="form-select" id="podlahySoklVarianta" onchange="vypoctiPodlahy()"></select>
          
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text);cursor:pointer;margin-top:8px;">
            <input type="checkbox" id="podlahyKlipy" checked onchange="vypoctiPodlahy()" style="width:18px;height:18px;">
            Montáž na klipy (místo lepení)
          </label>
          
          <div class="section-title" style="margin-top:12px;">Přechodové lišty</div>
          <select class="form-select" id="podlahyPrechod" onchange="vypoctiPodlahy()"></select>
          
          <div class="section-title" style="margin-top:12px;">Nastavení</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Rezerva podlaha (%)</label><select class="form-select" id="podlahyRezervaPodlaha" onchange="vypoctiPodlahy()"><option value="5">5%</option><option value="10" selected>10%</option><option value="15">15%</option></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Rezerva lišty (%)</label><select class="form-select" id="podlahyRezervaListy" onchange="vypoctiPodlahy()"><option value="5" selected>5%</option><option value="10">10%</option></select></div>
          </div>
          <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text);cursor:pointer;margin-top:8px;">
            <input type="checkbox" id="podlahyInstalacniSada" checked onchange="vypoctiPodlahy()" style="width:18px;height:18px;">
            Včetně instalační sady (299 Kč)
          </label>
        </div>
        <div id="podlahyResult"></div>
        
        <div class="card" style="margin-top:16px;">
          <div class="card-title">Technické požadavky</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div style="background:var(--g100);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g500);">Rovinnost podkladu</div><div style="font-size:13px;font-weight:500;">±2 mm / 2 m</div></div>
            <div style="background:var(--g100);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g500);">Vlhkost cement. potěr</div><div style="font-size:13px;font-weight:500;">max. 2% CM</div></div>
            <div style="background:var(--g100);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g500);">Vlhkost anhydrit</div><div style="font-size:13px;font-weight:500;">max. 0,5% CM</div></div>
            <div style="background:var(--g100);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g500);">Max. bez dilatace</div><div style="font-size:13px;font-weight:500;">200 m²</div></div>
          </div>
        </div>
        
        <div style="text-align:center;font-size:11px;color:var(--g400);margin-top:16px;padding-bottom:20px;">Ceny orientační (leden 2025) | Bez práce a dopravy</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- ETICS PAGE -->
    <div id="eticsPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">ETICS - Zateplení</div>
      </div>
      <div class="content">
        <div class="tabs">
          <button class="tab active" onclick="selectEticsTab('baumit', this)">Baumit</button>
          <button class="tab" onclick="selectEticsTab('weber', this)">Weber</button>
        </div>
        
        <!-- BAUMIT -->
        <div id="baumitContent">
          <div class="card">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <div style="width:32px;height:32px;border-radius:50%;background:#f5821f;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:14px;">B</div>
              <div>
                <div style="font-weight:600;color:var(--text);">Baumit</div>
                <div style="font-size:11px;color:var(--g400);">Zateplovací systémy | baumit.cz</div>
              </div>
            </div>
            
            <div class="section-title">Plochy</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Fasáda (m²)</label><input type="number" class="form-input" id="baumitPlocha" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Sokl (m²)</label><input type="number" class="form-input" id="baumitSokl" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
            </div>
            
            <div class="section-title" style="margin-top:12px;">Rozměry pro profily</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Obvod budovy (bm)</label><input type="number" class="form-input" id="baumitObvod" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Délka rohů (bm)</label><input type="number" class="form-input" id="baumitRohy" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Počet oken/dveří</label><input type="number" class="form-input" id="baumitPocetOken" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Obvod oken (bm)</label><input type="number" class="form-input" id="baumitObvodOken" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
            </div>
            <div class="form-group" style="margin-top:8px;"><label class="form-label">Šířka oken celkem (bm) - pro okapničky</label><input type="number" class="form-input" id="baumitSirkaOken" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
            
            <div class="section-title" style="margin-top:12px;">Izolant fasády</div>
            <div id="baumitIzolantList"></div>
            
            <div class="section-title" style="margin-top:12px;">Tloušťka izolantu</div>
            <select class="form-select" id="baumitTloustka" onchange="vypoctiEtics('baumit')"></select>
            
            <div class="section-title" style="margin-top:12px;">Izolant soklu (XPS)</div>
            <select class="form-select" id="baumitXps" onchange="vypoctiEtics('baumit')"></select>
            
            <div class="section-title" style="margin-top:12px;">Lepidlo a stěrka</div>
            <div id="baumitLepidloList"></div>
            
            <div class="section-title" style="margin-top:12px;">Síťovina</div>
            <div id="baumitSitovinaList"></div>
            
            <div class="section-title" style="margin-top:12px;">Penetrace</div>
            <select class="form-select" id="baumitPenetrace" onchange="vypoctiEtics('baumit')"></select>
            
            <div class="section-title" style="margin-top:12px;">Omítka fasády</div>
            <div id="baumitOmitkaList"></div>
            
            <div class="section-title" style="margin-top:12px;">Omítka soklu</div>
            <select class="form-select" id="baumitOmitkaSokl" onchange="vypoctiEtics('baumit')"></select>
            
            <div class="section-title" style="margin-top:12px;">Okenní profily</div>
            <div id="baumitOkenniProfilList"></div>
            
            <div class="section-title" style="margin-top:12px;">Požární pásy</div>
            <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text);cursor:pointer;">
              <input type="checkbox" id="baumitPozarniPasy" onchange="togglePozarniPasy('baumit')" style="width:18px;height:18px;">
              Požární pásy z minerální vaty (povinné u h > 12m)
            </label>
            <div id="baumitPozarniPasyInput" style="display:none;margin-top:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Délka požárních pásů (bm)</label><input type="number" class="form-input" id="baumitPozarniPasyBm" placeholder="0" oninput="vypoctiEtics('baumit')"></div>
            </div>
            
            <div class="section-title" style="margin-top:12px;">Nastavení</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Rezerva (%)</label><select class="form-select" id="baumitRezerva" onchange="vypoctiEtics('baumit')"><option value="10" selected>10%</option><option value="15">15%</option><option value="20">20%</option></select></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Hmoždinky (ks/m²)</label><select class="form-select" id="baumitHmozdinkyM2" onchange="vypoctiEtics('baumit')"><option value="6" selected>6 ks/m²</option><option value="8">8 ks/m²</option><option value="10">10 ks/m²</option></select></div>
            </div>
          </div>
          <div id="baumitResult"></div>
        </div>
        
        <!-- WEBER -->
        <div id="weberContent" style="display:none;">
          <div class="card">
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
              <div style="width:32px;height:32px;border-radius:50%;background:#003366;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:14px;">W</div>
              <div>
                <div style="font-weight:600;color:var(--text);">Weber Saint-Gobain</div>
                <div style="font-size:11px;color:var(--g400);">Zateplovací systémy | weber-terranova.cz</div>
              </div>
            </div>
            
            <div class="section-title">Plochy</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Fasáda (m²)</label><input type="number" class="form-input" id="weberPlocha" placeholder="0" oninput="vypoctiEtics('weber')"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Sokl (m²)</label><input type="number" class="form-input" id="weberSokl" placeholder="0" oninput="vypoctiEtics('weber')"></div>
            </div>
            
            <div class="section-title" style="margin-top:12px;">Rozměry pro profily</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Obvod budovy (bm)</label><input type="number" class="form-input" id="weberObvod" placeholder="0" oninput="vypoctiEtics('weber')"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Délka rohů (bm)</label><input type="number" class="form-input" id="weberRohy" placeholder="0" oninput="vypoctiEtics('weber')"></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Počet oken/dveří</label><input type="number" class="form-input" id="weberPocetOken" placeholder="0" oninput="vypoctiEtics('weber')"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Obvod oken (bm)</label><input type="number" class="form-input" id="weberObvodOken" placeholder="0" oninput="vypoctiEtics('weber')"></div>
            </div>
            <div class="form-group" style="margin-top:8px;"><label class="form-label">Šířka oken celkem (bm) - pro okapničky</label><input type="number" class="form-input" id="weberSirkaOken" placeholder="0" oninput="vypoctiEtics('weber')"></div>
            
            <div class="section-title" style="margin-top:12px;">Izolant fasády</div>
            <div id="weberIzolantList"></div>
            
            <div class="section-title" style="margin-top:12px;">Tloušťka izolantu</div>
            <select class="form-select" id="weberTloustka" onchange="vypoctiEtics('weber')"></select>
            
            <div class="section-title" style="margin-top:12px;">Izolant soklu (XPS)</div>
            <select class="form-select" id="weberXps" onchange="vypoctiEtics('weber')"></select>
            
            <div class="section-title" style="margin-top:12px;">Lepidlo a stěrka</div>
            <div id="weberLepidloList"></div>
            
            <div class="section-title" style="margin-top:12px;">Síťovina</div>
            <div id="weberSitovinaList"></div>
            
            <div class="section-title" style="margin-top:12px;">Penetrace</div>
            <select class="form-select" id="weberPenetrace" onchange="vypoctiEtics('weber')"></select>
            
            <div class="section-title" style="margin-top:12px;">Omítka fasády</div>
            <div id="weberOmitkaList"></div>
            
            <div class="section-title" style="margin-top:12px;">Omítka soklu</div>
            <select class="form-select" id="weberOmitkaSokl" onchange="vypoctiEtics('weber')"></select>
            
            <div class="section-title" style="margin-top:12px;">Okenní profily</div>
            <div id="weberOkenniProfilList"></div>
            
            <div class="section-title" style="margin-top:12px;">Požární pásy</div>
            <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text);cursor:pointer;">
              <input type="checkbox" id="weberPozarniPasy" onchange="togglePozarniPasy('weber')" style="width:18px;height:18px;">
              Požární pásy z minerální vaty (povinné u h > 12m)
            </label>
            <div id="weberPozarniPasyInput" style="display:none;margin-top:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Délka požárních pásů (bm)</label><input type="number" class="form-input" id="weberPozarniPasyBm" placeholder="0" oninput="vypoctiEtics('weber')"></div>
            </div>
            
            <div class="section-title" style="margin-top:12px;">Nastavení</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Rezerva (%)</label><select class="form-select" id="weberRezerva" onchange="vypoctiEtics('weber')"><option value="10" selected>10%</option><option value="15">15%</option><option value="20">20%</option></select></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Hmoždinky (ks/m²)</label><select class="form-select" id="weberHmozdinkyM2" onchange="vypoctiEtics('weber')"><option value="6" selected>6 ks/m²</option><option value="8">8 ks/m²</option><option value="10">10 ks/m²</option></select></div>
            </div>
          </div>
          <div id="weberResult"></div>
        </div>
        
        <div style="text-align:center;font-size:11px;color:var(--g400);margin-top:16px;padding-bottom:20px;">Ceny dle DEK.cz (leden 2025) | Bez práce a lešení</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- VYTAPENI PAGE -->
    <div id="vytapeniPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Dimenzování vytápění</div>
      </div>
      <div class="content">
        
        <!-- MÍSTNOSTI -->
        <div class="card">
          <div class="card-title">Výpočtové teploty</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Venkovní výpočtová °C</label><input type="number" class="form-input" id="vytapeniVenkovni" value="-15" onchange="vypoctiVytapeniZtraty()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Vnitřní požadovaná °C</label><input type="number" class="form-input" id="vytapeniVnitrni" value="20" onchange="vypoctiVytapeniZtraty()"></div>
          </div>
          <div style="margin-top:8px;font-size:10px;color:var(--g400);">
            CZ: -12 až -18°C | ES: 0 až -5°C | Vnitřní: obytné 20°C, koupelny 24°C
          </div>
        </div>
        
        <div class="card">
          <div class="card-title">Místnosti</div>
          <div id="vytapeniMistnostiList"></div>
          <button onclick="pridatVytapeniMistnost()" style="width:100%;padding:12px;border:2px dashed var(--g300);border-radius:10px;background:transparent;color:var(--g500);font-size:12px;font-weight:500;cursor:pointer;font-family:inherit;margin-top:8px;">+ Přidat místnost</button>
        </div>
        
        <!-- POŽADOVANÝ VÝKON -->
        <div id="vytapeniPozadovanyVykon" style="display:flex;justify-content:space-between;align-items:center;padding:14px 16px;background:linear-gradient(135deg, var(--gold-light), var(--gold-dark));border-radius:12px;margin-bottom:16px;">
          <span style="font-size:13px;font-weight:600;color:#fff;">Požadovaný výkon</span>
          <span style="font-size:20px;font-weight:700;color:#fff;">0 kW</span>
        </div>
        
        <!-- VÝBĚR SYSTÉMU -->
        <div class="card">
          <div class="card-title">Vyberte systém vytápění</div>
          <div class="toggle-btns" style="flex-direction:column;">
            <button class="toggle-btn" id="btnRadiatory" onclick="selectVytapeniSystem('radiatory')">Radiátory</button>
            <button class="toggle-btn" id="btnPodlahove" onclick="selectVytapeniSystem('podlahove')">Podlahové vytápění</button>
            <button class="toggle-btn" id="btnInfra" onclick="selectVytapeniSystem('infra')">Infra topné fólie</button>
          </div>
        </div>
        
        <!-- RADIÁTORY KONFIGURACE -->
        <div id="vytapeniRadiatoryConfig" style="display:none;">
          <div class="card">
            <div class="card-title">Parametry radiátorů</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Výška</label><select class="form-select" id="radiatorVyska" onchange="vypoctiVytapeniSystem()"><option value="300">300 mm</option><option value="400">400 mm</option><option value="500">500 mm</option><option value="600" selected>600 mm</option><option value="900">900 mm</option></select></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Typ</label><select class="form-select" id="radiatorTyp" onchange="vypoctiVytapeniSystem()"><option value="11">Typ 11</option><option value="21s">Typ 21s</option><option value="22" selected>Typ 22</option><option value="33">Typ 33</option></select></div>
            </div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Přívodní °C</label><input type="number" class="form-input" id="radPrivod" value="55" onchange="vypoctiVytapeniSystem()"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Vratná °C</label><input type="number" class="form-input" id="radVrat" value="45" onchange="vypoctiVytapeniSystem()"></div>
            </div>
          </div>
        </div>
        
        <!-- PODLAHOVÉ KONFIGURACE -->
        <div id="vytapeniPodlahoveConfig" style="display:none;">
          <div class="card">
            <div class="card-title">Parametry podlahového vytápění</div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Rozteč potrubí</label><select class="form-select" id="podlahaRoztec" onchange="vypoctiVytapeniSystem()"><option value="100">100 mm</option><option value="150" selected>150 mm</option><option value="200">200 mm</option></select></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Průměr</label><select class="form-select" id="podlahaPrumer" onchange="vypoctiVytapeniSystem()"><option value="16">16×2 mm</option><option value="17" selected>17×2 mm PE-Xa</option><option value="20">20×2 mm</option></select></div>
            </div>
            <div class="form-group" style="margin-top:8px;margin-bottom:0;"><label class="form-label">Podlahová krytina</label><select class="form-select" id="podlahaKrytina" onchange="vypoctiVytapeniSystem()"><option value="0.01">Dlažba (R = 0,01)</option><option value="0.05">Laminát (R = 0,05)</option><option value="0.10" selected>Dřevo/Vinyl (R = 0,10)</option><option value="0.15">Koberec (R = 0,15)</option></select></div>
          </div>
        </div>
        
        <!-- INFRA KONFIGURACE -->
        <div id="vytapeniInfraConfig" style="display:none;">
          <div class="card">
            <div class="card-title">Parametry infra fólií</div>
            <div class="form-group" style="margin-bottom:8px;"><label class="form-label">Model fólie</label><select class="form-select" id="infraModel" onchange="updateInfraPrice();vypoctiVytapeniSystem()">
              <optgroup label="HD-G (pod plovoucí podlahy)">
                <option value="80" data-width="100" data-price="485" selected>HD310G 80W/bm (š.100cm) – 485 Kč/bm</option>
                <option value="140" data-width="100" data-price="485">HD310G 140W/bm (š.100cm) – 485 Kč/bm</option>
                <option value="80" data-width="50" data-price="280">HD310G 80W/bm (š.50cm) – 280 Kč/bm</option>
              </optgroup>
              <optgroup label="HD-EPL (pod anhydrit)">
                <option value="160" data-width="100" data-price="550">HD-EPL 160W/bm (š.100cm) – 550 Kč/bm</option>
                <option value="80" data-width="50" data-price="320">HD-EPL 80W/bm (š.50cm) – 320 Kč/bm</option>
              </optgroup>
            </select></div>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
              <div class="form-group" style="margin:0;"><label class="form-label">Pokrytí plochy %</label><input type="number" class="form-input" id="infraPokryti" value="70" min="50" max="80" onchange="vypoctiVytapeniSystem()"></div>
              <div class="form-group" style="margin:0;"><label class="form-label">Cena Kč/bm</label><input type="number" class="form-input" id="infraCena" value="485" readonly style="background:var(--g100);"></div>
            </div>
            <div class="form-group" style="margin-top:8px;margin-bottom:0;"><label class="form-label">Termostat</label><select class="form-select" id="infraTermostat" onchange="vypoctiVytapeniSystem()">
              <option value="1159" data-name="Smartica HY607B ZigBee">Smartica HY607B ZigBee – 1 159 Kč</option>
              <option value="850" data-name="BHT-002 WiFi 16A">BHT-002 WiFi 16A – 850 Kč</option>
              <option value="1796" data-name="Heat Decor HD-T1000">Heat Decor HD-T1000 WiFi – 1 796 Kč</option>
            </select></div>
          </div>
        </div>
        
        <!-- NÁKUPNÍ SEZNAM -->
        <div id="vytapeniNakupniSeznam"></div>
        
        <div class="footer-note">Ceny orientační | Heat Decor (infraheat.cz) | 01/2025</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- VODA PAGE -->
    <div id="vodaPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Voda a odpad</div>
      </div>
      <div class="content">
        
        <!-- SOUHRN -->
        <div class="summary-grid" style="grid-template-columns:1fr 1fr 1fr;">
          <div class="summary-box" style="border-left:3px solid #3b82f6;"><div class="summary-box-label">Voda</div><div class="summary-box-value" id="vodaSumVoda" style="color:#3b82f6;">0 Kč</div></div>
          <div class="summary-box" style="border-left:3px solid #f59e0b;"><div class="summary-box-label">Odpad</div><div class="summary-box-value" id="vodaSumOdpad" style="color:#f59e0b;">0 Kč</div></div>
          <div class="summary-box" style="border-left:3px solid var(--gold);"><div class="summary-box-label">Celkem</div><div class="summary-box-value" id="vodaSumCelkem">0 Kč</div></div>
        </div>
        
        <!-- VÝVODY -->
        <div class="card">
          <div class="card-title">Vývody</div>
          <div id="vodaVyvodyList"></div>
          <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:10px;">
            <button onclick="pridatVodaVyvod('umyvadlo')" class="vyvod-btn">+ Umyvadlo</button>
            <button onclick="pridatVodaVyvod('wc')" class="vyvod-btn">+ WC</button>
            <button onclick="pridatVodaVyvod('sprcha')" class="vyvod-btn">+ Sprcha</button>
            <button onclick="pridatVodaVyvod('vana')" class="vyvod-btn">+ Vana</button>
            <button onclick="pridatVodaVyvod('drez')" class="vyvod-btn">+ Dřez</button>
            <button onclick="pridatVodaVyvod('pracka')" class="vyvod-btn">+ Pračka</button>
            <button onclick="pridatVodaVyvod('mycka')" class="vyvod-btn">+ Myčka</button>
            <button onclick="pridatVodaVyvod('zahrada')" class="vyvod-btn">+ Zahrada</button>
          </div>
        </div>
        
        <!-- VODA PARAMETRY -->
        <div class="card">
          <div class="card-title">Rozvody vody</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Přívod SV (m)</label><input type="number" class="form-input" id="vodaPrivodSV" value="6" onchange="vypoctiVoda()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Přívod TV (m)</label><input type="number" class="form-input" id="vodaPrivodTV" value="6" onchange="vypoctiVoda()"></div>
          </div>
          <div class="form-group" style="margin-top:8px;margin-bottom:8px;"><label class="form-label">Bojler</label><select class="form-select" id="vodaBojler" onchange="vypoctiVoda()">
            <option value="50">Dražice OKCE 50 (50l) – 5 500 Kč</option>
            <option value="80">Dražice OKCE 80 (80l) – 6 200 Kč</option>
            <option value="100">Dražice OKCE 100 (100l) – 6 800 Kč</option>
            <option value="125" selected>Dražice OKCE 125 (122l) – 7 500 Kč</option>
            <option value="160">Dražice OKCE 160 (152l) – 8 500 Kč</option>
            <option value="200">Dražice OKCE 200 (195l) – 10 500 Kč</option>
          </select></div>
          <div class="form-group" style="margin-bottom:8px;"><label class="form-label">Cirkulační čerpadlo</label><select class="form-select" id="vodaCerpadlo" onchange="toggleVodaCirculace();vypoctiVoda()">
            <option value="zadne">Bez cirkulace</option>
            <option value="UP15-14B">Grundfos UP 15-14 B PM – 3 400 Kč</option>
            <option value="UP15-14BA" selected>Grundfos UP 15-14 BA PM (AUTOADAPT) – 5 500 Kč</option>
          </select></div>
          <div id="vodaCirculaceRow" class="form-group" style="margin:0;"><label class="form-label">Délka cirkulace (m)</label><input type="number" class="form-input" id="vodaCirculace" value="20" onchange="vypoctiVoda()"></div>
        </div>
        
        <!-- ODPAD PARAMETRY -->
        <div class="card">
          <div class="card-title">Odpad - ležatá kanalizace</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">HT DN75 (m)</label><input type="number" class="form-input" id="vodaHT75" value="8" onchange="vypoctiVoda()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">HT DN110 (m)</label><input type="number" class="form-input" id="vodaHT110" value="12" onchange="vypoctiVoda()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Čistící kusy</label><input type="number" class="form-input" id="vodaCistici" value="2" onchange="vypoctiVoda()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Větrací hlavice</label><input type="number" class="form-input" id="vodaVetrani" value="2" onchange="vypoctiVoda()"></div>
          </div>
        </div>
        
        <div class="card">
          <div class="card-title">Odpad - venkovní KG</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">KG potrubí (m)</label><input type="number" class="form-input" id="vodaKG" value="15" onchange="vypoctiVoda()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Dimenze</label><select class="form-select" id="vodaKGDim" onchange="vypoctiVoda()"><option value="DN110" selected>DN110</option><option value="DN125">DN125</option><option value="DN160">DN160</option></select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Revizní šachty</label><input type="number" class="form-input" id="vodaSachty" value="2" onchange="vypoctiVoda()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Drtič odpadu</label><select class="form-select" id="vodaDrtic" onchange="vypoctiVoda()">
              <option value="zadny">Bez drtiče</option>
              <option value="M55">InSinkErator M55 – 7 500 Kč</option>
              <option value="M65">InSinkErator M65+ – 9 900 Kč</option>
              <option value="M100" selected>InSinkErator M100 – 14 500 Kč</option>
              <option value="M200">InSinkErator M200 – 17 800 Kč</option>
            </select></div>
          </div>
        </div>
        
        <!-- NÁKUPNÍ SEZNAM -->
        <div id="vodaNakupniSeznam"></div>
        
        <div class="footer-note">ALPEX vícevrstvé potrubí | Dražice bojlery | Grundfos čerpadla | 01/2025</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
    
    <!-- KLIMA PAGE -->
    <div id="klimaPage" class="page">
      <div class="header">
        <button class="back-btn" onclick="showPage('menuPage')"><svg viewBox="0 0 24 24"><polyline points="15 18 9 12 15 6"/></svg></button>
        <div class="header-title">Klimatizace LG</div>
      </div>
      <div class="content">
        
        <!-- SOUHRN -->
        <div class="summary-grid" style="grid-template-columns:1fr 1fr;">
          <div class="summary-box" style="border-left:3px solid #06b6d4;"><div class="summary-box-label">Chladicí výkon</div><div class="summary-box-value" id="klimaSumVykon" style="color:#06b6d4;">0 kW</div></div>
          <div class="summary-box" style="border-left:3px solid #3b82f6;"><div class="summary-box-label">Roční náklady</div><div class="summary-box-value" id="klimaSumNaklady" style="color:#3b82f6;">0 Kč</div></div>
        </div>
        
        <!-- MÍSTNOSTI -->
        <div class="card">
          <div class="card-title">Chlazené místnosti</div>
          <div id="klimaMistnostiList"></div>
          <button onclick="pridatKlimaMistnost()" style="width:100%;padding:12px;border:2px dashed var(--g300);border-radius:10px;background:transparent;color:var(--g500);font-size:12px;font-weight:500;cursor:pointer;font-family:inherit;margin-top:8px;">+ Přidat místnost</button>
        </div>
        
        <!-- PARAMETRY -->
        <div class="card">
          <div class="card-title">Parametry výpočtu</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Venkovní teplota °C</label><input type="number" class="form-input" id="klimaVenkovni" value="32" onchange="vypoctiKlima()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Požadovaná vnitřní °C</label><input type="number" class="form-input" id="klimaVnitrni" value="24" onchange="vypoctiKlima()"></div>
          </div>
          <div class="form-group" style="margin-top:8px;margin-bottom:8px;"><label class="form-label">Orientace hlavních oken</label>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:6px;">
              <button class="klima-orient" data-dir="N" onclick="setKlimaOrient('N')">S</button>
              <button class="klima-orient" data-dir="E" onclick="setKlimaOrient('E')">V</button>
              <button class="klima-orient active" data-dir="S" onclick="setKlimaOrient('S')">J</button>
              <button class="klima-orient" data-dir="W" onclick="setKlimaOrient('W')">Z</button>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Plocha oken m²</label><input type="number" class="form-input" id="klimaOkna" value="8" onchange="vypoctiKlima()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Zasklení</label><select class="form-select" id="klimaZaskleni" onchange="vypoctiKlima()">
              <option value="0.85">Jednoduché sklo</option>
              <option value="0.65" selected>Dvojsklo</option>
              <option value="0.50">Dvojsklo pokov.</option>
              <option value="0.35">Trojsklo</option>
            </select></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Stínění</label><select class="form-select" id="klimaStineni" onchange="vypoctiKlima()">
              <option value="1.0">Bez stínění</option>
              <option value="0.7" selected>Vnitřní žaluzie</option>
              <option value="0.4">Vnější žaluzie</option>
              <option value="0.2">Venkovní rolety</option>
            </select></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Počet osob</label><input type="number" class="form-input" id="klimaOsoby" value="4" onchange="vypoctiKlima()"></div>
          </div>
        </div>
        
        <!-- PROVOZNÍ NÁKLADY -->
        <div class="card">
          <div class="card-title">Provozní náklady</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
            <div class="form-group" style="margin:0;"><label class="form-label">Cena el. Kč/kWh</label><input type="number" class="form-input" id="klimaCenaEl" value="4.5" step="0.1" onchange="vypoctiKlima()"></div>
            <div class="form-group" style="margin:0;"><label class="form-label">Hodiny/rok</label><input type="number" class="form-input" id="klimaHodiny" value="600" onchange="vypoctiKlima()"></div>
          </div>
        </div>
        
        <!-- DOPORUČENÉ JEDNOTKY -->
        <div class="card">
          <div class="card-title">Doporučené jednotky LG</div>
          <div id="klimaJednotky"></div>
          <div style="margin-top:10px;padding:10px;background:rgba(6,182,212,0.1);border:1px solid rgba(6,182,212,0.3);border-radius:8px;font-size:10px;color:var(--g500);">
            <strong style="color:#06b6d4;">M-Klima.cz</strong> – profesionální dodávka a montáž<br>
            Tel: +420 607 010 464 | <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8ae3e4ece5cae7a7e1e6e3e7eba4e9f0">[email&#160;protected]</a>
          </div>
        </div>
        
        <div class="footer-note">Klimatizace LG | M-Klima.cz | Ceny orientační bez montáže</div>
      </div>
      <div class="home-indicator"><div class="home-indicator-bar"></div></div>
    </div>
  </div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// === DATABÁZE ===
const vitonProdukty = {
  zaklady: [
    { id: 'eg11', nazev: 'EG 11 epoxyesterovy zaklad', vydatnost: 12, cena: { 0.8: 219, 4: 849, 9: 1690 }, schnutiDotyk: '30 min', schnutiDalsiVrstva: '16 hod', popis: 'Jednoslozkov rychleschnouci zaklad do stredne tezkeho korozniho prostredi. Adhezni mezivrstva pri renovaci starych nateru.', je1K: true, url: 'https://www.barvissimo.cz/viton?q=EG+11' },
    { id: 'zg11', nazev: 'ZG 11 epoxidovy zaklad 2K', vydatnost: 10, cena: { 1: 390, 4: 1290, 9: 2590 }, schnutiDotyk: '55 min', schnutiDalsiVrstva: '24 hod', dobaZpracovani: '8 hod', popis: 'Dvouslozkov epoxidovy zaklad do stredne tezkeho korozniho prostredi. Vyzaduje tuzidlo ZH 91.', je2K: true, tuzidlo: 'ZH 91', url: 'https://www.barvissimo.cz/viton?q=ZG+11' },
    { id: 'zg13', nazev: 'ZG 13 epoxidovy zaklad 2K', vydatnost: 10, cena: { 1: 450, 4: 1490, 12: 3590 }, schnutiDotyk: '10 min', schnutiDalsiVrstva: '1 hod', dobaZpracovani: '45 min', popis: 'Rychleschnouci 2K epoxid do tezkeho korozniho prostredi. Odolava trvalemu ponoru, kyselinam, zasadam. Tuzidlo ZH 91.', je2K: true, tuzidlo: 'ZH 91', url: 'https://www.barvissimo.cz/zakladni-epoxydova-barva-zg-13ral-7035-12kg' },
  ],
  vrchni: [
    { id: 'ke20', nazev: 'KE 20 alkydovy email 3v1', vydatnost: 12, cena: { 0.8: 259, 2.5: 649, 9: 1990 }, schnutiDotyk: '30 min', schnutiDalsiVrstva: '15 min strik / 16 hod stetec', popis: 'Samozakladujici alkydova barva 3v1. Vnitrni a venkovni natery oceli, kontejneru, palet.', je3v1: true, url: 'https://www.barvissimo.cz/viton?q=KE+20' },
    { id: 'ke30', nazev: 'KE 30 alkydovy email 3v1', vydatnost: 12, cena: { 0.8: 259, 2.5: 649, 9: 1990 }, schnutiDotyk: '35 min', schnutiDalsiVrstva: '35 min strik / 16 hod stetec', popis: 'Samozakladujici alkydova barva 3v1 pro konstrukce, haly, kontejnery, palety, drevo.', je3v1: true, url: 'https://www.barvissimo.cz/viton?q=KE+30' },
    { id: 'ke31', nazev: 'KE 31 alkyduretanovy email 3v1', vydatnost: 10.8, cena: { 0.7: 219, 3.5: 880, 10: 2290 }, schnutiDotyk: '3 hod', schnutiDalsiVrstva: '1 hod strik / 16 hod stetec', popis: 'Vyssi stalobalevnost a zivotnost nez KE 30. Lze pouzit na plochy v kontaktu s potravinami.', je3v1: true, url: 'https://www.barvissimo.cz/samozakladujici-3v1-barva-ke-31-ral-7016-3-5kg' },
    { id: 'ke54', nazev: 'KE 54 alkyduretanovy email 3v1', vydatnost: 12, cena: { 0.8: 319, 2.5: 799, 9: 2490 }, schnutiDotyk: '25 min', schnutiDalsiVrstva: '40 min strik / 12 hod stetec', popis: 'Rychleschnouci 3v1 s uretanizovanym pojivem. Vyssi mechanicka odolnost.', je3v1: true, url: 'https://www.barvissimo.cz/viton?q=KE+54' },
    { id: 'ze53', nazev: 'ZE 53 synteticky email', vydatnost: 14, cena: { 0.8: 189, 2.5: 489, 9: 1390 }, schnutiDotyk: '45 min', schnutiDalsiVrstva: '45 min strik / 16 hod stetec', popis: 'Klasicky synteticky email - vyzaduje zaklad. Mozno nanaset primo na zaklady rady ZG, EG, KG.', vyzadujeZaklad: true, url: 'https://www.barvissimo.cz/viton?q=ZE+53' },
  ],
  systemy: [
    { id: 'interier', nazev: 'Bezny interior (radiatory, zabradli)', zaklad: null, vrch: 'ke31', vrstvy: 2, priprava: 'Odmastit, odstranit volnou rez dratenyum kartacem', brouseni: 'Lehce zdrsnit P120-180 pro lepsi prilnavost', postup: '2x email KE 31, mezi vrstvami min 12 hod stetcem', schnutiMeziVrstvami: '1 hod strikani / 16 hod stetec', schnutiKonecne: '7 dni plna tvrdost', popis: 'Samozakladujici alkyduretanovy email - bez zakladu, atest pro potraviny' },
    { id: 'exterier', nazev: 'Bezny exterier (ploty, brany)', zaklad: 'eg11', vrch: 'ze53', vrstvy: 3, priprava: 'Odstranit rez az na cisty kov, odmastit', brouseni: 'P80-120 rucne nebo bruskou, zaklad prebrousit P180', postup: '1x zaklad EG 11 + 2x vrchni ZE 53', schnutiMeziVrstvami: '16 hod po zakladu, 45 min mezi vrchnimi (strik)', schnutiKonecne: '7 dni plna tvrdost', popis: 'Ekonomicky system - jednoslozkov zaklad + synteticky email' },
    { id: 'rychly', nazev: 'Rychly nater (casova tisen)', zaklad: null, vrch: 'ke54', vrstvy: 2, priprava: 'Odmastit, okartacovat volnou rez', brouseni: 'Drateny kartac nebo P80-120', postup: '2x KE 54, druha vrstva uz po 40 min strikanim', schnutiMeziVrstvami: '40 min strikani / 12 hod stetec', schnutiKonecne: '7 dni', popis: 'Nejrychlejsi system - alkyduretanovy 3v1 email' },
    { id: 'prumysl', nazev: 'Prumysl / tezka koroze', zaklad: 'zg13', vrch: 'ke31', vrstvy: 3, priprava: 'Otryskavat na Sa 2.5 nebo mechanicky odstranit rez, odmastit', brouseni: 'Po otryskani bez brouseni, zaklad prebrousit P180', postup: '1x zaklad ZG 13 (2K) + 2x email KE 31', schnutiMeziVrstvami: 'Zaklad 1 hod, email 40 min (strik)', schnutiKonecne: '7 dni, chemicka odolnost', popis: '2K epoxidovy zaklad + kvalitni vrchni email', je2K: true },
  ],
  vodaBarvy: [
    { id: 'hae30', nazev: 'HAE 30 vodouredelna 3v1 polomat', vydatnost: 7.4, cena: { 0.7: 195, 3: 739 }, schnutiDotyk: '30 min', schnutiDalsiVrstva: '30 min strik / 6 hod stetec', popis: 'Samozakladujici akrylatova barva bez zapachu. Radiatory, okapy, strechy, zabradli, pozink, hlinik, plasty. RAL 9016 certifikovan pro styk s potravinami.', je3v1: true, jeVoda: true, vzhled: 'polomat', url: 'https://www.barvissimo.cz/vodoureditelna-barva-hae-30-3kg-3v1' },
    { id: 'hae34', nazev: 'HAE 34 vodouredelna 3v1 lesk', vydatnost: 7.4, cena: { 0.7: 195, 3: 739 }, schnutiDotyk: '30 min', schnutiDalsiVrstva: '30 min strik / 6 hod stetec', popis: 'Leskla verze HAE 30. Samozakladujici akrylatova barva bez zapachu. Na ocel, pozink, hlinik, med, nerez, plasty, drevo, beton.', je3v1: true, jeVoda: true, vzhled: 'lesk', url: 'https://www.barvissimo.cz/viton?q=HAE+34' },
    { id: 'hag08', nazev: 'HAG 08 vodouredelna 2v1', vydatnost: 8, cena: { 0.7: 179, 3: 649 }, schnutiDotyk: '20 min', schnutiDalsiVrstva: '20 min strik / 4 hod stetec', popis: 'Zakladni a vrchni akrylatova barva 2v1. Odlitky, konstrukce, ploty, okapy, strechy, podlahy. Lze pretirat HAE 30/34.', je2v1: true, jeVoda: true, vzhled: 'polomat', url: 'https://www.barvissimo.cz/viton?q=HAG+08' },
  ],
  vodaSystemy: [
    { id: 'voda_interier', nazev: 'Interior bez zapachu (radiatory)', zaklad: null, vrch: 'hae30', vrstvy: 2, priprava: 'Odmastit CL 07, odstranit volnou rez', brouseni: 'Zdrsnit P120-180', postup: '2x HAE 30, bez zapachu - idealni pro bydlene prostory', schnutiMeziVrstvami: '30 min strik / 6 hod stetec', schnutiKonecne: '24-48 hod', popis: 'Vodouredelna 3v1 barva, bez zapachu, certifikat pro potraviny', jeVoda: true },
    { id: 'voda_exterier', nazev: 'Exterier eko (okapy, strechy)', zaklad: null, vrch: 'hae34', vrstvy: 2, priprava: 'Odmastit CL 07, mechanicky odstranit rez', brouseni: 'P80-120, pozink bez brouseni', postup: '2-3x HAE 34, na pozink a hlinik primo bez zakladu', schnutiMeziVrstvami: '30 min strik / 6 hod stetec', schnutiKonecne: '48 hod pred destem', popis: 'Leskla vodouredelna barva na strechy, okapy, parapety', jeVoda: true },
    { id: 'voda_zaklad', nazev: 'Se zakladem (vyssi ochrana)', zaklad: 'hag08', vrch: 'hae30', vrstvy: 3, priprava: 'Odmastit CL 07, dukladne odstranit rez', brouseni: 'P80-120, zaklad prebrousit P180', postup: '1x zaklad HAG 08 + 2x vrchni HAE 30', schnutiMeziVrstvami: 'Zaklad 4 hod, vrchni 6 hod (stetec)', schnutiKonecne: '48-72 hod', popis: 'Kompletni vodouredelny system pro narocnejsi podminky', jeVoda: true },
    { id: 'voda_rychly', nazev: 'Rychly nater strikanim', zaklad: null, vrch: 'hae30', vrstvy: 2, priprava: 'Odmastit, okartacovat', brouseni: 'Drateny kartac nebo P120', postup: '2x HAE 30 strikanim, druha vrstva uz po 30 min', schnutiMeziVrstvami: '30 min strikanim', schnutiKonecne: '24 hod', popis: 'Nejrychlejsi vodouredelny system pro strikani', jeVoda: true },
  ],
  eshopUrl: 'https://www.barvissimo.cz/viton'
};

const jupolProdukty = {
  barvy: [
    { id: 'classic', nazev: 'Jupol Classic', vydatnost: 10, cena: { 2: 189, 5: 399, 10: 699, 15: 949 }, schnutiDotyk: '2 hod', schnutiDalsiVrstva: '4 hod', popis: 'Základní interiérová barva od roku 1969. Vysoká paropropustnost, vysoká bělost. Není omyvatelná.', vrstvy: 2 },
    { id: 'citro', nazev: 'Jupol Citro', vydatnost: 10, cena: { 2: 249, 5: 529, 10: 929, 15: 1249 }, schnutiDotyk: '2 hod', schnutiDalsiVrstva: '4 hod', popis: 'Protiplísňová barva s citrusovou vůní. Pro koupelny, kuchyně, sklepy, prádelny.', vrstvy: 2 },
    { id: 'latex', nazev: 'Jupol Latex Semi Matt', vydatnost: 9, cena: { 2: 319, 5: 679, 10: 1199, 15: 1599 }, schnutiDotyk: '1 hod', schnutiDalsiVrstva: '4 hod', popis: 'Omyvatelná latexová barva. Odolná proti otěru za mokra. Pro chodby, schodiště, dětské pokoje.', vrstvy: 2 },
    { id: 'gold', nazev: 'Jupol Gold', vydatnost: 12, cena: { 2: 379, 5: 819, 10: 1449, 15: 1949 }, schnutiDotyk: '1 hod', schnutiDalsiVrstva: '4 hod', popis: 'Prémiová barva s nejvyšší kryvostí. Antibakteriální. Jednovrstvá aplikace.', vrstvy: 1 },
    { id: 'block', nazev: 'Jupol Block', vydatnost: 8, cena: { 2: 429, 5: 929, 10: 1649 }, schnutiDotyk: '1 hod', schnutiDalsiVrstva: '4 hod', popis: 'Blokovací barva - zakryje skvrny od nikotinu, sazí, fixu, proteklou vodu.', vrstvy: 2 },
    { id: 'thermo', nazev: 'Jupol Thermo', vydatnost: 8, cena: { 5: 949, 10: 1699, 15: 2349 }, schnutiDotyk: '2 hod', schnutiDalsiVrstva: '4 hod', popis: 'Termoizolační barva s keramickými mikrosférami. Snižuje tepelné mosty, zabraňuje rosení.', vrstvy: 2 },
  ],
  penetrace: [
    { id: 'akril', nazev: 'JUB Akril Emulze', vydatnost: 15, cena: { 1: 99, 5: 319, 10: 549 }, schnuti: '4-6 hod', popis: 'Hloubková penetrace pro savé podklady. Ředí se vodou 1:1. Snižuje savost, zlepšuje přilnavost.' },
    { id: 'primer', nazev: 'Jupol Primer', vydatnost: 12, cena: { 1: 139, 5: 499, 10: 879 }, schnuti: '12-24 hod', popis: 'Pigmentovaný základní nátěr. Sjednocuje podklad, zvyšuje kryvost vrchního nátěru.' },
  ],
  podklady: [
    { id: 'novy', nazev: 'Nová omítka (savá)', penetrace: true, spotreba: 1.2, priprava: 'Nechat vyschnout min 4 týdny, opraškovité části odstranit', brouseni: 'Není potřeba' },
    { id: 'stary', nazev: 'Starý nátěr (nesavý)', penetrace: false, spotreba: 1.0, priprava: 'Omýt od prachu, odstranit odlupující se části', brouseni: 'Zdrsnit lesklé povrchy P150' },
    { id: 'sdk', nazev: 'Sádrokarton', penetrace: true, spotreba: 1.1, priprava: 'Přetmelit spoje a hlavičky šroubů, nechat preschnout', brouseni: 'Přebrousit tmel P120-150' },
    { id: 'beton', nazev: 'Beton', penetrace: true, spotreba: 1.3, priprava: 'Odstranit separační prostředky, nechat vyzrát min 28 dní', brouseni: 'Odstranit cementové mléko' },
  ]
};

const iclaProdukty = {
  lazury: [
    { id: 'lw400', nazev: 'LW400 lazura s voskem', vydatnost: 10, cena: { 1: 389, 2.5: 849, 5: 1549 }, vrstvy: 2, schnutiDotyk: '2-3 hod', schnutiDalsiVrstva: '6-8 hod', popis: 'Vodouředitelná tenkovrstvá impregnační lazura s voskovým efektem. Exteriér i interiér. Vydatnost 8-12 m²/l.' },
    { id: 'lw400bezb', nazev: 'LW400 bezbarvá', vydatnost: 10, cena: { 1: 389, 2.5: 849, 5: 1549 }, vrstvy: 2, schnutiDotyk: '2-3 hod', schnutiDalsiVrstva: '6-8 hod', popis: 'Bezbarvá lazura - POUZE pro interiér! V exteriéru bez UV ochrany rychle degraduje.' },
  ],
  laky: [
    { id: 'fani510', nazev: 'FANI510 (117.51) PU lak', vydatnost: 10, cena: { 1: 649, 5: 2790 }, vrstvy: 2, schnutiDotyk: '30 min', schnutiDalsiVrstva: '4 hod', dobaZpracovani: '4 hod', popis: 'Nežloutnoucí základní i vrchní lak. Pro otevřené i zavřené póry. Tužidlo C48 (20%).', je2K: true, tuzidlo: 'C48' },
    { id: 'opni600', nazev: 'OPNI600.30 (QT234-30) lak', vydatnost: 10, cena: { 1: 719, 5: 3090 }, vrstvy: 2, schnutiDotyk: '30 min', schnutiDalsiVrstva: '4 hod', dobaZpracovani: '4 hod', popis: 'Nežloutnoucí vrchní lak polomat 30. Atest pro dětský nábytek. Tužidlo C48.', je2K: true, tuzidlo: 'C48' },
    { id: '271', nazev: '271.00.05 podlahový olejolak', vydatnost: 12, cena: { 5: 1890 }, vrstvy: 3, schnutiDotyk: '4 hod', schnutiDalsiVrstva: '24 hod', popis: 'Podlahový olejolak pro interiér i exteriér. Vysoká mechanická odolnost, odolnost vodě. Mat 5.' },
  ],
  emaily: [
    { id: 'pfp753', nazev: 'PFP 753.01 bílý základ', vydatnost: 6, cena: { 1: 549, 5: 2290 }, vrstvy: 2, schnutiDotyk: '15 min', schnutiDalsiVrstva: '6-8 hod, brus po 12 hod', dobaZpracovani: '2 hod', popis: 'Vysokoplnící bílý základ na MDF a dřevo. Tužidlo C131 (30%). Brousit P320-400.', je2K: true, tuzidlo: 'C131' },
    { id: 'po3', nazev: 'PO 3 PU email RAL/NCS', vydatnost: 8, cena: { 1: 749, 5: 3190 }, vrstvy: 1, schnutiDotyk: '30 min', schnutiDalsiVrstva: '4 hod', dobaZpracovani: '3 hod', popis: 'Krycí 2K polyuretanový email v odstínech RAL/NCS. Tužidlo C51 (50%).', je2K: true, tuzidlo: 'C51' },
  ],
  systemy: [
    { id: 'exterier', nazev: 'Exteriér - palubky, ploty', produkt: 'lw400', vrstvy: 3, priprava: 'Očistit od prachu a nečistot. Dřevo suché (max 18% vlhkost)', brouseni: 'P100-120 ve směru vláken, mezi vrstvami P180-240 nebo ocelová vlna', postup: '2-3× lazura LW400, nanášet "do sucha", nevytvářet film', schnutiMeziVrstvami: '6-8 hod, nebo 40-70 min bez mezibrusu', schnutiKonecne: '48 hod před deštěm', popis: 'Lazura LW400 s voskem. Obnova po 2-4 letech dle expozice.' },
    { id: 'interier', nazev: 'Interiér - obklady, nábytek', produkt: 'lw400bezb', vrstvy: 2, priprava: 'Odstranit prach, mastnotu. Dřevo suché.', brouseni: 'P120-150, mezi vrstvami P240', postup: '2× bezbarvá lazura LW400', schnutiMeziVrstvami: '6-8 hod', schnutiKonecne: '24 hod', popis: 'Bezbarvá lazura pro přirozený vzhled dřeva. Pouze interiér!' },
    { id: 'nabytek', nazev: 'Nábytek - lakovaný (PU)', produkt: 'fani510', vrstvy: 3, priprava: 'Přesné zbroušení, odstranění prachu stlač. vzduchem', brouseni: 'Podklad P150-180, základ P320-400, před vrchem P400', postup: '1-2× FANI510 základ + 1× OPNI600.30 vrch. Tužidlo C48 20%.', schnutiMeziVrstvami: '4 hod', schnutiKonecne: '7 dní plná tvrdost', popis: 'Profesionální nežloutnoucí PU systém', je2K: true },
    { id: 'podlaha', nazev: 'Dřevěná podlaha', produkt: '271', vrstvy: 3, priprava: 'Zbrousit starý nátěr až na dřevo, vysávat prach', brouseni: 'P80-100 bruskou, P120 finální, mezi vrstvami P180-240', postup: '2-3× olejolak 271.00.05, 1. vrstva lze zředit 10-20%', schnutiMeziVrstvami: '24 hod', schnutiKonecne: '7 dní před plnou zátěží', popis: 'Olejolak 271.00.05 - vysoká mechanická odolnost' },
    { id: 'mdf', nazev: 'MDF - krycí email RAL', produkt: 'pfp753', vrstvy: 4, priprava: 'Očistit od prachu, hrany zaoblit (MDF saje na hranách)', brouseni: 'MDF P180, po izol. P220, základ P320-400', postup: '1× izolátor IS100, 1-2× základ PFP753 (tuž. C131 30%), 1× email PO3 (tuž. C51 50%)', schnutiMeziVrstvami: 'Izolátor 6-8 hod, základ 12 hod před brusem', schnutiKonecne: '7-14 dní', popis: 'Profesionální krycí systém: izolátor + základ + email', je2K: true },
  ]
};

// === POMOCNÉ FUNKCE ===
function najdiBaleni(potreba, cenik) {
  const bal = Object.keys(cenik).map(Number).sort((a, b) => b - a);
  let zbyva = potreba;
  const vys = [];
  for (const v of bal) { while (zbyva >= v * 0.7) { vys.push(v); zbyva -= v; } }
  if (zbyva > 0) vys.push(Math.min(...bal));
  return { baleni: vys, cena: vys.reduce((s, v) => s + cenik[v], 0) };
}
function vypoctiCenuZaSpotrebu(potreba, cenik) {
  const bal = Object.keys(cenik).map(Number).sort((a, b) => a - b);
  const nejmensi = bal[0];
  const cenaZaJednotku = cenik[nejmensi] / nejmensi;
  return Math.round(potreba * cenaZaJednotku);
}
function formatCena(c) { return c.toLocaleString('cs-CZ') + ' Kc'; }
function infoTooltip(text) { return '<span class="info-tooltip" tabindex="0">i<span class="info-tooltip-content">' + text + '</span></span>'; }

// === NAVIGACE ===
function showPage(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); }
function selectBarvyTab(tab, el) { document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active')); el.classList.add('active'); document.getElementById('kovContent').style.display = tab === 'kov' ? 'block' : 'none'; document.getElementById('stenyContent').style.display = tab === 'steny' ? 'block' : 'none'; document.getElementById('drevoContent').style.display = tab === 'drevo' ? 'block' : 'none'; }

// === KOV ===
let kovRezim = 'system', kovSystem = 'exterier', kovTyp = 'rozpoustedlo';
function setKovTyp(typ, el) {
  kovTyp = typ;
  document.getElementById('kovTypRozp').classList.toggle('active', typ === 'rozpoustedlo');
  document.getElementById('kovTypVoda').classList.toggle('active', typ === 'voda');
  kovSystem = typ === 'voda' ? 'voda_interier' : 'exterier';
  renderKovSystemy();
  renderKovVlastni();
  vypoctiKov();
}
function setKovRezim(rezim, el) { kovRezim = rezim; el.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); document.getElementById('kovSystemy').style.display = rezim === 'system' ? 'block' : 'none'; document.getElementById('kovVlastni').style.display = rezim === 'vlastni' ? 'block' : 'none'; vypoctiKov(); }
function renderKovSystemy() {
  const systemy = kovTyp === 'voda' ? vitonProdukty.vodaSystemy : vitonProdukty.systemy;
  document.getElementById('kovSystemyList').innerHTML = systemy.map(s => '<div class="option ' + (kovSystem === s.id ? 'active' : '') + '" onclick="selectKovSystem(\'' + s.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + s.nazev + infoTooltip(s.popis) + '</div></div><div class="option-meta">' + (s.je2K ? '<span class="badge">2K</span>' : '') + (s.jeVoda ? '<span class="badge badge-blue">H2O</span>' : '') + '<span class="option-vrstvy">' + s.vrstvy + 'v</span></div></div>').join('');
  renderKovSystemDetail();
}
function selectKovSystem(id) { kovSystem = id; renderKovSystemy(); vypoctiKov(); }
function renderKovSystemDetail() {
  const systemy = kovTyp === 'voda' ? vitonProdukty.vodaSystemy : vitonProdukty.systemy;
  const s = systemy.find(x => x.id === kovSystem);
  if (!s) return;
  document.getElementById('kovSystemDetail').innerHTML = '<div class="detail-panel"><div class="detail-panel-title">Postup aplikace</div><div class="detail-row"><span class="detail-label">Priprava</span><span class="detail-value">' + s.priprava + '</span></div><div class="detail-row"><span class="detail-label">Brouseni</span><span class="detail-value">' + s.brouseni + '</span></div><div class="detail-row"><span class="detail-label">Postup (' + s.vrstvy + ' vrstvy)</span><span class="detail-value">' + s.postup + '</span></div><div class="detail-row"><span class="detail-label">Mezi vrstvami</span><span class="detail-value">' + s.schnutiMeziVrstvami + '</span></div><div class="detail-row"><span class="detail-label">Konecne schnuti</span><span class="detail-value">' + s.schnutiKonecne + '</span></div>' + (s.je2K ? '<div class="detail-warning">2K system - nutne tuzidlo, dodrzet pomer michani a dobu zpracovani!</div>' : '') + (s.jeVoda ? '<div class="detail-warning" style="background:rgba(59,130,246,0.1);border-color:#93c5fd;color:#3b82f6;">Vodouredelna barva - bez zapachu, reditelna vodou, eko!</div>' : '') + '</div>';
}
function renderKovVlastni() {
  if (kovTyp === 'voda') {
    document.getElementById('kovZaklad').innerHTML = '<option value="zadny">Bez zakladu (pouzit 3v1)</option>' + vitonProdukty.vodaBarvy.filter(b => b.je2v1).map(z => '<option value="' + z.id + '">' + z.nazev + '</option>').join('');
    document.getElementById('kovVrchni').innerHTML = vitonProdukty.vodaBarvy.filter(b => b.je3v1).map(v => '<option value="' + v.id + '">' + v.nazev + ' (' + v.vzhled + ')</option>').join('');
  } else {
    document.getElementById('kovZaklad').innerHTML = '<option value="zadny">Bez zakladu (pouzit 3v1)</option>' + vitonProdukty.zaklady.map(z => '<option value="' + z.id + '">' + z.nazev + ' ' + (z.je2K ? '(2K)' : '(1K)') + '</option>').join('');
    document.getElementById('kovVrchni').innerHTML = vitonProdukty.vrchni.map(v => '<option value="' + v.id + '">' + v.nazev + ' ' + (v.je3v1 ? '(3v1)' : '') + '</option>').join('');
  }
}
function vypoctiKov() {
  const plocha = parseFloat(document.getElementById('kovPlocha').value) || 0;
  const rezerva = parseInt(document.getElementById('kovRezerva').value) || 10;
  if (plocha <= 0) { document.getElementById('kovResult').innerHTML = ''; return; }
  const plochaR = plocha * (1 + rezerva / 100);
  let zaklad = null, vrchni = null, vrstvy = 2;
  
  if (kovTyp === 'voda') {
    if (kovRezim === 'system') {
      const sys = vitonProdukty.vodaSystemy.find(s => s.id === kovSystem);
      if (sys.zaklad) zaklad = vitonProdukty.vodaBarvy.find(z => z.id === sys.zaklad);
      vrchni = vitonProdukty.vodaBarvy.find(v => v.id === sys.vrch);
      vrstvy = sys.vrstvy;
    } else {
      const zakladId = document.getElementById('kovZaklad').value;
      if (zakladId !== 'zadny') zaklad = vitonProdukty.vodaBarvy.find(z => z.id === zakladId);
      vrchni = vitonProdukty.vodaBarvy.find(v => v.id === document.getElementById('kovVrchni').value);
      vrstvy = zaklad ? 3 : 2;
    }
  } else {
    if (kovRezim === 'system') {
      const sys = vitonProdukty.systemy.find(s => s.id === kovSystem);
      if (sys.zaklad) zaklad = vitonProdukty.zaklady.find(z => z.id === sys.zaklad);
      vrchni = vitonProdukty.vrchni.find(v => v.id === sys.vrch);
      vrstvy = sys.vrstvy;
    } else {
      const zakladId = document.getElementById('kovZaklad').value;
      if (zakladId !== 'zadny') zaklad = vitonProdukty.zaklady.find(z => z.id === zakladId);
      vrchni = vitonProdukty.vrchni.find(v => v.id === document.getElementById('kovVrchni').value);
      vrstvy = zaklad ? 3 : 2;
    }
  }
  
  const polozky = [];
  let celkem = 0;
  let celkemSpotrebaKc = 0;
  if (zaklad) {
    const potreba = plochaR / zaklad.vydatnost;
    const bal = najdiBaleni(potreba, zaklad.cena);
    const cenaSpotrebaKc = vypoctiCenuZaSpotrebu(potreba, zaklad.cena);
    polozky.push({ ...zaklad, potreba: potreba.toFixed(2), baleni: bal.baleni.join('+') + (kovTyp === 'voda' ? 'kg' : 'l'), cenaBaleni: bal.cena, cenaSpotrebaKc: cenaSpotrebaKc });
    celkem += bal.cena;
    celkemSpotrebaKc += cenaSpotrebaKc;
  }
  if (vrchni) {
    const pocetVrstev = zaklad ? vrstvy - 1 : vrstvy;
    const potreba = (plochaR * pocetVrstev) / vrchni.vydatnost;
    const bal = najdiBaleni(potreba, vrchni.cena);
    const cenaSpotrebaKc = vypoctiCenuZaSpotrebu(potreba, vrchni.cena);
    polozky.push({ ...vrchni, potreba: potreba.toFixed(2), baleni: bal.baleni.join('+') + (kovTyp === 'voda' ? 'kg' : 'l'), cenaBaleni: bal.cena, cenaSpotrebaKc: cenaSpotrebaKc });
    celkem += bal.cena;
    celkemSpotrebaKc += cenaSpotrebaKc;
  }
  document.getElementById('kovResult').innerHTML = '<div class="result"><div class="card-title">Kalkulace' + (kovTyp === 'voda' ? ' (vodouredelne)' : '') + '</div>' + polozky.map(p => '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + (p.url ? '<a href="' + p.url + '" target="_blank" style="color:inherit;text-decoration:underline;">' + p.nazev + '</a>' : p.nazev) + infoTooltip(p.popis) + '</div><div class="result-item-detail">' + p.potreba + (kovTyp === 'voda' ? 'kg' : 'l') + ' (koupit ' + p.baleni + ')</div><div class="result-item-schnuti">Schnuti: ' + p.schnutiDotyk + ' dotyk | ' + p.schnutiDalsiVrstva + ' dalsi vrstva</div><div class="result-item-badges">' + (p.je2K ? '<span class="badge badge-yellow">2K + ' + p.tuzidlo + '</span>' : '') + (p.je1K ? '<span class="badge badge-blue">1K</span>' : '') + (p.je3v1 ? '<span class="badge badge-green">3v1</span>' : '') + (p.je2v1 ? '<span class="badge badge-green">2v1</span>' : '') + (p.jeVoda ? '<span class="badge badge-blue">H2O</span>' : '') + '</div></div><div class="result-item-price">' + formatCena(p.cenaSpotrebaKc) + '</div></div>').join('') + '<div class="result-total"><span class="result-total-label">CELKEM</span><span class="result-total-value">' + formatCena(celkemSpotrebaKc) + '</span></div><div class="result-per-m2">' + Math.round(celkemSpotrebaKc / plocha) + ' Kc/m2</div><div style="text-align:center;margin-top:8px;font-size:11px;color:#888;">Nakup: ' + formatCena(celkem) + ' (min. baleni)</div><div style="text-align:center;margin-top:8px;"><a href="' + vitonProdukty.eshopUrl + '" target="_blank" style="color:var(--gold-dark);font-size:11px;">Koupit na Barvissimo.cz</a></div></div>';
}

// === STĚNY ===
let stenyPodklad = 'novy', stenyBarva = 'classic';
function renderStenyPodklady() { document.getElementById('stenyPodkladyList').innerHTML = jupolProdukty.podklady.map(p => '<div class="podklad-item ' + (stenyPodklad === p.id ? 'active' : '') + '" onclick="selectStenyPodklad(\'' + p.id + '\')"><div class="podklad-item-name">' + p.nazev + '</div>' + (p.penetrace ? '<div class="podklad-item-note">+ penetrace</div>' : '') + '</div>').join(''); renderStenyPodkladDetail(); }
function selectStenyPodklad(id) { stenyPodklad = id; renderStenyPodklady(); renderStenyPenetrace(); vypoctiSteny(); }
function renderStenyPodkladDetail() { const p = jupolProdukty.podklady.find(x => x.id === stenyPodklad); if (!p) return; document.getElementById('stenyPodkladDetail').innerHTML = '<div class="detail-panel" style="margin-top:12px;"><div class="detail-row"><span class="detail-label">Příprava</span><span class="detail-value">' + p.priprava + '</span></div><div class="detail-row"><span class="detail-label">Broušení</span><span class="detail-value">' + p.brouseni + '</span></div></div>'; }
function renderStenyBarvy() { document.getElementById('stenyBarvyList').innerHTML = jupolProdukty.barvy.map(b => '<div class="option ' + (stenyBarva === b.id ? 'active' : '') + '" onclick="selectStenyBarva(\'' + b.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + b.nazev + ' (' + b.vrstvy + 'v)' + infoTooltip(b.popis) + '</div><div class="option-desc">Schnutí: ' + b.schnutiDotyk + ' dotyk | ' + b.schnutiDalsiVrstva + ' další vrstva</div></div><div class="option-meta"><span class="option-vrstvy">od ' + Math.min(...Object.values(b.cena)) + ' Kč</span></div></div>').join(''); }
function selectStenyBarva(id) { stenyBarva = id; renderStenyBarvy(); vypoctiSteny(); }
function renderStenyPenetrace() { const podklad = jupolProdukty.podklady.find(p => p.id === stenyPodklad); const section = document.getElementById('stenyPenetraceSection'); if (podklad && podklad.penetrace) { section.style.display = 'block'; document.getElementById('stenyPenetrace').innerHTML = jupolProdukty.penetrace.map(p => '<option value="' + p.id + '">' + p.nazev + ' (schnutí ' + p.schnuti + ')</option>').join(''); } else { section.style.display = 'none'; } }
function vypoctiSteny() { const plocha = parseFloat(document.getElementById('stenyPlocha').value) || 0; const rezerva = parseInt(document.getElementById('stenyRezerva').value) || 10; if (plocha <= 0) { document.getElementById('stenyResult').innerHTML = ''; return; } const plochaR = plocha * (1 + rezerva / 100); const barva = jupolProdukty.barvy.find(b => b.id === stenyBarva); const podklad = jupolProdukty.podklady.find(p => p.id === stenyPodklad); const penetraceId = document.getElementById('stenyPenetrace').value; const penetrace = jupolProdukty.penetrace.find(p => p.id === penetraceId); const polozky = []; let celkem = 0; if (podklad.penetrace && penetrace) { const potreba = plochaR / penetrace.vydatnost; const bal = najdiBaleni(potreba, penetrace.cena); polozky.push({ ...penetrace, potreba: potreba.toFixed(2), baleni: bal.baleni.join('+') + 'l', cenaBaleni: bal.cena }); celkem += bal.cena; } if (barva) { const potreba = plochaR * barva.vrstvy * podklad.spotreba * 0.1; const bal = najdiBaleni(potreba, barva.cena); polozky.push({ ...barva, potreba: potreba.toFixed(2), baleni: bal.baleni.join('+') + 'l', cenaBaleni: bal.cena }); celkem += bal.cena; } document.getElementById('stenyResult').innerHTML = '<div class="result"><div class="card-title">Kalkulace</div>' + polozky.map(p => '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + infoTooltip(p.popis) + '</div><div class="result-item-detail">' + p.potreba + 'l = ' + p.baleni + (p.vrstvy ? ' (' + p.vrstvy + 'v)' : '') + '</div></div><div class="result-item-price">' + formatCena(p.cenaBaleni) + '</div></div>').join('') + '<div class="result-total"><span class="result-total-label">CELKEM</span><span class="result-total-value">' + formatCena(celkem) + '</span></div><div class="result-per-m2">' + Math.round(celkem / plocha) + ' Kč/m²</div></div>'; }

// === DŘEVO ===
let drevoRezim = 'system', drevoSystem = 'exterier';
function setDrevoRezim(rezim, el) { drevoRezim = rezim; el.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active')); el.classList.add('active'); document.getElementById('drevoSystemy').style.display = rezim === 'system' ? 'block' : 'none'; document.getElementById('drevoVlastni').style.display = rezim === 'vlastni' ? 'block' : 'none'; vypoctiDrevo(); }
function renderDrevoSystemy() { document.getElementById('drevoSystemyList').innerHTML = iclaProdukty.systemy.map(s => '<div class="option ' + (drevoSystem === s.id ? 'active' : '') + '" onclick="selectDrevoSystem(\'' + s.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + s.nazev + infoTooltip(s.popis) + '</div></div><div class="option-meta">' + (s.je2K ? '<span class="badge">2K</span>' : '') + '<span class="option-vrstvy">' + s.vrstvy + 'v</span></div></div>').join(''); renderDrevoSystemDetail(); }
function selectDrevoSystem(id) { drevoSystem = id; renderDrevoSystemy(); vypoctiDrevo(); }
function renderDrevoSystemDetail() { const s = iclaProdukty.systemy.find(x => x.id === drevoSystem); if (!s) return; document.getElementById('drevoSystemDetail').innerHTML = '<div class="detail-panel"><div class="detail-panel-title">Postup aplikace</div><div class="detail-row"><span class="detail-label">Příprava</span><span class="detail-value">' + s.priprava + '</span></div><div class="detail-row"><span class="detail-label">Broušení</span><span class="detail-value">' + s.brouseni + '</span></div><div class="detail-row"><span class="detail-label">Postup (' + s.vrstvy + ' vrstvy)</span><span class="detail-value">' + s.postup + '</span></div><div class="detail-row"><span class="detail-label">Mezi vrstvami</span><span class="detail-value">' + s.schnutiMeziVrstvami + '</span></div><div class="detail-row"><span class="detail-label">Konečné schnutí</span><span class="detail-value">' + s.schnutiKonecne + '</span></div>' + (s.je2K ? '<div class="detail-warning">2K systém - nutné tužidlo, dodržet poměr míchání a dobu zpracování!</div>' : '') + '</div>'; }
function renderDrevoVlastni() { const vse = [...iclaProdukty.lazury, ...iclaProdukty.laky, ...iclaProdukty.emaily]; document.getElementById('drevoProdukt').innerHTML = '<optgroup label="Lazury">' + iclaProdukty.lazury.map(p => '<option value="' + p.id + '">' + p.nazev + '</option>').join('') + '</optgroup><optgroup label="Laky (2K)">' + iclaProdukty.laky.map(p => '<option value="' + p.id + '">' + p.nazev + '</option>').join('') + '</optgroup><optgroup label="Emaily (2K)">' + iclaProdukty.emaily.map(p => '<option value="' + p.id + '">' + p.nazev + '</option>').join('') + '</optgroup>'; }
function vypoctiDrevo() { const plocha = parseFloat(document.getElementById('drevoPlocha').value) || 0; const rezerva = parseInt(document.getElementById('drevoRezerva').value) || 15; if (plocha <= 0) { document.getElementById('drevoResult').innerHTML = ''; return; } const plochaR = plocha * (1 + rezerva / 100); let produkt = null, vrstvy = 2; const vseProdukty = [...iclaProdukty.lazury, ...iclaProdukty.laky, ...iclaProdukty.emaily]; if (drevoRezim === 'system') { const sys = iclaProdukty.systemy.find(s => s.id === drevoSystem); produkt = vseProdukty.find(p => p.id === sys.produkt); vrstvy = sys.vrstvy; } else { const produktId = document.getElementById('drevoProdukt').value; produkt = vseProdukty.find(p => p.id === produktId); vrstvy = produkt?.vrstvy || 2; } if (!produkt) return; const potreba = (plochaR * vrstvy) / produkt.vydatnost; const bal = najdiBaleni(potreba, produkt.cena); document.getElementById('drevoResult').innerHTML = '<div class="result"><div class="card-title">Kalkulace</div><div class="result-item"><div class="result-item-info"><div class="result-item-name">' + produkt.nazev + infoTooltip(produkt.popis) + '</div><div class="result-item-detail">' + potreba.toFixed(2) + 'l (' + vrstvy + 'v) = ' + bal.baleni.join('+') + 'l</div><div class="result-item-schnuti">Schnutí: ' + produkt.schnutiDotyk + ' dotyk | ' + produkt.schnutiDalsiVrstva + ' další vrstva</div><div class="result-item-badges">' + (produkt.je2K ? '<span class="badge badge-yellow">2K + ' + produkt.tuzidlo + '</span>' : '') + '</div></div><div class="result-item-price">' + formatCena(bal.cena) + '</div></div><div class="result-total"><span class="result-total-label">CELKEM</span><span class="result-total-value">' + formatCena(bal.cena) + '</span></div><div class="result-per-m2">' + Math.round(bal.cena / plocha) + ' Kč/m²</div></div>'; }

// === INIT ===
document.addEventListener('DOMContentLoaded', function() { renderKovSystemy(); renderKovVlastni(); renderStenyPodklady(); renderStenyBarvy(); renderStenyPenetrace(); renderDrevoSystemy(); renderDrevoVlastni(); renderZakladyAll(); renderElektroAll(); renderPodlahyAll(); renderEticsAll(); });

// === ZÁKLADY DATABÁZE ===
const zakladyBetony = {
  'C12/15': { nazev: 'C12/15 (B15)', popis: 'Podkladní beton', cenaM3: 2450, pevnost: 15 },
  'C16/20': { nazev: 'C16/20 (B20)', popis: 'Pasy - standard', cenaM3: 2650, pevnost: 20 },
  'C20/25': { nazev: 'C20/25 (B25)', popis: 'Deska, náročnější', cenaM3: 2850, pevnost: 25 },
  'C25/30': { nazev: 'C25/30 (B30)', popis: 'Vícepodlažní', cenaM3: 3100, pevnost: 30 },
};

const zakladyKonzistence = {
  S2: { nazev: 'S2 - Zavlhlý', priplatek: 0 },
  S3: { nazev: 'S3 - Plastický', priplatek: 50 },
  S4: { nazev: 'S4 - Měkký', priplatek: 100 },
};

const zakladyZB = {
  ZB20: { nazev: 'ZB 20 (200×500×250)', sirka: 200, vyska: 250, ksM2: 8, cenaKs: 32, betonM3naM2: 0.05 },
  ZB25: { nazev: 'ZB 25 (250×500×250)', sirka: 250, vyska: 250, ksM2: 8, cenaKs: 38, betonM3naM2: 0.0625 },
  ZB30: { nazev: 'ZB 30 (300×500×250)', sirka: 300, vyska: 250, ksM2: 8, cenaKs: 45, betonM3naM2: 0.075 },
  ZB40: { nazev: 'ZB 40 (400×500×250)', sirka: 400, vyska: 250, ksM2: 8, cenaKs: 55, betonM3naM2: 0.1 },
  ZB50: { nazev: 'ZB 50 (500×500×250)', sirka: 500, vyska: 250, ksM2: 8, cenaKs: 68, betonM3naM2: 0.125 },
};

const zakladyKariSite = {
  '100x100x5': { nazev: 'KARI 100×100 d5', plocha: 6, cenaKs: 195 },
  '100x100x6': { nazev: 'KARI 100×100 d6', plocha: 6, cenaKs: 285 },
  '150x150x6': { nazev: 'KARI 150×150 d6', plocha: 6, cenaKs: 195 },
  '100x100x8': { nazev: 'KARI 100×100 d8', plocha: 6, cenaKs: 485 },
  '150x150x8': { nazev: 'KARI 150×150 d8', plocha: 6, cenaKs: 325 },
};

const zakladyRoxory = {
  R8: { nazev: 'Roxor d8 mm', cenaBm: 18 },
  R10: { nazev: 'Roxor d10 mm', cenaBm: 28 },
  R12: { nazev: 'Roxor d12 mm', cenaBm: 42 },
};

const zakladyPodsyp = {
  '0-63': { nazev: 'Štěrkodrť 0-63 mm', cenaM3: 650 },
  '0-32': { nazev: 'Štěrkopísek 0-32 mm', cenaM3: 550 },
  '16-32': { nazev: 'Štěrk 16-32 mm', cenaM3: 700 },
};

const zakladyHydroizolace = {
  'GLASTEK40': { nazev: 'GLASTEK 40 SPECIAL MINERAL', popis: 'SBS modifikovaný, skl. tkanina', cenaM2: 145, roleM2: 7.5 },
  'ELASTEK40': { nazev: 'ELASTEK 40 SPECIAL MINERAL', popis: 'SBS modifikovaný, polyester', cenaM2: 175, roleM2: 7.5 },
  'GLASTEKALU': { nazev: 'GLASTEK AL 40 MINERAL', popis: 'S hliníkovou fólií - radon', cenaM2: 195, roleM2: 7.5 },
  'DEKBIT': { nazev: 'DEKBIT V60 S35', popis: 'Oxidovaný, základní', cenaM2: 85, roleM2: 10 },
};

const zakladyProstupy = {
  kanalizace: { nazev: 'Chránička DN160 (kanalizace)', cenaKs: 185 },
  voda: { nazev: 'Chránička DN50 (voda)', cenaKs: 85 },
  elektro: { nazev: 'Chránička DN63 (elektro)', cenaKs: 95 },
  plyn: { nazev: 'Chránička DN40 (plyn)', cenaKs: 75 },
};

const zakladyCerpadlo = {
  male: { nazev: 'Pístové čerpadlo', cenaHod: 2000, minHod: 3 },
  velke: { nazev: 'Ramenová pumpa', cenaHod: 3500, minHod: 2 },
};

const zakladyPrislusenstvi = {
  distancnik: { nazev: 'Distančník pod KARI', cenaKs: 2.5, ksNaM2: 4 },
  distancnikZB: { nazev: 'Distančník do ZB', cenaKs: 3, ksNaM2: 6 },
  drat: { nazev: 'Vázací drát 1.4mm', cenaKg: 65, kgNa100m2: 2 },
  folie: { nazev: 'PE fólie 0.2mm', cenaM2: 8 },
  bedneni: { nazev: 'Bednění okrajů', cenaM2: 85 },
  vibrator: { nazev: 'Vibrátor ponorný', cenaDen: 450 },
  lista: { nazev: 'Vibrační lišta', cenaDen: 650 },
  penetrace: { nazev: 'DEKPRIMER', cenaL: 75, vydatnost: 0.3 },
  zemnPasek: { nazev: 'Zemnicí pásek FeZn 30×4', cenaBm: 85 },
  zemnSvorka: { nazev: 'Svorka SR 3b', cenaKs: 45 },
  zemnPripoj: { nazev: 'Připojovací svorka', cenaKs: 125 },
};

function renderZakladyAll() {
  // Betony pasy
  document.getElementById('zakladyBetonPasy').innerHTML = Object.entries(zakladyBetony).map(([k,v]) => '<option value="' + k + '" ' + (k === 'C16/20' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  document.getElementById('zakladyBetonZB').innerHTML = Object.entries(zakladyBetony).map(([k,v]) => '<option value="' + k + '" ' + (k === 'C20/25' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  document.getElementById('zakladyBetonDeska').innerHTML = Object.entries(zakladyBetony).map(([k,v]) => '<option value="' + k + '" ' + (k === 'C20/25' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  
  // Konzistence
  document.getElementById('zakladyKonzPasy').innerHTML = Object.entries(zakladyKonzistence).map(([k,v]) => '<option value="' + k + '" ' + (k === 'S3' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  document.getElementById('zakladyKonzDeska').innerHTML = Object.entries(zakladyKonzistence).map(([k,v]) => '<option value="' + k + '" ' + (k === 'S3' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  
  // ZB
  document.getElementById('zakladyTypZB').innerHTML = Object.entries(zakladyZB).map(([k,v]) => '<option value="' + k + '" ' + (k === 'ZB40' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  document.getElementById('zakladyRoxorZB').innerHTML = Object.entries(zakladyRoxory).map(([k,v]) => '<option value="' + k + '" ' + (k === 'R10' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  
  // KARI
  document.getElementById('zakladyTypKari').innerHTML = Object.entries(zakladyKariSite).map(([k,v]) => '<option value="' + k + '" ' + (k === '150x150x6' ? 'selected' : '') + '>' + v.nazev + ' (' + v.cenaKs + ' Kč)</option>').join('');
  
  // Podsyp
  document.getElementById('zakladyTypPodsypu').innerHTML = Object.entries(zakladyPodsyp).map(([k,v]) => '<option value="' + k + '" ' + (k === '0-63' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  
  // Hydro
  document.getElementById('zakladyTypHydro').innerHTML = Object.entries(zakladyHydroizolace).map(([k,v]) => '<option value="' + k + '" ' + (k === 'GLASTEK40' ? 'selected' : '') + '>' + v.nazev + '</option>').join('');
  
  vypoctiZaklady();
}

function toggleZakladyZB() {
  document.getElementById('zakladyZBContent').style.display = document.getElementById('zakladyPouzitZB').checked ? 'block' : 'none';
  vypoctiZaklady();
}

function toggleZakladyPodklad() {
  document.getElementById('zakladyPodkladContent').style.display = document.getElementById('zakladyPodkladniBeton').checked ? 'block' : 'none';
  vypoctiZaklady();
}

function toggleZakladyCerpadlo() {
  document.getElementById('zakladyCerpadloContent').style.display = document.getElementById('zakladyTypCerpadla').value !== 'zadne' ? 'block' : 'none';
  vypoctiZaklady();
}

function toggleZakladyVibrator() {
  document.getElementById('zakladyVibratorContent').style.display = document.getElementById('zakladyPronajemVibr').checked ? 'block' : 'none';
  vypoctiZaklady();
}

function vypoctiZaklady() {
  const delkaPasu = parseFloat(document.getElementById('zakladyDelkaPasu').value) || 0;
  const sirkaPasu = parseFloat(document.getElementById('zakladySirkaPasu').value) || 0;
  const hloubkaPasu = parseFloat(document.getElementById('zakladyHloubkaPasu').value) || 0;
  const betonPasy = document.getElementById('zakladyBetonPasy').value;
  const konzPasy = document.getElementById('zakladyKonzPasy').value;
  
  const pouzitZB = document.getElementById('zakladyPouzitZB').checked;
  const typZB = document.getElementById('zakladyTypZB').value;
  const radyZB = parseInt(document.getElementById('zakladyRadyZB').value) || 0;
  const roxorZB = document.getElementById('zakladyRoxorZB').value;
  const betonZB = document.getElementById('zakladyBetonZB').value;
  
  const plochaDesky = parseFloat(document.getElementById('zakladyPlochaDesky').value) || 0;
  const tloustkaDesky = parseFloat(document.getElementById('zakladyTloustkaDesky').value) || 0;
  const betonDeska = document.getElementById('zakladyBetonDeska').value;
  const konzDeska = document.getElementById('zakladyKonzDeska').value;
  const typKari = document.getElementById('zakladyTypKari').value;
  const dvojiteKari = document.getElementById('zakladyDvojiteKari').checked;
  
  const typPodsypu = document.getElementById('zakladyTypPodsypu').value;
  const tloustkaPodsypu = parseFloat(document.getElementById('zakladyTloustkaPodsypu').value) || 0;
  const podkladniBeton = document.getElementById('zakladyPodkladniBeton').checked;
  const tloustkaPodklad = parseFloat(document.getElementById('zakladyTloustkaPodklad').value) || 0;
  
  const typHydro = document.getElementById('zakladyTypHydro').value;
  const dvouvrstva = document.getElementById('zakladyDvouvrstva').checked;
  
  const delkaZemneni = parseFloat(document.getElementById('zakladyDelkaZemneni').value) || 0;
  const pocetSvorek = parseInt(document.getElementById('zakladyPocetSvorek').value) || 0;
  
  const prostupyKanal = parseInt(document.getElementById('zakladyProstupyKanal').value) || 0;
  const prostupyVoda = parseInt(document.getElementById('zakladyProstupyVoda').value) || 0;
  const prostupyElektro = parseInt(document.getElementById('zakladyProstupyElektro').value) || 0;
  const prostupyPlyn = parseInt(document.getElementById('zakladyProstupyPlyn').value) || 0;
  
  const typCerpadla = document.getElementById('zakladyTypCerpadla').value;
  const hodinyPumpy = parseInt(document.getElementById('zakladyHodinyPumpy').value) || 0;
  const pronajemVibr = document.getElementById('zakladyPronajemVibr').checked;
  const dnyPrace = parseInt(document.getElementById('zakladyDnyPrace').value) || 0;
  
  const polozky = [];
  let cenaBeton = 0, cenaVyztuz = 0, cenaHydro = 0, cenaDoplnky = 0;
  
  // PASY
  const objemPasu = delkaPasu * sirkaPasu * hloubkaPasu;
  const betonPasyData = zakladyBetony[betonPasy];
  const konzPasyData = zakladyKonzistence[konzPasy];
  const cenaPasuM3 = betonPasyData.cenaM3 + konzPasyData.priplatek;
  const cenaPasu = objemPasu * cenaPasuM3;
  cenaBeton += cenaPasu;
  if (objemPasu > 0) polozky.push({ kat: 'beton', nazev: betonPasyData.nazev + ' ' + konzPasyData.nazev + ' - pasy', m3: Math.ceil(objemPasu * 10) / 10, cenaJed: cenaPasuM3, cena: cenaPasu });
  
  document.getElementById('zakladyPasyInfo').innerHTML = 'Objem: ' + objemPasu.toFixed(1) + ' m³';
  
  // ZTRACENE BEDNENI
  let plochaZBm2 = 0, objemBetonuZB = 0;
  if (pouzitZB && radyZB > 0) {
    const zbData = zakladyZB[typZB];
    const vyskaZB = radyZB * (zbData.vyska / 1000);
    plochaZBm2 = delkaPasu * vyskaZB;
    const pocetKsZB = Math.ceil(plochaZBm2 * zbData.ksM2);
    const cenaZB = pocetKsZB * zbData.cenaKs;
    cenaDoplnky += cenaZB;
    polozky.push({ kat: 'material', nazev: zbData.nazev, ks: pocetKsZB, cenaJed: zbData.cenaKs, cena: cenaZB });
    
    // Beton do ZB
    objemBetonuZB = plochaZBm2 * zbData.betonM3naM2;
    const betonZBData = zakladyBetony[betonZB];
    const cenaBetonZB = objemBetonuZB * betonZBData.cenaM3;
    cenaBeton += cenaBetonZB;
    polozky.push({ kat: 'beton', nazev: betonZBData.nazev + ' - do ZB', m3: Math.ceil(objemBetonuZB * 10) / 10, cenaJed: betonZBData.cenaM3, cena: cenaBetonZB });
    
    // Roxory
    const roxorData = zakladyRoxory[roxorZB];
    const delkaVodorovna = delkaPasu * radyZB * 2;
    const delkaSvisla = Math.ceil(delkaPasu / 0.5) * (vyskaZB + 0.3);
    const delkaRoxoruCelkem = delkaVodorovna + delkaSvisla;
    const cenaRoxoru = delkaRoxoruCelkem * roxorData.cenaBm;
    cenaVyztuz += cenaRoxoru;
    polozky.push({ kat: 'vyztuz', nazev: roxorData.nazev + ' do ZB', bm: Math.ceil(delkaRoxoruCelkem), cenaJed: roxorData.cenaBm, cena: cenaRoxoru });
    
    // Distančníky ZB
    const distZB = Math.ceil(plochaZBm2 * zakladyPrislusenstvi.distancnikZB.ksNaM2);
    cenaDoplnky += distZB * zakladyPrislusenstvi.distancnikZB.cenaKs;
    polozky.push({ kat: 'material', nazev: zakladyPrislusenstvi.distancnikZB.nazev, ks: distZB, cenaJed: zakladyPrislusenstvi.distancnikZB.cenaKs, cena: distZB * zakladyPrislusenstvi.distancnikZB.cenaKs });
    
    document.getElementById('zakladyZBInfo').innerHTML = 'Výška: ' + (radyZB * 25) + ' cm | Plocha: ' + plochaZBm2.toFixed(1) + ' m²';
  }
  
  // PODSYP
  const plochaVnitrni = Math.max(0, plochaDesky - (delkaPasu * sirkaPasu));
  const objemPodsypu = plochaVnitrni * tloustkaPodsypu;
  const podsypData = zakladyPodsyp[typPodsypu];
  const cenaPodsypu = objemPodsypu * podsypData.cenaM3;
  cenaDoplnky += cenaPodsypu;
  if (objemPodsypu > 0) polozky.push({ kat: 'material', nazev: podsypData.nazev, m3: Math.ceil(objemPodsypu * 10) / 10, cenaJed: podsypData.cenaM3, cena: cenaPodsypu });
  
  // PODKLADNI BETON
  if (podkladniBeton && plochaVnitrni > 0) {
    const objemPodklad = plochaVnitrni * tloustkaPodklad;
    const cenaPodklad = objemPodklad * zakladyBetony['C12/15'].cenaM3;
    cenaBeton += cenaPodklad;
    polozky.push({ kat: 'beton', nazev: zakladyBetony['C12/15'].nazev + ' - podkladní', m3: Math.ceil(objemPodklad * 10) / 10, cenaJed: zakladyBetony['C12/15'].cenaM3, cena: cenaPodklad });
  }
  
  // DESKA
  const objemDesky = plochaDesky * tloustkaDesky;
  const betonDeskaData = zakladyBetony[betonDeska];
  const konzDeskaData = zakladyKonzistence[konzDeska];
  const cenaDeskyM3 = betonDeskaData.cenaM3 + konzDeskaData.priplatek;
  const cenaDesky = objemDesky * cenaDeskyM3;
  cenaBeton += cenaDesky;
  if (objemDesky > 0) polozky.push({ kat: 'beton', nazev: betonDeskaData.nazev + ' ' + konzDeskaData.nazev + ' - deska', m3: Math.ceil(objemDesky * 10) / 10, cenaJed: cenaDeskyM3, cena: cenaDesky });
  
  document.getElementById('zakladyDeskaInfo').innerHTML = 'Objem: ' + objemDesky.toFixed(1) + ' m³';
  
  // KARI
  const kariData = zakladyKariSite[typKari];
  const pocetVrstev = dvojiteKari ? 2 : 1;
  const pocetKari = Math.ceil((plochaDesky * 1.15 * pocetVrstev) / kariData.plocha);
  const cenaKari = pocetKari * kariData.cenaKs;
  cenaVyztuz += cenaKari;
  if (pocetKari > 0) polozky.push({ kat: 'vyztuz', nazev: kariData.nazev + (dvojiteKari ? ' (2 vrstvy)' : ''), ks: pocetKari, cenaJed: kariData.cenaKs, cena: cenaKari });
  
  // Distančníky KARI
  const distKari = Math.ceil(plochaDesky * zakladyPrislusenstvi.distancnik.ksNaM2 * pocetVrstev);
  cenaDoplnky += distKari * zakladyPrislusenstvi.distancnik.cenaKs;
  polozky.push({ kat: 'material', nazev: zakladyPrislusenstvi.distancnik.nazev, ks: distKari, cenaJed: zakladyPrislusenstvi.distancnik.cenaKs, cena: distKari * zakladyPrislusenstvi.distancnik.cenaKs });
  
  // Vázací drát
  const dratKg = Math.ceil(plochaDesky / 100 * zakladyPrislusenstvi.drat.kgNa100m2);
  cenaDoplnky += dratKg * zakladyPrislusenstvi.drat.cenaKg;
  polozky.push({ kat: 'material', nazev: zakladyPrislusenstvi.drat.nazev, kg: dratKg, cenaJed: zakladyPrislusenstvi.drat.cenaKg, cena: dratKg * zakladyPrislusenstvi.drat.cenaKg });
  
  // HYDROIZOLACE
  const hydroData = zakladyHydroizolace[typHydro];
  const pocetRoli = Math.ceil((plochaDesky * 1.2 * (dvouvrstva ? 2 : 1)) / hydroData.roleM2);
  const cenaHydroMat = pocetRoli * hydroData.roleM2 * hydroData.cenaM2;
  cenaHydro += cenaHydroMat;
  polozky.push({ kat: 'hydro', nazev: hydroData.nazev + (dvouvrstva ? ' (2 vrstvy)' : ''), role: pocetRoli, m2: pocetRoli * hydroData.roleM2, cenaM2: hydroData.cenaM2, cena: cenaHydroMat });
  
  document.getElementById('zakladyHydroInfo').innerHTML = hydroData.popis + '. Přesahy min. 100 mm.';
  
  // Penetrace
  const spotrebaPen = plochaDesky * 1.2 * zakladyPrislusenstvi.penetrace.vydatnost;
  const cenaPen = spotrebaPen * zakladyPrislusenstvi.penetrace.cenaL;
  cenaHydro += cenaPen;
  polozky.push({ kat: 'hydro', nazev: zakladyPrislusenstvi.penetrace.nazev, l: Math.ceil(spotrebaPen), cenaJed: zakladyPrislusenstvi.penetrace.cenaL, cena: cenaPen });
  
  // ZEMNENI
  const cenaZemnPasek = delkaZemneni * zakladyPrislusenstvi.zemnPasek.cenaBm;
  const cenaSvorek = pocetSvorek * zakladyPrislusenstvi.zemnSvorka.cenaKs;
  const cenaPripoj = 2 * zakladyPrislusenstvi.zemnPripoj.cenaKs;
  cenaDoplnky += cenaZemnPasek + cenaSvorek + cenaPripoj;
  if (delkaZemneni > 0) polozky.push({ kat: 'zemneni', nazev: zakladyPrislusenstvi.zemnPasek.nazev, bm: delkaZemneni, cenaJed: zakladyPrislusenstvi.zemnPasek.cenaBm, cena: cenaZemnPasek });
  if (pocetSvorek > 0) polozky.push({ kat: 'zemneni', nazev: zakladyPrislusenstvi.zemnSvorka.nazev, ks: pocetSvorek, cenaJed: zakladyPrislusenstvi.zemnSvorka.cenaKs, cena: cenaSvorek });
  polozky.push({ kat: 'zemneni', nazev: zakladyPrislusenstvi.zemnPripoj.nazev, ks: 2, cenaJed: zakladyPrislusenstvi.zemnPripoj.cenaKs, cena: cenaPripoj });
  
  // PROSTUPY
  if (prostupyKanal > 0) { const c = prostupyKanal * zakladyProstupy.kanalizace.cenaKs; cenaDoplnky += c; polozky.push({ kat: 'prostupy', nazev: zakladyProstupy.kanalizace.nazev, ks: prostupyKanal, cenaJed: zakladyProstupy.kanalizace.cenaKs, cena: c }); }
  if (prostupyVoda > 0) { const c = prostupyVoda * zakladyProstupy.voda.cenaKs; cenaDoplnky += c; polozky.push({ kat: 'prostupy', nazev: zakladyProstupy.voda.nazev, ks: prostupyVoda, cenaJed: zakladyProstupy.voda.cenaKs, cena: c }); }
  if (prostupyElektro > 0) { const c = prostupyElektro * zakladyProstupy.elektro.cenaKs; cenaDoplnky += c; polozky.push({ kat: 'prostupy', nazev: zakladyProstupy.elektro.nazev, ks: prostupyElektro, cenaJed: zakladyProstupy.elektro.cenaKs, cena: c }); }
  if (prostupyPlyn > 0) { const c = prostupyPlyn * zakladyProstupy.plyn.cenaKs; cenaDoplnky += c; polozky.push({ kat: 'prostupy', nazev: zakladyProstupy.plyn.nazev, ks: prostupyPlyn, cenaJed: zakladyProstupy.plyn.cenaKs, cena: c }); }
  
  // CERPADLO
  if (typCerpadla !== 'zadne') {
    const cerpData = zakladyCerpadlo[typCerpadla];
    const hod = Math.max(cerpData.minHod, hodinyPumpy);
    const cenaCerp = hod * cerpData.cenaHod;
    cenaDoplnky += cenaCerp;
    polozky.push({ kat: 'sluzby', nazev: cerpData.nazev, hod: hod, cenaJed: cerpData.cenaHod, cena: cenaCerp });
  }
  
  // VIBRATOR
  if (pronajemVibr && dnyPrace > 0) {
    const cenaVibr = dnyPrace * zakladyPrislusenstvi.vibrator.cenaDen;
    const cenaLista = dnyPrace * zakladyPrislusenstvi.lista.cenaDen;
    cenaDoplnky += cenaVibr + cenaLista;
    polozky.push({ kat: 'sluzby', nazev: zakladyPrislusenstvi.vibrator.nazev, dny: dnyPrace, cenaJed: zakladyPrislusenstvi.vibrator.cenaDen, cena: cenaVibr });
    polozky.push({ kat: 'sluzby', nazev: zakladyPrislusenstvi.lista.nazev, dny: dnyPrace, cenaJed: zakladyPrislusenstvi.lista.cenaDen, cena: cenaLista });
  }
  
  // PE FOLIE
  const cenaFolie = plochaDesky * 1.1 * zakladyPrislusenstvi.folie.cenaM2;
  cenaDoplnky += cenaFolie;
  polozky.push({ kat: 'material', nazev: zakladyPrislusenstvi.folie.nazev, m2: Math.ceil(plochaDesky * 1.1), cenaJed: zakladyPrislusenstvi.folie.cenaM2, cena: cenaFolie });
  
  // BEDNENI
  const obvodDesky = Math.sqrt(plochaDesky) * 4 * 1.2;
  const cenaBedneni = obvodDesky * tloustkaDesky * zakladyPrislusenstvi.bedneni.cenaM2;
  cenaDoplnky += cenaBedneni;
  polozky.push({ kat: 'material', nazev: zakladyPrislusenstvi.bedneni.nazev, m2: Math.ceil(obvodDesky * tloustkaDesky), cenaJed: zakladyPrislusenstvi.bedneni.cenaM2, cena: cenaBedneni });
  
  const celkem = cenaBeton + cenaVyztuz + cenaHydro + cenaDoplnky;
  const objemBetonuCelkem = objemPasu + objemBetonuZB + (podkladniBeton ? plochaVnitrni * tloustkaPodklad : 0) + objemDesky;
  
  // Update souhrnu
  document.getElementById('zakladySumBeton').textContent = formatCena(cenaBeton);
  document.getElementById('zakladySumVyztuz').textContent = formatCena(cenaVyztuz);
  document.getElementById('zakladySumHydro').textContent = formatCena(cenaHydro);
  document.getElementById('zakladySumCelkem').textContent = formatCena(celkem);
  
  // RENDER VÝSLEDKY
  let html = '<div class="result"><div class="card-title">Rozpis materiálu</div>';
  
  // Beton a materiál
  html += '<div style="font-size:10px;font-weight:600;color:#ea580c;text-transform:uppercase;margin:12px 0 6px;">Beton</div>';
  polozky.filter(p => p.kat === 'beton').forEach(p => {
    html += '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + (p.m3 || '-') + ' m³ × ' + p.cenaJed + ' Kč</div></div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>';
  });
  
  html += '<div style="font-size:10px;font-weight:600;color:#3b82f6;text-transform:uppercase;margin:12px 0 6px;">Výztuž</div>';
  polozky.filter(p => p.kat === 'vyztuz').forEach(p => {
    html += '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + (p.bm ? p.bm + ' bm' : p.ks + ' ks') + '</div></div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>';
  });
  
  html += '<div style="font-size:10px;font-weight:600;color:#a855f7;text-transform:uppercase;margin:12px 0 6px;">Hydroizolace</div>';
  polozky.filter(p => p.kat === 'hydro').forEach(p => {
    html += '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + (p.role ? p.role + ' rolí (' + p.m2 + ' m²)' : p.l + ' l') + '</div></div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>';
  });
  
  html += '<div style="font-size:10px;font-weight:600;color:var(--g400);text-transform:uppercase;margin:12px 0 6px;">Materiál a služby</div>';
  polozky.filter(p => ['material', 'zemneni', 'prostupy', 'sluzby'].includes(p.kat)).forEach(p => {
    const mn = p.ks ? p.ks + ' ks' : p.bm ? p.bm + ' bm' : p.m2 ? p.m2 + ' m²' : p.m3 ? p.m3 + ' m³' : p.kg ? p.kg + ' kg' : p.hod ? p.hod + ' hod' : p.dny ? p.dny + ' dní' : '-';
    html += '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + mn + '</div></div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>';
  });
  
  html += '<div class="result-total"><span class="result-total-label">CELKEM</span><span class="result-total-value">' + formatCena(celkem) + '</span></div>';
  
  html += '<div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;margin-top:12px;text-align:center;">';
  html += '<div style="background:var(--bg);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g400);">Beton celkem</div><div style="font-size:14px;font-weight:600;color:#ea580c;">' + objemBetonuCelkem.toFixed(1) + ' m³</div></div>';
  html += '<div style="background:var(--bg);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g400);">Plocha desky</div><div style="font-size:14px;font-weight:600;color:#3b82f6;">' + plochaDesky + ' m²</div></div>';
  html += '<div style="background:var(--bg);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g400);">Cena/m² desky</div><div style="font-size:14px;font-weight:600;color:#a855f7;">' + Math.round(celkem / plochaDesky) + ' Kč</div></div>';
  html += '<div style="background:var(--bg);padding:8px;border-radius:8px;"><div style="font-size:10px;color:var(--g400);">Cena/m³ betonu</div><div style="font-size:14px;font-weight:600;color:#22c55e;">' + Math.round(celkem / objemBetonuCelkem) + ' Kč</div></div>';
  html += '</div>';
  
  html += '</div>';
  
  document.getElementById('zakladyResult').innerHTML = html;
}

// === ELEKTRO DATABÁZE ===
const elektroRozvadece = [
  { id: 'bp12', nazev: 'Bonega 12M', moduly: 12, cena: 450, rady: 1 },
  { id: 'bp24', nazev: 'Bonega 24M', moduly: 24, cena: 650, rady: 2 },
  { id: 'bp36', nazev: 'Bonega 36M', moduly: 36, cena: 850, rady: 3 },
  { id: 'bp48', nazev: 'Bonega 48M', moduly: 48, cena: 1050, rady: 4 },
  { id: 'bp54', nazev: 'Bonega 54M', moduly: 54, cena: 1250, rady: 4.5 },
  { id: 'bp72', nazev: 'Bonega 72M', moduly: 72, cena: 1650, rady: 6 },
  { id: 'bp96', nazev: 'Bonega 96M', moduly: 96, cena: 2200, rady: 8 },
];

const elektroPristroje = {
  jistice1f: [
    { id: 'j_b6', nazev: 'B6', proud: 6, char: 'B', moduly: 1, cena: 85 },
    { id: 'j_b10', nazev: 'B10', proud: 10, char: 'B', moduly: 1, cena: 85 },
    { id: 'j_b16', nazev: 'B16', proud: 16, char: 'B', moduly: 1, cena: 85 },
    { id: 'j_b20', nazev: 'B20', proud: 20, char: 'B', moduly: 1, cena: 89 },
    { id: 'j_c10', nazev: 'C10', proud: 10, char: 'C', moduly: 1, cena: 89 },
    { id: 'j_c16', nazev: 'C16', proud: 16, char: 'C', moduly: 1, cena: 89 },
    { id: 'j_c20', nazev: 'C20', proud: 20, char: 'C', moduly: 1, cena: 92 },
  ],
  jistice3f: [
    { id: 'j3_b16', nazev: 'B16/3', proud: 16, char: 'B', moduly: 3, cena: 285 },
    { id: 'j3_b20', nazev: 'B20/3', proud: 20, char: 'B', moduly: 3, cena: 295 },
    { id: 'j3_b25', nazev: 'B25/3', proud: 25, char: 'B', moduly: 3, cena: 305 },
    { id: 'j3_b32', nazev: 'B32/3', proud: 32, char: 'B', moduly: 3, cena: 320 },
    { id: 'j3_b40', nazev: 'B40/3', proud: 40, char: 'B', moduly: 3, cena: 380 },
    { id: 'j3_b50', nazev: 'B50/3', proud: 50, char: 'B', moduly: 3, cena: 450 },
    { id: 'j3_b63', nazev: 'B63/3', proud: 63, char: 'B', moduly: 3, cena: 520 },
    { id: 'j3_c20', nazev: 'C20/3', proud: 20, char: 'C', moduly: 3, cena: 310 },
    { id: 'j3_c25', nazev: 'C25/3', proud: 25, char: 'C', moduly: 3, cena: 325 },
    { id: 'j3_c32', nazev: 'C32/3', proud: 32, char: 'C', moduly: 3, cena: 350 },
  ],
  chranice2p: [
    { id: 'chr_25_30_ac', nazev: '25A/30mA AC', proud: 25, typ: 'AC', moduly: 2, cena: 450 },
    { id: 'chr_40_30_ac', nazev: '40A/30mA AC', proud: 40, typ: 'AC', moduly: 2, cena: 480 },
    { id: 'chr_25_30_a', nazev: '25A/30mA A', proud: 25, typ: 'A', moduly: 2, cena: 650 },
    { id: 'chr_40_30_a', nazev: '40A/30mA A', proud: 40, typ: 'A', moduly: 2, cena: 720 },
  ],
  chranice4p: [
    { id: 'chr4_40_30_a', nazev: '4P 40A/30mA A', proud: 40, typ: 'A', moduly: 4, cena: 1450 },
    { id: 'chr4_63_30_a', nazev: '4P 63A/30mA A', proud: 63, typ: 'A', moduly: 4, cena: 1650 },
  ],
  svodice: [
    { id: 'sv_t2_3n', nazev: 'T2 3P+N', moduly: 4, cena: 1250 },
    { id: 'sv_t1t2_3n', nazev: 'T1+T2 3P+N', moduly: 8, cena: 5500 },
  ],
  hrebenLista: { nazev: 'Hřebenová lišta 12M', cena: 185 }
};

const elektroKoncovePrvky = {
  abb: {
    nazev: 'ABB',
    serie: [
      { id: 'tango', nazev: 'Tango', popis: 'Základní', zasuvka: 95, zasuvkaDvojna: 165, vypinac: 125, vypinacSeriovy: 185, vypinacStridavy: 175, ramecek1: 35, datova: 185, tv: 145 },
      { id: 'levit', nazev: 'Levit', popis: 'Design', zasuvka: 185, zasuvkaDvojna: 320, vypinac: 245, vypinacSeriovy: 345, vypinacStridavy: 325, ramecek1: 125, datova: 285, tv: 225 },
    ],
  },
  schneider: {
    nazev: 'Schneider',
    serie: [
      { id: 'sedna', nazev: 'Sedna Design', popis: 'Základní', zasuvka: 85, zasuvkaDvojna: 145, vypinac: 115, vypinacSeriovy: 165, vypinacStridavy: 155, ramecek1: 45, datova: 165, tv: 125 },
      { id: 'unica', nazev: 'Unica', popis: 'Střední', zasuvka: 145, zasuvkaDvojna: 265, vypinac: 195, vypinacSeriovy: 285, vypinacStridavy: 265, ramecek1: 85, datova: 245, tv: 195 },
    ],
  },
  legrand: {
    nazev: 'Legrand',
    serie: [
      { id: 'niloe', nazev: 'Niloe', popis: 'Základní', zasuvka: 75, zasuvkaDvojna: 135, vypinac: 105, vypinacSeriovy: 155, vypinacStridavy: 145, ramecek1: 35, datova: 155, tv: 115 },
      { id: 'valena', nazev: 'Valena Life', popis: 'Design', zasuvka: 165, zasuvkaDvojna: 295, vypinac: 225, vypinacSeriovy: 325, vypinacStridavy: 305, ramecek1: 105, datova: 265, tv: 205 },
    ],
  },
  hager: {
    nazev: 'Hager',
    serie: [
      { id: 'lumina', nazev: 'Lumina', popis: 'Základní', zasuvka: 85, zasuvkaDvojna: 155, vypinac: 115, vypinacSeriovy: 175, vypinacStridavy: 165, ramecek1: 45, datova: 175, tv: 135 },
    ],
  },
};

const elektroTuya = { termostat: { nazev: 'Tuya Zigbee HY607W 16A', cena: 890 }, gateway: { nazev: 'Tuya Zigbee Gateway', cena: 650 } };

const elektroSpecialniSpotrebice = [
  { id: 'sporak', nazev: 'Sporák / Varná deska', vykon: 7000, jistic: 'C25/3', kabel: '5x4', chranic: 'A', delka: 12 },
  { id: 'trouba', nazev: 'Trouba', vykon: 3500, jistic: 'B16', kabel: '3x2.5', chranic: 'A', delka: 12 },
  { id: 'mycka', nazev: 'Myčka', vykon: 2200, jistic: 'B16', kabel: '3x2.5', chranic: 'A', delka: 14 },
  { id: 'pracka', nazev: 'Pračka', vykon: 2200, jistic: 'B16', kabel: '3x2.5', chranic: 'A', delka: 14 },
  { id: 'susicka', nazev: 'Sušička', vykon: 2500, jistic: 'B16', kabel: '3x2.5', chranic: 'A', delka: 14 },
  { id: 'bojler', nazev: 'Bojler', vykon: 2000, jistic: 'B16', kabel: '3x2.5', chranic: 'AC', delka: 10 },
  { id: 'tc', nazev: 'Tepelné čerpadlo', vykon: 5000, jistic: 'C20/3', kabel: '5x4', chranic: 'A', delka: 15 },
  { id: 'wallbox_11', nazev: 'Wallbox 11kW', vykon: 11000, jistic: 'C20/3', kabel: '5x4', chranic: 'A', delka: 20 },
  { id: 'wallbox_22', nazev: 'Wallbox 22kW', vykon: 22000, jistic: 'C32/3', kabel: '5x10', chranic: 'A', delka: 20 },
  { id: 'klimaVnej', nazev: 'Klima venk. jednotka', vykon: 2500, jistic: 'C16', kabel: '3x2.5', chranic: 'A', delka: 15 },
  { id: 'sauna', nazev: 'Sauna', vykon: 6000, jistic: 'C25/3', kabel: '5x4', chranic: 'A', delka: 18 },
  { id: 'digestor', nazev: 'Digestoř', vykon: 300, jistic: 'B10', kabel: '3x1.5', chranic: 'AC', delka: 8 },
  { id: 'rekuperace', nazev: 'Rekuperace', vykon: 200, jistic: 'B10', kabel: '3x1.5', chranic: 'AC', delka: 15 },
  { id: 'podlahaEl', nazev: 'Podlah. topení el.', vykon: 2000, jistic: 'B16', kabel: '3x2.5', chranic: 'A', delka: 15 },
  { id: 'zaluzieCentr', nazev: 'Žaluzie central.', vykon: 500, jistic: 'B10', kabel: '3x1.5', chranic: 'AC', delka: 25 },
];

const elektroKabely = {
  '3x1.5': { nazev: 'CYKY-J 3×1,5', prouzek: 'modrý', cenaM: 28 },
  '3x2.5': { nazev: 'CYKY-J 3×2,5', prouzek: 'zelený', cenaM: 42 },
  '5x1.5': { nazev: 'CYKY-J 5×1,5', prouzek: 'fialový', cenaM: 52 },
  '5x2.5': { nazev: 'CYKY-J 5×2,5', prouzek: 'žlutý', cenaM: 75 },
  '5x4': { nazev: 'CYKY-J 5×4', cenaM: 115 },
  '5x6': { nazev: 'CYKY-J 5×6', cenaM: 165 },
  '5x10': { nazev: 'CYKY-J 5×10', cenaM: 265 },
  'data': { nazev: 'UTP Cat6', cenaM: 18 },
  'koax': { nazev: 'Koaxiál', cenaM: 15 },
};

const elektroInstalacniMaterial = {
  krabiceKU68: { nazev: 'KU 68', cena: 12 },
  krabiceKP67: { nazev: 'KP 67/2', cena: 22 },
  trubka20: { nazev: 'Trubka 1220', cenaM: 10 },
  prichytka: { nazev: 'Příchytka', cena: 1.5 },
  wago: { nazev: 'WAGO 221-413', cena: 14 },
};

const elektroTypyMistnosti = [
  { id: 'obyvak', nazev: 'Obývací pokoj', zasuvky: 8, zasuvkyDv: 2, vypinace: 2, stridave: 1, seriove: 1, svetla: 3, klima: 0, termostat: 0, tv: 1, lan: 2, vlhka: false, delka: 25 },
  { id: 'kuchyn', nazev: 'Kuchyň', zasuvky: 6, zasuvkyDv: 2, vypinace: 1, stridave: 0, seriove: 1, svetla: 2, klima: 0, termostat: 0, tv: 1, lan: 0, vlhka: false, delka: 15 },
  { id: 'loznice', nazev: 'Ložnice', zasuvky: 4, zasuvkyDv: 2, vypinace: 1, stridave: 1, seriove: 0, svetla: 2, klima: 1, termostat: 1, tv: 1, lan: 1, vlhka: false, delka: 20 },
  { id: 'detsky', nazev: 'Dětský pokoj', zasuvky: 4, zasuvkyDv: 1, vypinace: 1, stridave: 1, seriove: 0, svetla: 2, klima: 0, termostat: 1, tv: 0, lan: 1, vlhka: false, delka: 18 },
  { id: 'pracovna', nazev: 'Pracovna', zasuvky: 6, zasuvkyDv: 2, vypinace: 1, stridave: 0, seriove: 0, svetla: 2, klima: 0, termostat: 0, tv: 0, lan: 2, vlhka: false, delka: 18 },
  { id: 'koupelna', nazev: 'Koupelna', zasuvky: 2, zasuvkyDv: 0, vypinace: 1, stridave: 0, seriove: 1, svetla: 3, klima: 0, termostat: 1, tv: 0, lan: 0, vlhka: true, delka: 15 },
  { id: 'wc', nazev: 'WC', zasuvky: 1, zasuvkyDv: 0, vypinace: 1, stridave: 0, seriove: 0, svetla: 1, klima: 0, termostat: 0, tv: 0, lan: 0, vlhka: true, delka: 8 },
  { id: 'chodba', nazev: 'Chodba', zasuvky: 2, zasuvkyDv: 0, vypinace: 0, stridave: 2, seriove: 0, svetla: 3, klima: 0, termostat: 1, tv: 0, lan: 0, vlhka: false, delka: 25 },
  { id: 'technicka', nazev: 'Technická', zasuvky: 4, zasuvkyDv: 0, vypinace: 1, stridave: 0, seriove: 0, svetla: 1, klima: 0, termostat: 0, tv: 0, lan: 1, vlhka: false, delka: 10 },
  { id: 'garaz', nazev: 'Garáž', zasuvky: 4, zasuvkyDv: 0, vypinace: 2, stridave: 0, seriove: 0, svetla: 2, klima: 0, termostat: 0, tv: 0, lan: 0, vlhka: false, delka: 20 },
  { id: 'venkovni', nazev: 'Venkovní', zasuvky: 2, zasuvkyDv: 0, vypinace: 2, stridave: 0, seriove: 0, svetla: 4, klima: 0, termostat: 0, tv: 0, lan: 0, vlhka: true, delka: 35 },
];

let elektroMistnosti = [];
let elektroSpecialni = [
  { id: 'sporak', aktivni: true, delka: 12 },
  { id: 'trouba', aktivni: true, delka: 12 },
  { id: 'mycka', aktivni: true, delka: 14 },
  { id: 'pracka', aktivni: true, delka: 14 },
  { id: 'susicka', aktivni: true, delka: 14 },
  { id: 'bojler', aktivni: true, delka: 10 },
  { id: 'digestor', aktivni: true, delka: 8 },
  { id: 'tc', aktivni: false, delka: 15 },
  { id: 'wallbox_11', aktivni: false, delka: 20 },
  { id: 'klimaVnej', aktivni: false, delka: 15 },
  { id: 'rekuperace', aktivni: false, delka: 15 },
  { id: 'podlahaEl', aktivni: false, delka: 15 },
  { id: 'zaluzieCentr', aktivni: false, delka: 25 },
];

function elektroGenerateId() { return Math.random().toString(36).substr(2, 9); }

function renderElektroAll() {
  // Výchozí místnosti
  elektroMistnosti = [
    { id: elektroGenerateId(), ...elektroTypyMistnosti.find(t => t.id === 'obyvak') },
    { id: elektroGenerateId(), ...elektroTypyMistnosti.find(t => t.id === 'kuchyn') },
    { id: elektroGenerateId(), ...elektroTypyMistnosti.find(t => t.id === 'loznice') },
    { id: elektroGenerateId(), ...elektroTypyMistnosti.find(t => t.id === 'koupelna') },
    { id: elektroGenerateId(), ...elektroTypyMistnosti.find(t => t.id === 'chodba') },
    { id: elektroGenerateId(), ...elektroTypyMistnosti.find(t => t.id === 'technicka') },
  ];
  renderElektroTypyMistnosti();
  renderElektroMistnosti();
  renderElektroSpecialni();
  elektroZmenVyrobce();
}

function renderElektroTypyMistnosti() {
  document.getElementById('elektroTypyMistnosti').innerHTML = elektroTypyMistnosti.map(t => '<button onclick="elektroPridatMistnost(\'' + t.id + '\')" style="padding:6px 10px;font-size:11px;background:var(--g200);border:none;border-radius:6px;cursor:pointer;">+ ' + t.nazev + '</button>').join('');
}

function elektroPridatMistnost(typId) {
  const typ = elektroTypyMistnosti.find(t => t.id === typId);
  if (typ) {
    elektroMistnosti.push({ id: elektroGenerateId(), ...typ });
    renderElektroMistnosti();
    vypoctiElektro();
  }
}

function elektroOdebratMistnost(id) {
  elektroMistnosti = elektroMistnosti.filter(m => m.id !== id);
  renderElektroMistnosti();
  vypoctiElektro();
}

function elektroUpdateMistnost(id, field, value) {
  const m = elektroMistnosti.find(x => x.id === id);
  if (m) { m[field] = parseInt(value) || 0; vypoctiElektro(); }
}

function elektroUpdateMistnostNazev(id, nazev) {
  const m = elektroMistnosti.find(x => x.id === id);
  if (m) m.nazev = nazev;
}

function renderElektroMistnosti() {
  document.getElementById('elektroMistnostiList').innerHTML = elektroMistnosti.map(m => {
    const inp = (label, field, max) => '<div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:10px;color:var(--g500);">' + label + '</span><input type="number" min="0" max="' + (max||20) + '" value="' + m[field] + '" onchange="elektroUpdateMistnost(\'' + m.id + '\',\'' + field + '\',this.value)" style="width:36px;padding:2px;font-size:11px;text-align:center;border:1px solid var(--g200);border-radius:4px;"></div>';
    return '<div class="card" style="border-left:4px solid ' + (m.vlhka ? '#3b82f6' : '#eab308') + ';"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;"><input type="text" value="' + m.nazev + '" onchange="elektroUpdateMistnostNazev(\'' + m.id + '\',this.value)" style="font-weight:500;font-size:13px;border:none;background:transparent;width:120px;"><button onclick="elektroOdebratMistnost(\'' + m.id + '\')" style="font-size:18px;color:var(--g400);background:none;border:none;cursor:pointer;">×</button></div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px;font-size:10px;">' + inp('Zásuvky', 'zasuvky') + inp('Dvojité', 'zasuvkyDv', 10) + inp('Světla', 'svetla') + inp('Vypínače', 'vypinace', 10) + inp('Střídavé', 'stridave', 10) + inp('Sériové', 'seriove', 10) + inp('Klima', 'klima', 3) + inp('Termostat', 'termostat', 3) + inp('TV', 'tv', 5) + inp('LAN', 'lan', 10) + '<div style="grid-column:span 2;display:flex;justify-content:space-between;align-items:center;"><span style="font-size:10px;color:var(--g500);">Délka kabelu</span><div style="display:flex;align-items:center;gap:4px;"><input type="number" min="5" max="100" value="' + m.delka + '" onchange="elektroUpdateMistnost(\'' + m.id + '\',\'delka\',this.value)" style="width:40px;padding:2px;font-size:11px;text-align:center;border:1px solid var(--g200);border-radius:4px;"><span style="font-size:10px;color:var(--g400);">m</span></div></div></div></div>';
  }).join('');
}

function renderElektroSpecialni() {
  document.getElementById('elektroSpecialniList').innerHTML = elektroSpecialni.map(s => {
    const sp = elektroSpecialniSpotrebice.find(x => x.id === s.id);
    if (!sp) return '';
    return '<div onclick="elektroToggleSpecialni(\'' + s.id + '\')" style="padding:8px;border-radius:8px;cursor:pointer;border:1px solid ' + (s.aktivni ? 'rgba(234,179,8,0.5)' : 'var(--g200)') + ';background:' + (s.aktivni ? 'rgba(234,179,8,0.1)' : 'var(--g100)') + ';"><div style="display:flex;justify-content:space-between;align-items:center;"><span style="font-size:11px;color:' + (s.aktivni ? '#ca8a04' : 'var(--g400)') + ';">' + sp.nazev + '</span><span style="width:12px;height:12px;border-radius:3px;border:1px solid ' + (s.aktivni ? '#eab308' : 'var(--g300)') + ';background:' + (s.aktivni ? '#eab308' : 'transparent') + ';"></span></div><div style="font-size:10px;color:var(--g400);margin-top:2px;">' + (sp.vykon/1000).toFixed(1) + 'kW ' + sp.jistic + '</div></div>';
  }).join('');
}

function elektroToggleSpecialni(id) {
  const s = elektroSpecialni.find(x => x.id === id);
  if (s) { s.aktivni = !s.aktivni; renderElektroSpecialni(); vypoctiElektro(); }
}

function elektroZmenVyrobce() {
  const vyrobce = document.getElementById('elektroVyrobce').value;
  const v = elektroKoncovePrvky[vyrobce];
  if (v) {
    document.getElementById('elektroSerie').innerHTML = v.serie.map(s => '<option value="' + s.id + '">' + s.nazev + ' - ' + s.popis + '</option>').join('');
    vypoctiElektro();
  }
}

function vypoctiElektro() {
  if (elektroMistnosti.length === 0) { document.getElementById('elektroResult').innerHTML = ''; return; }
  
  const hlavniJistic = parseInt(document.getElementById('elektroHlavniJistic').value);
  const svodicTyp = document.getElementById('elektroSvodic').value;
  const vyrobce = document.getElementById('elektroVyrobce').value;
  const serieId = document.getElementById('elektroSerie').value;
  const gateway = document.getElementById('elektroGateway').checked;
  const rezerva = parseInt(document.getElementById('elektroRezerva').value) || 10;
  
  const polozky = [];
  let celkemModulu = 0;
  let celkemVykon = 0;
  
  // Součty
  let sumZasuvek = 0, sumZasuvkyDv = 0, sumVypinacu = 0, sumStridave = 0, sumSeriove = 0;
  let sumSvetel = 0, sumKlima = 0, sumTermostat = 0, sumTv = 0, sumLan = 0, sumDelka = 0;
  let vlhke = [];
  
  elektroMistnosti.forEach(m => {
    sumZasuvek += m.zasuvky; sumZasuvkyDv += m.zasuvkyDv; sumVypinacu += m.vypinace;
    sumStridave += m.stridave; sumSeriove += m.seriove; sumSvetel += m.svetla;
    sumKlima += m.klima; sumTermostat += m.termostat; sumTv += m.tv; sumLan += m.lan; sumDelka += m.delka;
    if (m.vlhka) vlhke.push(m);
  });
  
  const celkemZasuvekBody = sumZasuvek + sumZasuvkyDv * 2;
  const celkemVypinacuBody = sumVypinacu + sumStridave + sumSeriove;
  const aktivniSpec = elektroSpecialni.filter(s => s.aktivni).map(s => ({...s, ...elektroSpecialniSpotrebice.find(sp => sp.id === s.id)})).filter(s => s.nazev);
  
  // === ROZVADĚČ ===
  const hjist = elektroPristroje.jistice3f.find(j => j.proud === hlavniJistic && j.char === 'B');
  if (hjist) { polozky.push({ kat: 'Rozvaděč', nazev: 'Hlavní jistič ' + hjist.nazev, ks: 1, cena: hjist.cena, mod: hjist.moduly }); celkemModulu += hjist.moduly; }
  
  const hchr = elektroPristroje.chranice4p.find(c => c.proud >= hlavniJistic);
  if (hchr) { polozky.push({ kat: 'Rozvaděč', nazev: 'Proudový chránič ' + hchr.nazev, ks: 1, cena: hchr.cena, mod: hchr.moduly }); celkemModulu += hchr.moduly; }
  
  if (svodicTyp !== 'zadny') {
    const svod = elektroPristroje.svodice.find(s => s.id === 'sv_' + svodicTyp);
    if (svod) { polozky.push({ kat: 'Rozvaděč', nazev: 'Svodič ' + svod.nazev, ks: 1, cena: svod.cena, mod: svod.moduly }); celkemModulu += svod.moduly; }
  }
  
  // Světelné okruhy
  const svetleOkrBezne = Math.ceil((sumSvetel - vlhke.reduce((s,m) => s + m.svetla, 0)) / 10);
  const svetleOkrVlhke = vlhke.length > 0 ? Math.ceil(vlhke.reduce((s,m) => s + m.svetla, 0) / 6) : 0;
  const svetleOkrCelkem = svetleOkrBezne + svetleOkrVlhke;
  if (svetleOkrCelkem > 0) {
    const j = elektroPristroje.jistice1f.find(j => j.proud === 10 && j.char === 'B');
    polozky.push({ kat: 'Rozvaděč', nazev: 'Jistič B10 - světla', ks: svetleOkrCelkem, cena: svetleOkrCelkem * j.cena, mod: svetleOkrCelkem, info: sumSvetel + ' bodů' });
    celkemModulu += svetleOkrCelkem;
  }
  
  // Zásuvkové okruhy
  const zasOkrBezne = Math.ceil((celkemZasuvekBody - vlhke.reduce((s,m) => s + m.zasuvky + m.zasuvkyDv*2, 0)) / 8);
  const zasOkrVlhke = vlhke.length;
  const zasOkrCelkem = zasOkrBezne + zasOkrVlhke;
  if (zasOkrCelkem > 0) {
    const j = elektroPristroje.jistice1f.find(j => j.proud === 16 && j.char === 'B');
    polozky.push({ kat: 'Rozvaděč', nazev: 'Jistič B16 - zásuvky', ks: zasOkrCelkem, cena: zasOkrCelkem * j.cena, mod: zasOkrCelkem, info: celkemZasuvekBody + ' zás.' });
    celkemModulu += zasOkrCelkem; celkemVykon += zasOkrCelkem * 3680;
  }
  
  // Chrániče vlhké
  if (zasOkrVlhke > 0) {
    const chr = elektroPristroje.chranice2p.find(c => c.typ === 'A' && c.proud >= 25);
    const ks = Math.ceil(zasOkrVlhke / 2);
    polozky.push({ kat: 'Rozvaděč', nazev: 'Chránič ' + chr.nazev + ' - vlhké', ks, cena: ks * chr.cena, mod: ks * 2 });
    celkemModulu += ks * 2;
  }
  
  // Speciální spotřebiče
  aktivniSpec.forEach(sp => {
    const is3f = sp.jistic.includes('/3');
    const char = sp.jistic[0];
    const proud = parseInt(sp.jistic.slice(1));
    const jlist = is3f ? elektroPristroje.jistice3f : elektroPristroje.jistice1f;
    const j = jlist.find(j => j.char === char && j.proud === proud);
    if (j) { polozky.push({ kat: 'Rozvaděč', nazev: 'Jistič ' + j.nazev + ' - ' + sp.nazev, ks: 1, cena: j.cena, mod: j.moduly }); celkemModulu += j.moduly; celkemVykon += sp.vykon; }
  });
  
  // Chrániče spec A
  const specA = aktivniSpec.filter(s => s.chranic === 'A').length;
  if (specA > 0) {
    const chr = elektroPristroje.chranice2p.find(c => c.typ === 'A' && c.proud >= 40);
    const ks = Math.ceil(specA / 3);
    polozky.push({ kat: 'Rozvaděč', nazev: 'Chránič ' + chr.nazev + ' - spotřebiče', ks, cena: ks * chr.cena, mod: ks * 2 });
    celkemModulu += ks * 2;
  }
  
  // Rozvaděč
  const modRezerva = Math.ceil(celkemModulu * 0.15);
  const rozvadec = elektroRozvadece.find(r => r.moduly >= celkemModulu + modRezerva) || elektroRozvadece[elektroRozvadece.length - 1];
  polozky.unshift({ kat: 'Rozvaděč', nazev: 'Skříň ' + rozvadec.nazev, ks: 1, cena: rozvadec.cena, mod: 0, info: rozvadec.moduly + ' mod' });
  polozky.push({ kat: 'Rozvaděč', nazev: 'Hřebenové lišty', ks: Math.ceil(rozvadec.rady), cena: Math.ceil(rozvadec.rady) * elektroPristroje.hrebenLista.cena, mod: 0 });
  
  // === KABELY ===
  const rez = 1 + rezerva / 100;
  const delkaSvetel = Math.ceil(sumDelka * 0.35 * rez);
  const delkaZasuvek = Math.ceil(sumDelka * 0.5 * rez);
  const delkaData = Math.ceil((sumLan + sumTv) * 15 * rez);
  
  if (delkaSvetel > 0) polozky.push({ kat: 'Kabely', nazev: elektroKabely['3x1.5'].nazev, ks: delkaSvetel, j: 'm', cena: delkaSvetel * elektroKabely['3x1.5'].cenaM, info: elektroKabely['3x1.5'].prouzek });
  if (delkaZasuvek > 0) polozky.push({ kat: 'Kabely', nazev: elektroKabely['3x2.5'].nazev, ks: delkaZasuvek, j: 'm', cena: delkaZasuvek * elektroKabely['3x2.5'].cenaM, info: elektroKabely['3x2.5'].prouzek });
  if (delkaData > 0) polozky.push({ kat: 'Kabely', nazev: elektroKabely['data'].nazev, ks: delkaData, j: 'm', cena: delkaData * elektroKabely['data'].cenaM });
  
  // Kabely spec
  const kSpec = {};
  aktivniSpec.forEach(sp => { if (!kSpec[sp.kabel]) kSpec[sp.kabel] = 0; kSpec[sp.kabel] += Math.ceil(sp.delka * rez); });
  Object.entries(kSpec).forEach(([typ, del]) => { if (elektroKabely[typ]) polozky.push({ kat: 'Kabely', nazev: elektroKabely[typ].nazev, ks: del, j: 'm', cena: del * elektroKabely[typ].cenaM }); });
  
  // === KONCOVÉ PRVKY ===
  const serie = elektroKoncovePrvky[vyrobce]?.serie.find(s => s.id === serieId);
  if (serie) {
    if (sumZasuvek > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Zásuvka ' + serie.nazev, ks: sumZasuvek, cena: sumZasuvek * serie.zasuvka });
    if (sumZasuvkyDv > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Zásuvka dvojitá ' + serie.nazev, ks: sumZasuvkyDv, cena: sumZasuvkyDv * serie.zasuvkaDvojna });
    if (sumVypinacu > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Vypínač ' + serie.nazev, ks: sumVypinacu, cena: sumVypinacu * serie.vypinac });
    if (sumStridave > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Vypínač střídavý', ks: sumStridave, cena: sumStridave * serie.vypinacStridavy });
    if (sumSeriove > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Vypínač sériový', ks: sumSeriove, cena: sumSeriove * serie.vypinacSeriovy });
    if (sumLan > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Zásuvka datová RJ45', ks: sumLan, cena: sumLan * serie.datova });
    if (sumTv > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Zásuvka TV/SAT', ks: sumTv, cena: sumTv * serie.tv });
    const celkemRamecku = sumZasuvek + sumZasuvkyDv + celkemVypinacuBody + sumLan + sumTv;
    polozky.push({ kat: 'Koncové prvky', nazev: 'Rámeček 1-nás.', ks: celkemRamecku, cena: celkemRamecku * serie.ramecek1 });
  }
  
  // === TUYA TERMOSTATY ===
  if (sumTermostat > 0) polozky.push({ kat: 'Smart Home', nazev: elektroTuya.termostat.nazev, ks: sumTermostat, cena: sumTermostat * elektroTuya.termostat.cena, info: 'pro topení' });
  if (sumTermostat > 0 && gateway) polozky.push({ kat: 'Smart Home', nazev: elektroTuya.gateway.nazev, ks: 1, cena: elektroTuya.gateway.cena, info: '1 na dům' });
  if (sumKlima > 0) polozky.push({ kat: 'Koncové prvky', nazev: 'Předpříprava klima', ks: sumKlima, cena: sumKlima * 50, info: 'krabice+zaslepka' });
  
  // === INSTALAČNÍ MATERIÁL ===
  const pocetKrabic = sumZasuvek + sumZasuvkyDv + celkemVypinacuBody + sumLan + sumTv + sumTermostat + sumKlima;
  const pocetRozvod = sumSvetel + Math.ceil(pocetKrabic / 6);
  polozky.push({ kat: 'Inst. materiál', nazev: elektroInstalacniMaterial.krabiceKU68.nazev, ks: pocetKrabic, cena: pocetKrabic * elektroInstalacniMaterial.krabiceKU68.cena });
  polozky.push({ kat: 'Inst. materiál', nazev: elektroInstalacniMaterial.krabiceKP67.nazev, ks: pocetRozvod, cena: pocetRozvod * elektroInstalacniMaterial.krabiceKP67.cena });
  const delkaTrubek = Math.ceil((delkaSvetel + delkaZasuvek) * 0.8);
  polozky.push({ kat: 'Inst. materiál', nazev: elektroInstalacniMaterial.trubka20.nazev, ks: delkaTrubek, j: 'm', cena: delkaTrubek * elektroInstalacniMaterial.trubka20.cenaM });
  polozky.push({ kat: 'Inst. materiál', nazev: elektroInstalacniMaterial.prichytka.nazev, ks: Math.ceil(delkaTrubek / 0.4), cena: Math.ceil(delkaTrubek / 0.4 * elektroInstalacniMaterial.prichytka.cena) });
  polozky.push({ kat: 'Inst. materiál', nazev: elektroInstalacniMaterial.wago.nazev, ks: pocetRozvod * 4, cena: pocetRozvod * 4 * elektroInstalacniMaterial.wago.cena });
  
  const celkem = polozky.reduce((s, p) => s + p.cena, 0);
  const celkemOkruhu = svetleOkrCelkem + zasOkrCelkem + aktivniSpec.length;
  
  // RENDER
  let html = '<div class="result">';
  html += '<div class="card-title">Kalkulace elektroinstalace</div>';
  
  // Souhrn
  html += '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:12px;">';
  html += '<div style="background:var(--g100);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:20px;font-weight:700;">' + elektroMistnosti.length + '</div><div style="font-size:10px;color:var(--g400);">místností</div></div>';
  html += '<div style="background:var(--g100);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:20px;font-weight:700;">' + celkemOkruhu + '</div><div style="font-size:10px;color:var(--g400);">okruhů</div></div>';
  html += '<div style="background:var(--g100);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:20px;font-weight:700;">' + celkemZasuvekBody + '</div><div style="font-size:10px;color:var(--g400);">zásuvek</div></div>';
  html += '<div style="background:var(--g100);padding:10px;border-radius:8px;text-align:center;"><div style="font-size:20px;font-weight:700;">' + sumSvetel + '</div><div style="font-size:10px;color:var(--g400);">světel</div></div>';
  html += '</div>';
  
  // Rozvaděč info
  html += '<div style="background:var(--g100);padding:10px;border-radius:8px;margin-bottom:12px;">';
  html += '<div style="display:flex;justify-content:space-between;font-size:12px;"><span style="color:var(--g400);">Rozvaděč</span><span>' + rozvadec.nazev + '</span></div>';
  html += '<div style="display:flex;justify-content:space-between;font-size:12px;"><span style="color:var(--g400);">Obsazeno</span><span>' + celkemModulu + ' / ' + rozvadec.moduly + ' mod</span></div>';
  html += '<div style="width:100%;height:6px;background:var(--g200);border-radius:3px;margin-top:6px;"><div style="width:' + Math.min(100, celkemModulu/rozvadec.moduly*100) + '%;height:100%;background:linear-gradient(135deg,var(--gold-start),var(--gold-end));border-radius:3px;"></div></div>';
  html += '</div>';
  
  html += '<div style="background:var(--g100);padding:10px;border-radius:8px;margin-bottom:12px;display:flex;justify-content:space-between;font-size:12px;"><span style="color:var(--g400);">Inst. výkon</span><span style="font-weight:500;">' + (celkemVykon/1000).toFixed(1) + ' kW</span></div>';
  
  // Celkem
  html += '<div class="result-total"><span class="result-total-label">CELKEM</span><span class="result-total-value">' + formatCena(celkem) + '</span></div>';
  
  // Rozpis
  html += '<div style="margin-top:16px;">';
  ['Rozvaděč', 'Kabely', 'Koncové prvky', 'Smart Home', 'Inst. materiál'].forEach(kat => {
    const items = polozky.filter(p => p.kat === kat);
    if (items.length === 0) return;
    const katCena = items.reduce((s,i) => s + i.cena, 0);
    html += '<div style="display:flex;justify-content:space-between;font-size:11px;margin:12px 0 4px;"><span style="font-weight:600;color:var(--gold);">' + kat + '</span><span style="color:var(--g400);">' + formatCena(katCena) + '</span></div>';
    items.forEach(p => {
      html += '<div style="display:flex;justify-content:space-between;font-size:11px;padding:3px 0;border-bottom:1px solid var(--g100);"><span style="color:var(--g500);">' + p.nazev + ' <span style="color:var(--g300);">' + p.ks + (p.j || 'ks') + '</span>' + (p.info ? ' <span style="color:var(--g300);">(' + p.info + ')</span>' : '') + '</span><span style="color:var(--g400);">' + formatCena(p.cena) + '</span></div>';
    });
  });
  html += '</div>';
  
  html += '</div>';
  
  document.getElementById('elektroResult').innerHTML = html;
}

// === PODLAHY ARBITON DATABÁZE ===
const arbitonPodlahy = {
  amaron: [
    { id: 'amaron_wood', nazev: 'Amaron Wood Design', cenaM2: 815, baleniM2: 2.076, tloustka: 5, naslap: 0.55, trida: '23/33/42', zamek: '5G', popis: 'Dřevěné dekory, 1511×229mm' },
    { id: 'amaron_stone', nazev: 'Amaron XXL Stone', cenaM2: 815, baleniM2: 2.088, tloustka: 5, naslap: 0.55, trida: '23/33/42', zamek: '5G', popis: 'Kamenné dekory, 914×457mm' },
    { id: 'amaron_herring', nazev: 'Amaron Herringbone', cenaM2: 915, baleniM2: 1.402, tloustka: 5, naslap: 0.55, trida: '23/33/42', zamek: '5G', popis: 'Rybí kost, 615×123mm' },
    { id: 'amaron_eir', nazev: 'Amaron Wood EIR', cenaM2: 899, baleniM2: 2.076, tloustka: 5, naslap: 0.55, trida: '23/33/42', zamek: '5G', popis: 'Synchronní struktura dřeva' },
  ],
  woodric: [
    { id: 'woodric_click', nazev: 'Woodric Click', cenaM2: 650, baleniM2: 2.196, tloustka: 4, naslap: 0.3, trida: '23/33', zamek: '2G', popis: 'Standardní řada' },
    { id: 'woodric_eir', nazev: 'Woodric EIR', cenaM2: 699, baleniM2: 2.196, tloustka: 4, naslap: 0.3, trida: '23/33', zamek: '2G', popis: 'Synchronní struktura' },
    { id: 'woodric_acoustic', nazev: 'Woodric Acoustic', cenaM2: 749, baleniM2: 2.196, tloustka: 4, naslap: 0.3, trida: '23/33', zamek: '2G', popis: 'S integrovanou podložkou' },
  ],
  liberal: [
    { id: 'liberal', nazev: 'Liberal Collection', cenaM2: 580, baleniM2: 2.196, tloustka: 4, naslap: 0.3, trida: '23/32', zamek: '2G', popis: 'Ekonomická řada' },
  ],
  biclick: [
    { id: 'biclick', nazev: 'Afirmax BiClick Floor', cenaM2: 638, baleniM2: 2.196, tloustka: 4, naslap: 0.3, trida: '23/32', zamek: '2G', popis: 'Entry level' },
  ]
};

const arbitonPodlozky = [
  { id: 'multiprotec_antislip', nazev: 'Multiprotec Vinyl Click Antislip', cenaM2: 164, baleniM2: 8, tloustka: 1.6, tepelnyOdpor: 0.008, tlumeni: 16, popis: 'Premium, podlahové topení' },
  { id: 'multiprotec_hardlay', nazev: 'Multiprotec Super Hardlay', cenaM2: 159, baleniM2: 9, tloustka: 1.1, tepelnyOdpor: 0.004, tlumeni: 14, popis: 'Na dlažbu, vysoká zátěž' },
  { id: 'multiprotec_acoustic', nazev: 'Multiprotec Acoustic 3in1', cenaM2: 145, baleniM2: 8, tloustka: 1.5, tepelnyOdpor: 0.010, tlumeni: 18, popis: 'Akustická, 3v1 systém' },
  { id: 'secura_vinyl', nazev: 'Secura Vinyl Click 3in1', cenaM2: 89, baleniM2: 6.25, tloustka: 1.5, tepelnyOdpor: 0.015, tlumeni: 19, popis: 'Ekonomická' },
  { id: 'secura_smart', nazev: 'Secura LVT Smart', cenaM2: 79, baleniM2: 6.25, tloustka: 1.5, tepelnyOdpor: 0.015, tlumeni: 17, popis: 'Entry level' },
];

const arbitonSokly = {
  vigo: [
    { id: 'vigo60_bila', nazev: 'VIGO 60 Bílá RAL 9003', cenaBm: 80, delka: 2.2, vyska: 60, popis: 'Univerzální bílá' },
    { id: 'vigo60_seda', nazev: 'VIGO 60 Šedá', cenaBm: 85, delka: 2.2, vyska: 60, popis: 'Antracit/tmavě šedá' },
    { id: 'vigo60_dekor', nazev: 'VIGO 60 Dřevodekor', cenaBm: 95, delka: 2.2, vyska: 60, popis: 'Dub, ořech a další' },
    { id: 'vigo80_bila', nazev: 'VIGO 80 Bílá RAL 9003', cenaBm: 105, delka: 2.2, vyska: 80, popis: 'Vyšší, moderní' },
  ],
  indo: [
    { id: 'indo_dekor', nazev: 'INDO Dřevodekor', cenaBm: 56, delka: 2.5, vyska: 70, popis: 'Dekory Egger' },
    { id: 'indo_bila', nazev: 'INDO Bílá', cenaBm: 52, delka: 2.5, vyska: 70, popis: 'Základní bílá' },
  ]
};

const arbitonPrislusenstvi = {
  vigo: { rohVnitrni: 42, rohVnejsi: 42, spojka: 32, ukonceni: 38, klip: 6 },
  indo: { rohVnitrni: 28, rohVnejsi: 28, spojka: 22, ukonceni: 25, klip: 5 }
};

const arbitonPrechody = [
  { id: 'cs37_stribrna', nazev: 'CS37 Stříbrná', cenaKs: 220, delka: 0.93, sirka: 37, popis: 'Univerzální 0-17mm' },
  { id: 'cs37_dekor', nazev: 'CS37 Dřevodekor', cenaKs: 245, delka: 0.93, sirka: 37, popis: 'Dekor dřeva' },
  { id: 'cs25_stribrna', nazev: 'CS25 Stříbrná', cenaKs: 175, delka: 0.93, sirka: 25, popis: 'Úzká 0-5mm' },
  { id: 'ukoncovaci', nazev: 'Ukončovací profil', cenaKs: 185, delka: 0.93, sirka: 25, popis: 'Ukončení podlahy' },
];

const arbitonDoplnky = {
  aluTape: { nazev: 'ALU Tape spojovací páska', cenaKs: 95 },
  lepidlo: { nazev: 'Montážní lepidlo na lišty', cenaKs: 175 },
  instalacniSada: { nazev: 'Instalační sada', cenaKs: 299 }
};

let podlahyState = {
  kategorie: 'amaron',
  typ: 'amaron_wood',
  podlozka: 'multiprotec_antislip',
  soklTyp: 'vigo',
  soklVarianta: 'vigo60_bila',
  prechod: 'cs37_stribrna'
};

function renderPodlahyAll() {
  renderPodlahyKategorie();
  renderPodlahyTypy();
  renderPodlahyPodlozky();
  renderPodlahySokly();
  renderPodlahyPrechody();
}

function renderPodlahyKategorie() {
  const kategorie = [
    { id: 'amaron', nazev: 'Amaron', popis: 'Premium 800-900 Kč/m²' },
    { id: 'woodric', nazev: 'Woodric', popis: 'Standard 650-750 Kč/m²' },
    { id: 'liberal', nazev: 'Liberal', popis: 'Economy 550-600 Kč/m²' },
    { id: 'biclick', nazev: 'BiClick', popis: 'Entry 600-650 Kč/m²' }
  ];
  document.getElementById('podlahyKategorieList').innerHTML = '<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">' + kategorie.map(k => '<div class="option ' + (podlahyState.kategorie === k.id ? 'active' : '') + '" style="padding:10px;" onclick="selectPodlahyKategorie(\'' + k.id + '\')"><div class="option-dot" style="margin-top:0;"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title" style="font-size:12px;">' + k.nazev + '</div><div class="option-desc" style="font-size:10px;">' + k.popis + '</div></div></div>').join('') + '</div>';
}

function selectPodlahyKategorie(kat) {
  podlahyState.kategorie = kat;
  podlahyState.typ = arbitonPodlahy[kat][0].id;
  renderPodlahyKategorie();
  renderPodlahyTypy();
  vypoctiPodlahy();
}

function renderPodlahyTypy() {
  const list = arbitonPodlahy[podlahyState.kategorie];
  document.getElementById('podlahyTyp').innerHTML = list.map(p => '<option value="' + p.id + '" ' + (podlahyState.typ === p.id ? 'selected' : '') + '>' + p.nazev + ' (' + p.cenaM2 + ' Kč/m²)</option>').join('');
  document.getElementById('podlahyTyp').onchange = function() { podlahyState.typ = this.value; renderPodlahyTypInfo(); vypoctiPodlahy(); };
  renderPodlahyTypInfo();
}

function renderPodlahyTypInfo() {
  const allP = [...arbitonPodlahy.amaron, ...arbitonPodlahy.woodric, ...arbitonPodlahy.liberal, ...arbitonPodlahy.biclick];
  const p = allP.find(x => x.id === podlahyState.typ);
  if (!p) return;
  document.getElementById('podlahyTypInfo').innerHTML = '<div style="background:var(--g100);padding:10px;border-radius:8px;font-size:11px;"><div style="color:var(--g500);">' + p.popis + '</div><div style="color:var(--text);margin-top:4px;">Tl. ' + p.tloustka + 'mm • Nášlap ' + p.naslap + 'mm • Třída ' + p.trida + ' • Zámek ' + p.zamek + ' • Balení ' + p.baleniM2 + ' m²</div></div>';
}

function renderPodlahyPodlozky() {
  document.getElementById('podlahyPodlozkaList').innerHTML = arbitonPodlozky.map(p => '<div class="option ' + (podlahyState.podlozka === p.id ? 'active' : '') + '" onclick="selectPodlahyPodlozka(\'' + p.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + p.nazev + infoTooltip(p.popis + '. Tl. ' + p.tloustka + 'mm, R=' + p.tepelnyOdpor + ' m²K/W, ' + p.tlumeni + 'dB') + '</div><div class="option-desc">' + p.cenaM2 + ' Kč/m²</div></div></div>').join('');
}

function selectPodlahyPodlozka(id) {
  podlahyState.podlozka = id;
  renderPodlahyPodlozky();
  vypoctiPodlahy();
}

function setPodlahySoklTyp(typ, el) {
  podlahyState.soklTyp = typ;
  podlahyState.soklVarianta = arbitonSokly[typ][0].id;
  el.parentElement.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  renderPodlahySokly();
  vypoctiPodlahy();
}

function renderPodlahySokly() {
  const list = arbitonSokly[podlahyState.soklTyp];
  document.getElementById('podlahySoklVarianta').innerHTML = list.map(s => '<option value="' + s.id + '" ' + (podlahyState.soklVarianta === s.id ? 'selected' : '') + '>' + s.nazev + ' (' + s.cenaBm + ' Kč/bm)</option>').join('');
  document.getElementById('podlahySoklVarianta').onchange = function() { podlahyState.soklVarianta = this.value; vypoctiPodlahy(); };
}

function renderPodlahyPrechody() {
  document.getElementById('podlahyPrechod').innerHTML = arbitonPrechody.map(p => '<option value="' + p.id + '" ' + (podlahyState.prechod === p.id ? 'selected' : '') + '>' + p.nazev + ' (' + p.cenaKs + ' Kč/ks)</option>').join('');
  document.getElementById('podlahyPrechod').onchange = function() { podlahyState.prechod = this.value; vypoctiPodlahy(); };
}

function vypoctiPodlahy() {
  const plocha = parseFloat(document.getElementById('podlahyPlocha').value) || 0;
  const obvod = parseFloat(document.getElementById('podlahyObvod').value) || 0;
  const dvere = parseInt(document.getElementById('podlahyDvere').value) || 0;
  const vnitrniRohy = parseInt(document.getElementById('podlahyVnitrniRohy').value) || 0;
  const vnejsiRohy = parseInt(document.getElementById('podlahyVnejsiRohy').value) || 0;
  const rezervaPodlaha = parseInt(document.getElementById('podlahyRezervaPodlaha').value) || 10;
  const rezervaListy = parseInt(document.getElementById('podlahyRezervaListy').value) || 5;
  const montazKlipy = document.getElementById('podlahyKlipy').checked;
  const instalacniSada = document.getElementById('podlahyInstalacniSada').checked;
  const topeni = document.getElementById('podlahyTopeni').checked;
  
  document.getElementById('podlahyTopeniWarning').style.display = topeni ? 'block' : 'none';
  
  if (plocha <= 0) { document.getElementById('podlahyResult').innerHTML = ''; return; }
  
  const plochaR = plocha * (1 + rezervaPodlaha / 100);
  const obvodR = obvod * (1 + rezervaListy / 100);
  const obvodProListy = Math.max(0, obvodR - (dvere * 0.9));
  
  // Najdi produkty
  const allP = [...arbitonPodlahy.amaron, ...arbitonPodlahy.woodric, ...arbitonPodlahy.liberal, ...arbitonPodlahy.biclick];
  const podlaha = allP.find(p => p.id === podlahyState.typ);
  const podlozka = arbitonPodlozky.find(p => p.id === podlahyState.podlozka);
  const allS = [...arbitonSokly.vigo, ...arbitonSokly.indo];
  const sokl = allS.find(s => s.id === podlahyState.soklVarianta);
  const prechod = arbitonPrechody.find(p => p.id === podlahyState.prechod);
  const pris = arbitonPrislusenstvi[podlahyState.soklTyp];
  
  const polozky = [];
  let celkem = 0;
  
  // 1. PODLAHA
  if (podlaha) {
    const pocetBaleni = Math.ceil(plochaR / podlaha.baleniM2);
    const skutecnaM2 = pocetBaleni * podlaha.baleniM2;
    const cena = skutecnaM2 * podlaha.cenaM2;
    polozky.push({ nazev: podlaha.nazev, detail: skutecnaM2.toFixed(2) + ' m² (' + pocetBaleni + ' bal.)', info: 'Tl. ' + podlaha.tloustka + 'mm, nášlap ' + podlaha.naslap + 'mm', cena, kat: 'Podlaha' });
    celkem += cena;
  }
  
  // 2. PODLOŽKA
  if (podlozka) {
    const potrebaM2 = plochaR * 1.05;
    const pocetBaleni = Math.ceil(potrebaM2 / podlozka.baleniM2);
    const skutecnaM2 = pocetBaleni * podlozka.baleniM2;
    const cena = skutecnaM2 * podlozka.cenaM2;
    polozky.push({ nazev: podlozka.nazev, detail: skutecnaM2.toFixed(1) + ' m² (' + pocetBaleni + ' bal.)', info: 'Tl. ' + podlozka.tloustka + 'mm, R=' + podlozka.tepelnyOdpor + ', ' + podlozka.tlumeni + 'dB', cena, kat: 'Podložka' });
    celkem += cena;
    
    // Spojovací páska
    const pocetPasek = Math.ceil(plocha / 50);
    if (pocetPasek > 0) {
      const cenaPasky = pocetPasek * arbitonDoplnky.aluTape.cenaKs;
      polozky.push({ nazev: arbitonDoplnky.aluTape.nazev, detail: pocetPasek + ' ks', info: 'Pro spojení podložek', cena: cenaPasky, kat: 'Podložka' });
      celkem += cenaPasky;
    }
  }
  
  // 3. SOKLOVÉ LIŠTY
  if (sokl && obvodProListy > 0) {
    const pocetListy = Math.ceil(obvodProListy / sokl.delka);
    const cenaListy = obvodProListy * sokl.cenaBm;
    polozky.push({ nazev: sokl.nazev, detail: obvodProListy.toFixed(1) + ' bm (' + pocetListy + ' ks)', info: 'Výška ' + sokl.vyska + 'mm', cena: cenaListy, kat: 'Soklové lišty' });
    celkem += cenaListy;
    
    // Vnitřní rohy
    if (vnitrniRohy > 0) {
      const c = vnitrniRohy * pris.rohVnitrni;
      polozky.push({ nazev: 'Roh vnitřní ' + podlahyState.soklTyp.toUpperCase(), detail: vnitrniRohy + ' ks', cena: c, kat: 'Soklové lišty' });
      celkem += c;
    }
    
    // Vnější rohy
    if (vnejsiRohy > 0) {
      const c = vnejsiRohy * pris.rohVnejsi;
      polozky.push({ nazev: 'Roh vnější ' + podlahyState.soklTyp.toUpperCase(), detail: vnejsiRohy + ' ks', cena: c, kat: 'Soklové lišty' });
      celkem += c;
    }
    
    // Spojky
    const pocetSpojek = Math.max(0, pocetListy - Math.ceil(obvodProListy / (sokl.delka * 2)));
    if (pocetSpojek > 0) {
      const c = pocetSpojek * pris.spojka;
      polozky.push({ nazev: 'Spojka ' + podlahyState.soklTyp.toUpperCase(), detail: pocetSpojek + ' ks', cena: c, kat: 'Soklové lišty' });
      celkem += c;
    }
    
    // Ukončení
    if (dvere > 0) {
      const pocetUkonceni = dvere * 2;
      const c = pocetUkonceni * pris.ukonceni;
      polozky.push({ nazev: 'Ukončení ' + podlahyState.soklTyp.toUpperCase() + ' L/P', detail: pocetUkonceni + ' ks', cena: c, kat: 'Soklové lišty' });
      celkem += c;
    }
    
    // Klipy nebo lepidlo
    if (montazKlipy) {
      const pocetKlipu = Math.ceil(obvodProListy / 0.45);
      const c = pocetKlipu * pris.klip;
      polozky.push({ nazev: 'Montážní klip ' + podlahyState.soklTyp.toUpperCase(), detail: pocetKlipu + ' ks', info: 'Rozteč 45 cm', cena: c, kat: 'Soklové lišty' });
      celkem += c;
    } else {
      const pocetLepidel = Math.ceil(obvodProListy / 15);
      const c = pocetLepidel * arbitonDoplnky.lepidlo.cenaKs;
      polozky.push({ nazev: arbitonDoplnky.lepidlo.nazev, detail: pocetLepidel + ' ks', cena: c, kat: 'Soklové lišty' });
      celkem += c;
    }
  }
  
  // 4. PŘECHODOVÉ LIŠTY
  if (prechod && dvere > 0) {
    const c = dvere * prechod.cenaKs;
    polozky.push({ nazev: prechod.nazev, detail: dvere + ' ks', info: 'Délka ' + prechod.delka + 'm, šířka ' + prechod.sirka + 'mm', cena: c, kat: 'Přechodové lišty' });
    celkem += c;
  }
  
  // 5. INSTALAČNÍ SADA
  if (instalacniSada) {
    polozky.push({ nazev: arbitonDoplnky.instalacniSada.nazev, detail: '1 ks', info: 'Dorazový blok, páčidlo, klínky', cena: arbitonDoplnky.instalacniSada.cenaKs, kat: 'Příslušenství' });
    celkem += arbitonDoplnky.instalacniSada.cenaKs;
  }
  
  // Render výsledku
  const kategorie = ['Podlaha', 'Podložka', 'Soklové lišty', 'Přechodové lišty', 'Příslušenství'];
  let html = '<div class="result"><div class="card-title">Kalkulace materiálu</div>';
  
  kategorie.forEach(kat => {
    const items = polozky.filter(p => p.kat === kat);
    if (items.length === 0) return;
    html += '<div style="font-size:10px;font-weight:600;color:var(--g400);text-transform:uppercase;margin:12px 0 6px;">' + kat + '</div>';
    items.forEach(p => {
      html += '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + p.detail + '</div>' + (p.info ? '<div style="font-size:10px;color:var(--g400);margin-top:2px;">' + p.info + '</div>' : '') + '</div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>';
    });
  });
  
  html += '<div class="result-total"><span class="result-total-label">CELKEM</span><span class="result-total-value">' + formatCena(celkem) + '</span></div>';
  html += '<div class="result-per-m2">' + Math.round(celkem / plocha) + ' Kč/m²</div></div>';
  
  document.getElementById('podlahyResult').innerHTML = html;
}

// === ETICS DATABÁZE ===
const eticsIzolanty = {
  eps: [
    { id: 'eps50', nazev: 'EPS 70F 50 mm', tloustka: 50, cenaM2: 79 },
    { id: 'eps60', nazev: 'EPS 70F 60 mm', tloustka: 60, cenaM2: 95 },
    { id: 'eps80', nazev: 'EPS 70F 80 mm', tloustka: 80, cenaM2: 127 },
    { id: 'eps100', nazev: 'EPS 70F 100 mm', tloustka: 100, cenaM2: 159 },
    { id: 'eps120', nazev: 'EPS 70F 120 mm', tloustka: 120, cenaM2: 190 },
    { id: 'eps140', nazev: 'EPS 70F 140 mm', tloustka: 140, cenaM2: 222 },
    { id: 'eps160', nazev: 'EPS 70F 160 mm', tloustka: 160, cenaM2: 254 },
    { id: 'eps180', nazev: 'EPS 70F 180 mm', tloustka: 180, cenaM2: 286 },
    { id: 'eps200', nazev: 'EPS 70F 200 mm', tloustka: 200, cenaM2: 318 },
  ],
  epsGrey: [
    { id: 'epsg80', nazev: 'EPS GreyWall 80 mm', tloustka: 80, cenaM2: 175 },
    { id: 'epsg100', nazev: 'EPS GreyWall 100 mm', tloustka: 100, cenaM2: 219 },
    { id: 'epsg120', nazev: 'EPS GreyWall 120 mm', tloustka: 120, cenaM2: 263 },
    { id: 'epsg140', nazev: 'EPS GreyWall 140 mm', tloustka: 140, cenaM2: 307 },
    { id: 'epsg160', nazev: 'EPS GreyWall 160 mm', tloustka: 160, cenaM2: 351 },
  ],
  mw: [
    { id: 'mw80', nazev: 'Minerální vata 80 mm', tloustka: 80, cenaM2: 320 },
    { id: 'mw100', nazev: 'Minerální vata 100 mm', tloustka: 100, cenaM2: 400 },
    { id: 'mw120', nazev: 'Minerální vata 120 mm', tloustka: 120, cenaM2: 480 },
    { id: 'mw140', nazev: 'Minerální vata 140 mm', tloustka: 140, cenaM2: 560 },
    { id: 'mw160', nazev: 'Minerální vata 160 mm', tloustka: 160, cenaM2: 640 },
    { id: 'mw180', nazev: 'Minerální vata 180 mm', tloustka: 180, cenaM2: 720 },
    { id: 'mw200', nazev: 'Minerální vata 200 mm', tloustka: 200, cenaM2: 800 },
  ],
  xps: [
    { id: 'xps30', nazev: 'XPS soklový 30 mm', tloustka: 30, cenaM2: 145 },
    { id: 'xps50', nazev: 'XPS soklový 50 mm', tloustka: 50, cenaM2: 242 },
    { id: 'xps60', nazev: 'XPS soklový 60 mm', tloustka: 60, cenaM2: 290 },
    { id: 'xps80', nazev: 'XPS soklový 80 mm', tloustka: 80, cenaM2: 387 },
    { id: 'xps100', nazev: 'XPS soklový 100 mm', tloustka: 100, cenaM2: 484 },
  ]
};

const eticsHmozdinky = [
  { delka: 115, cenaKs: 11.5 },
  { delka: 135, cenaKs: 12.5 },
  { delka: 155, cenaKs: 13.85 },
  { delka: 175, cenaKs: 16.07 },
  { delka: 195, cenaKs: 19.58 },
  { delka: 215, cenaKs: 20.88 },
  { delka: 235, cenaKs: 22.18 },
  { delka: 255, cenaKs: 25.41 },
  { delka: 275, cenaKs: 28 },
  { delka: 315, cenaKs: 35 },
];

const eticsProfily = {
  zakladaci: { nazev: 'Zakládací lišta Al', cenaBm: 85 },
  rohove: { nazev: 'Rohový profil PVC se síťovinou', cenaBm: 35 },
  okenniZakladni: { nazev: 'Okenní profil APU', cenaBm: 28 },
  okenniPremium: { nazev: 'Okenní profil s těsněním', cenaBm: 45 },
  okapnice: { nazev: 'Nadokenní okapnička', cenaBm: 55 },
  parapetni: { nazev: 'Parapetní profil', cenaBm: 65 },
};

const eticsBaumit = {
  lepidla: [
    { id: 'duocontact', nazev: 'DuoContact', cenaKg: 8.83, baleni: 25, spotrebaLepeni: 4, spotrebaSterka: 4, popis: 'Ekonomický, univerzální' },
    { id: 'starcontact', nazev: 'StarContact', cenaKg: 20.52, baleni: 25, spotrebaLepeni: 4, spotrebaSterka: 4, popis: 'Standardní kvalita' },
    { id: 'procontact', nazev: 'ProContact', cenaKg: 12.97, baleni: 25, spotrebaLepeni: 4, spotrebaSterka: 4, popis: 'Profesionální' },
    { id: 'opencontact', nazev: 'openContact', cenaKg: 25.65, baleni: 25, spotrebaLepeni: 5, spotrebaSterka: 5, popis: 'Paropropustný pro MW' },
  ],
  sitoviny: [
    { id: 'duotex', nazev: 'DuoTex 145 g/m²', cenaM2: 28, popis: 'Ekonomická síťovina' },
    { id: 'startex', nazev: 'StarTex 160 g/m²', cenaM2: 32, popis: 'Standardní síťovina' },
    { id: 'opentex', nazev: 'openTex 165 g/m²', cenaM2: 45, popis: 'Pro systém open' },
    { id: 'pancir', nazev: 'Pancéřová 340 g/m²', cenaM2: 85, popis: 'Sokl, přízemí, veřejné budovy' },
  ],
  penetrace: [
    { id: 'uniprimer', nazev: 'UniPrimer', cenaKg: 65, baleni: 25, spotreba: 0.2, popis: 'Univerzální' },
    { id: 'premiumprimer', nazev: 'PremiumPrimer', cenaKg: 85, baleni: 20, spotreba: 0.2, popis: 'Pro systém open' },
  ],
  omitky: [
    { id: 'silikontop15', nazev: 'SilikonTop 1.5 mm', cenaKg: 63.16, baleni: 25, spotreba: 2.5, typ: 'silikon', popis: 'Silikonová škrábaná' },
    { id: 'silikontop20', nazev: 'SilikonTop 2 mm', cenaKg: 63.16, baleni: 25, spotreba: 2.9, typ: 'silikon', popis: 'Silikonová škrábaná' },
    { id: 'startop15', nazev: 'StarTop 1.5 mm', cenaKg: 79.86, baleni: 25, spotreba: 2.5, typ: 'silikon', popis: 'Prémiová Drypor' },
    { id: 'startop20', nazev: 'StarTop 2 mm', cenaKg: 79.86, baleni: 25, spotreba: 2.9, typ: 'silikon', popis: 'Prémiová Drypor' },
    { id: 'siliportop15', nazev: 'SiliporTop 1.5 mm', cenaKg: 52, baleni: 25, spotreba: 2.5, typ: 'silikon', popis: 'Ekonomická silikonová' },
    { id: 'nanoportop15', nazev: 'NanoporTop 1.5 mm', cenaKg: 95, baleni: 25, spotreba: 2.5, typ: 'silikát', popis: 'Silikátová samočistící' },
    { id: 'granoportop15', nazev: 'GranoporTop 1.5 mm', cenaKg: 45, baleni: 25, spotreba: 2.5, typ: 'akrylát', popis: 'Akrylátová' },
    { id: 'mosaiktop', nazev: 'MosaikTop', cenaKg: 85, baleni: 25, spotreba: 4.5, typ: 'mozaika', popis: 'Soklová mozaiková' },
  ],
};

const eticsWeber = {
  lepidla: [
    { id: 'klasik', nazev: 'therm klasik', cenaKg: 9.5, baleni: 25, spotrebaLepeni: 4, spotrebaSterka: 4, popis: 'Základní' },
    { id: 'elastik', nazev: 'therm elastik', cenaKg: 15, baleni: 25, spotrebaLepeni: 4, spotrebaSterka: 4, popis: 'Elastická stěrka' },
    { id: 'plusultra', nazev: 'therm plus ultra', cenaKg: 22, baleni: 25, spotrebaLepeni: 4, spotrebaSterka: 4, popis: 'Prémiové' },
  ],
  sitoviny: [
    { id: 'webertex', nazev: 'therm síťovina 160 g/m²', cenaM2: 30, popis: 'Standardní' },
    { id: 'weberpancir', nazev: 'Pancéřová 340 g/m²', cenaM2: 85, popis: 'Sokl, přízemí' },
  ],
  penetrace: [
    { id: 'weberpodklad', nazev: 'pas podklad UNI', cenaKg: 72, baleni: 20, spotreba: 0.25, popis: 'Univerzální' },
  ],
  omitky: [
    { id: 'passilikon15', nazev: 'pas silikon 1.5 mm', cenaKg: 68, baleni: 25, spotreba: 2.5, typ: 'silikon', popis: 'Silikonová' },
    { id: 'passilikon20', nazev: 'pas silikon 2 mm', cenaKg: 68, baleni: 25, spotreba: 2.9, typ: 'silikon', popis: 'Silikonová' },
    { id: 'passilikat15', nazev: 'pas silikát 1.5 mm', cenaKg: 62, baleni: 25, spotreba: 2.5, typ: 'silikát', popis: 'Silikátová' },
    { id: 'pasakrylat15', nazev: 'pas akrylát 1.5 mm', cenaKg: 48, baleni: 25, spotreba: 2.5, typ: 'akrylát', popis: 'Akrylátová' },
    { id: 'pasmarmolit', nazev: 'pas marmolit', cenaKg: 78, baleni: 25, spotreba: 4.5, typ: 'mozaika', popis: 'Soklová marmolitová' },
  ],
};

let eticsState = {
  baumit: { izolant: 'eps', tloustka: 'eps100', xps: 'xps50', lepidlo: 'starcontact', sitovina: 'startex', penetrace: 'uniprimer', omitka: 'silikontop15', omitkaSokl: 'mosaiktop', okenniProfil: 'zakladni' },
  weber: { izolant: 'eps', tloustka: 'eps100', xps: 'xps50', lepidlo: 'elastik', sitovina: 'webertex', penetrace: 'weberpodklad', omitka: 'passilikon15', omitkaSokl: 'pasmarmolit', okenniProfil: 'zakladni' }
};

function selectEticsTab(tab, el) {
  document.querySelectorAll('#eticsPage .tabs .tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('baumitContent').style.display = tab === 'baumit' ? 'block' : 'none';
  document.getElementById('weberContent').style.display = tab === 'weber' ? 'block' : 'none';
}

function togglePozarniPasy(system) {
  const checked = document.getElementById(system + 'PozarniPasy').checked;
  document.getElementById(system + 'PozarniPasyInput').style.display = checked ? 'block' : 'none';
  vypoctiEtics(system);
}

function renderEticsAll() {
  ['baumit', 'weber'].forEach(system => {
    renderEticsIzolanty(system);
    renderEticsTloustky(system);
    renderEticsXps(system);
    renderEticsLepidla(system);
    renderEticsSitoviny(system);
    renderEticsPenetrace(system);
    renderEticsOmitky(system);
    renderEticsOmitkySokl(system);
    renderEticsOkenniProfily(system);
  });
}

function renderEticsIzolanty(system) {
  const types = [
    { id: 'eps', nazev: 'EPS 70F (bílý)', popis: 'Nejlevnější, λ=0,039' },
    { id: 'epsGrey', nazev: 'EPS GreyWall (šedý)', popis: 'O 20% lepší λ=0,032' },
    { id: 'mw', nazev: 'Minerální vata', popis: 'Nehořlavá A1, λ=0,036' }
  ];
  document.getElementById(system + 'IzolantList').innerHTML = types.map(t => '<div class="option ' + (eticsState[system].izolant === t.id ? 'active' : '') + '" onclick="selectEticsIzolant(\'' + system + '\',\'' + t.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + t.nazev + '</div><div class="option-desc">' + t.popis + '</div></div></div>').join('');
}

function selectEticsIzolant(system, typ) {
  eticsState[system].izolant = typ;
  const first = typ === 'eps' ? 'eps100' : typ === 'epsGrey' ? 'epsg100' : 'mw100';
  eticsState[system].tloustka = first;
  renderEticsIzolanty(system);
  renderEticsTloustky(system);
  vypoctiEtics(system);
}

function renderEticsTloustky(system) {
  const typ = eticsState[system].izolant;
  const list = eticsIzolanty[typ];
  document.getElementById(system + 'Tloustka').innerHTML = list.map(i => '<option value="' + i.id + '" ' + (eticsState[system].tloustka === i.id ? 'selected' : '') + '>' + i.nazev + ' (' + i.cenaM2 + ' Kč/m²)</option>').join('');
  document.getElementById(system + 'Tloustka').onchange = function() { eticsState[system].tloustka = this.value; vypoctiEtics(system); };
}

function renderEticsXps(system) {
  document.getElementById(system + 'Xps').innerHTML = eticsIzolanty.xps.map(i => '<option value="' + i.id + '" ' + (eticsState[system].xps === i.id ? 'selected' : '') + '>' + i.nazev + ' (' + i.cenaM2 + ' Kč/m²)</option>').join('');
  document.getElementById(system + 'Xps').onchange = function() { eticsState[system].xps = this.value; vypoctiEtics(system); };
}

function renderEticsLepidla(system) {
  const data = system === 'baumit' ? eticsBaumit : eticsWeber;
  const prefix = system === 'baumit' ? 'Baumit ' : 'weber.';
  document.getElementById(system + 'LepidloList').innerHTML = data.lepidla.map(l => '<div class="option ' + (eticsState[system].lepidlo === l.id ? 'active' : '') + '" onclick="selectEticsLepidlo(\'' + system + '\',\'' + l.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + prefix + l.nazev + infoTooltip(l.popis) + '</div><div class="option-desc">' + (l.cenaKg * l.baleni).toFixed(0) + ' Kč/' + l.baleni + 'kg</div></div></div>').join('');
}

function selectEticsLepidlo(system, id) { eticsState[system].lepidlo = id; renderEticsLepidla(system); vypoctiEtics(system); }

function renderEticsSitoviny(system) {
  const data = system === 'baumit' ? eticsBaumit : eticsWeber;
  document.getElementById(system + 'SitovinaList').innerHTML = data.sitoviny.map(s => '<div class="option ' + (eticsState[system].sitovina === s.id ? 'active' : '') + '" onclick="selectEticsSitovina(\'' + system + '\',\'' + s.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + s.nazev + infoTooltip(s.popis) + '</div><div class="option-desc">' + s.cenaM2 + ' Kč/m²</div></div></div>').join('');
}

function selectEticsSitovina(system, id) { eticsState[system].sitovina = id; renderEticsSitoviny(system); vypoctiEtics(system); }

function renderEticsPenetrace(system) {
  const data = system === 'baumit' ? eticsBaumit : eticsWeber;
  const prefix = system === 'baumit' ? 'Baumit ' : 'weber.';
  document.getElementById(system + 'Penetrace').innerHTML = data.penetrace.map(p => '<option value="' + p.id + '" ' + (eticsState[system].penetrace === p.id ? 'selected' : '') + '>' + prefix + p.nazev + ' (' + (p.cenaKg * p.baleni).toFixed(0) + ' Kč/' + p.baleni + 'kg)</option>').join('');
  document.getElementById(system + 'Penetrace').onchange = function() { eticsState[system].penetrace = this.value; vypoctiEtics(system); };
}

function renderEticsOmitky(system) {
  const data = system === 'baumit' ? eticsBaumit : eticsWeber;
  const prefix = system === 'baumit' ? 'Baumit ' : 'weber.';
  const omitky = data.omitky.filter(o => o.typ !== 'mozaika');
  document.getElementById(system + 'OmitkaList').innerHTML = omitky.map(o => '<div class="option ' + (eticsState[system].omitka === o.id ? 'active' : '') + '" onclick="selectEticsOmitka(\'' + system + '\',\'' + o.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + prefix + o.nazev + infoTooltip(o.popis) + '</div><div class="option-desc">' + (o.cenaKg * o.baleni).toFixed(0) + ' Kč/' + o.baleni + 'kg | ' + o.typ + '</div></div></div>').join('');
}

function selectEticsOmitka(system, id) { eticsState[system].omitka = id; renderEticsOmitky(system); vypoctiEtics(system); }

function renderEticsOmitkySokl(system) {
  const data = system === 'baumit' ? eticsBaumit : eticsWeber;
  const prefix = system === 'baumit' ? 'Baumit ' : 'weber.';
  document.getElementById(system + 'OmitkaSokl').innerHTML = data.omitky.map(o => '<option value="' + o.id + '" ' + (eticsState[system].omitkaSokl === o.id ? 'selected' : '') + '>' + prefix + o.nazev + ' (' + (o.cenaKg * o.baleni).toFixed(0) + ' Kč/' + o.baleni + 'kg)</option>').join('');
  document.getElementById(system + 'OmitkaSokl').onchange = function() { eticsState[system].omitkaSokl = this.value; vypoctiEtics(system); };
}

function renderEticsOkenniProfily(system) {
  const profily = [
    { id: 'zakladni', nazev: 'APU lišta základní', cena: 28 },
    { id: 'premium', nazev: 'APU lišta s těsněním', cena: 45 }
  ];
  document.getElementById(system + 'OkenniProfilList').innerHTML = profily.map(p => '<div class="option ' + (eticsState[system].okenniProfil === p.id ? 'active' : '') + '" onclick="selectEticsOkenniProfil(\'' + system + '\',\'' + p.id + '\')"><div class="option-dot"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div><div class="option-text"><div class="option-title">' + p.nazev + '</div><div class="option-desc">' + p.cena + ' Kč/bm</div></div></div>').join('');
}

function selectEticsOkenniProfil(system, id) { eticsState[system].okenniProfil = id; renderEticsOkenniProfily(system); vypoctiEtics(system); }

function vyberHmozdinku(tloustka) {
  const potrebnaDelka = tloustka + 55;
  return eticsHmozdinky.find(h => h.delka >= potrebnaDelka) || eticsHmozdinky[eticsHmozdinky.length - 1];
}

function vypoctiEtics(system) {
  const plocha = parseFloat(document.getElementById(system + 'Plocha').value) || 0;
  const sokl = parseFloat(document.getElementById(system + 'Sokl').value) || 0;
  const obvod = parseFloat(document.getElementById(system + 'Obvod').value) || 0;
  const rohy = parseFloat(document.getElementById(system + 'Rohy').value) || 0;
  const pocetOken = parseInt(document.getElementById(system + 'PocetOken').value) || 0;
  const obvodOken = parseFloat(document.getElementById(system + 'ObvodOken').value) || 0;
  const sirkaOken = parseFloat(document.getElementById(system + 'SirkaOken').value) || 0;
  const rezerva = parseInt(document.getElementById(system + 'Rezerva').value) || 10;
  const hmozdinkyM2 = parseInt(document.getElementById(system + 'HmozdinkyM2').value) || 6;
  const pozarniPasy = document.getElementById(system + 'PozarniPasy').checked;
  const pozarniPasyBm = parseFloat(document.getElementById(system + 'PozarniPasyBm').value) || 0;
  
  if (plocha <= 0) { document.getElementById(system + 'Result').innerHTML = ''; return; }
  
  const data = system === 'baumit' ? eticsBaumit : eticsWeber;
  const state = eticsState[system];
  const prefix = system === 'baumit' ? 'Baumit ' : 'weber.';
  
  const plochaR = plocha * (1 + rezerva / 100);
  const soklR = sokl * (1 + rezerva / 100);
  const celkemPlocha = plochaR + soklR;
  
  // Najdi vybrané produkty
  const allIzolanty = [...eticsIzolanty.eps, ...eticsIzolanty.epsGrey, ...eticsIzolanty.mw];
  const izolant = allIzolanty.find(i => i.id === state.tloustka);
  const xps = eticsIzolanty.xps.find(i => i.id === state.xps);
  const lepidlo = data.lepidla.find(l => l.id === state.lepidlo);
  const sitovina = data.sitoviny.find(s => s.id === state.sitovina);
  const penetrace = data.penetrace.find(p => p.id === state.penetrace);
  const omitka = data.omitky.find(o => o.id === state.omitka);
  const omitkaSokl = data.omitky.find(o => o.id === state.omitkaSokl);
  const hmozdinka = vyberHmozdinku(izolant ? izolant.tloustka : 100);
  
  const polozky = [];
  let celkem = 0;
  
  // 1. IZOLANT FASÁDA
  if (izolant) {
    const cena = plochaR * izolant.cenaM2;
    polozky.push({ nazev: izolant.nazev, detail: plochaR.toFixed(1) + ' m²', cena, kategorie: 'Izolace' });
    celkem += cena;
  }
  
  // 2. XPS SOKL
  if (sokl > 0 && xps) {
    const cena = soklR * xps.cenaM2;
    polozky.push({ nazev: xps.nazev + ' (sokl)', detail: soklR.toFixed(1) + ' m²', cena, kategorie: 'Izolace' });
    celkem += cena;
  }
  
  // 3. POŽÁRNÍ PÁSY MW
  if (pozarniPasy && pozarniPasyBm > 0) {
    const plochaPasu = pozarniPasyBm * 0.2;
    const mwPas = eticsIzolanty.mw.find(m => m.tloustka === (izolant ? izolant.tloustka : 100)) || eticsIzolanty.mw[1];
    const cena = plochaPasu * mwPas.cenaM2 * 1.1;
    polozky.push({ nazev: 'MW požární pás 200mm', detail: plochaPasu.toFixed(1) + ' m² (' + pozarniPasyBm + ' bm)', cena, kategorie: 'Izolace', upozorneni: 'Povinné u h > 12m' });
    celkem += cena;
  }
  
  // 4. LEPIDLO (lepení)
  if (lepidlo) {
    const potreba = celkemPlocha * lepidlo.spotrebaLepeni;
    const baleni = Math.ceil(potreba / lepidlo.baleni);
    const cena = baleni * lepidlo.baleni * lepidlo.cenaKg;
    polozky.push({ nazev: prefix + lepidlo.nazev + ' (lepení)', detail: baleni + '× ' + lepidlo.baleni + 'kg', cena, kategorie: 'Lepidlo' });
    celkem += cena;
  }
  
  // 5. STĚRKA (armování)
  if (lepidlo) {
    const potreba = celkemPlocha * lepidlo.spotrebaSterka;
    const baleni = Math.ceil(potreba / lepidlo.baleni);
    const cena = baleni * lepidlo.baleni * lepidlo.cenaKg;
    polozky.push({ nazev: prefix + lepidlo.nazev + ' (stěrka)', detail: baleni + '× ' + lepidlo.baleni + 'kg', cena, kategorie: 'Lepidlo' });
    celkem += cena;
  }
  
  // 6. SÍŤOVINA
  if (sitovina) {
    const sitPlocha = celkemPlocha * 1.1;
    const cena = sitPlocha * sitovina.cenaM2;
    polozky.push({ nazev: sitovina.nazev, detail: sitPlocha.toFixed(1) + ' m² (vč. přesahů)', cena, kategorie: 'Armování' });
    celkem += cena;
  }
  
  // 7. HMOŽDINKY
  const hmozPocet = Math.ceil(celkemPlocha * hmozdinkyM2);
  const hmozCena = hmozPocet * hmozdinka.cenaKs;
  polozky.push({ nazev: 'EJOT STR-U 2G ' + hmozdinka.delka + ' mm', detail: hmozPocet + ' ks (' + hmozdinkyM2 + ' ks/m²)', cena: hmozCena, kategorie: 'Kotvení' });
  celkem += hmozCena;
  
  // 8. PENETRACE
  if (penetrace) {
    const potreba = celkemPlocha * penetrace.spotreba;
    const baleni = Math.ceil(potreba / penetrace.baleni);
    const cena = baleni * penetrace.baleni * penetrace.cenaKg;
    polozky.push({ nazev: prefix + penetrace.nazev, detail: baleni + '× ' + penetrace.baleni + 'kg', cena, kategorie: 'Penetrace' });
    celkem += cena;
  }
  
  // 9. OMÍTKA FASÁDA
  if (omitka) {
    const potreba = plochaR * omitka.spotreba;
    const baleni = Math.ceil(potreba / omitka.baleni);
    const cena = baleni * omitka.baleni * omitka.cenaKg;
    polozky.push({ nazev: prefix + omitka.nazev, detail: baleni + '× ' + omitka.baleni + 'kg | ' + omitka.typ, cena, kategorie: 'Omítka' });
    celkem += cena;
  }
  
  // 10. OMÍTKA SOKL
  if (sokl > 0 && omitkaSokl) {
    const potreba = soklR * omitkaSokl.spotreba;
    const baleni = Math.ceil(potreba / omitkaSokl.baleni);
    const cena = baleni * omitkaSokl.baleni * omitkaSokl.cenaKg;
    polozky.push({ nazev: prefix + omitkaSokl.nazev + ' (sokl)', detail: baleni + '× ' + omitkaSokl.baleni + 'kg', cena, kategorie: 'Omítka' });
    celkem += cena;
  }
  
  // PROFILY
  // 11. ZAKLÁDACÍ LIŠTA
  if (obvod > 0) {
    const potreba = obvod * 1.05;
    const cena = potreba * eticsProfily.zakladaci.cenaBm;
    polozky.push({ nazev: eticsProfily.zakladaci.nazev + ' (š. ' + (izolant ? izolant.tloustka : 100) + ' mm)', detail: potreba.toFixed(1) + ' bm', cena, kategorie: 'Profily' });
    celkem += cena;
  }
  
  // 12. ROHOVÉ PROFILY
  if (rohy > 0) {
    const potreba = rohy * 1.05;
    const cena = potreba * eticsProfily.rohove.cenaBm;
    polozky.push({ nazev: eticsProfily.rohove.nazev, detail: potreba.toFixed(1) + ' bm', cena, kategorie: 'Profily' });
    celkem += cena;
  }
  
  // 13. OKENNÍ PROFILY
  if (obvodOken > 0) {
    const profil = state.okenniProfil === 'premium' ? eticsProfily.okenniPremium : eticsProfily.okenniZakladni;
    const potreba = obvodOken * 1.05;
    const cena = potreba * profil.cenaBm;
    polozky.push({ nazev: profil.nazev, detail: potreba.toFixed(1) + ' bm', cena, kategorie: 'Profily' });
    celkem += cena;
  }
  
  // 14. OKAPNIČKY
  if (sirkaOken > 0) {
    const potreba = sirkaOken + (pocetOken * 0.2);
    const cena = potreba * eticsProfily.okapnice.cenaBm;
    polozky.push({ nazev: eticsProfily.okapnice.nazev, detail: potreba.toFixed(1) + ' bm', cena, kategorie: 'Profily' });
    celkem += cena;
  }
  
  // 15. PARAPETNÍ PROFILY
  if (sirkaOken > 0) {
    const potreba = sirkaOken * 1.05;
    const cena = potreba * eticsProfily.parapetni.cenaBm;
    polozky.push({ nazev: eticsProfily.parapetni.nazev, detail: potreba.toFixed(1) + ' bm', cena, kategorie: 'Profily' });
    celkem += cena;
  }
  
  document.getElementById(system + 'Result').innerHTML = '<div class="result"><div class="card-title">Kalkulace materiálu</div>' + polozky.map(p => '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + p.detail + '</div>' + (p.upozorneni ? '<div style="font-size:10px;color:var(--gold);margin-top:2px;">⚠️ ' + p.upozorneni + '</div>' : '') + '</div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>').join('') + '<div class="result-total"><span class="result-total-label">CELKEM materiál</span><span class="result-total-value">' + formatCena(celkem) + '</span></div><div class="result-per-m2">' + Math.round(celkem / (plocha + sokl)) + ' Kč/m²</div></div>';
}

// === VYTÁPĚNÍ ===
let vytapeniMistnosti = [];
let vytapeniIdCounter = 0;
let vytapeniSystem = null;

function pridatVytapeniMistnost() {
  vytapeniMistnosti.push({ id: vytapeniIdCounter++, nazev: 'Místnost ' + (vytapeniMistnosti.length + 1), plocha: 15, teplota: 20, typ: 'obytna' });
  renderVytapeniMistnosti();
  vypoctiVytapeniZtraty();
}

function odebratVytapeniMistnost(id) {
  vytapeniMistnosti = vytapeniMistnosti.filter(m => m.id !== id);
  renderVytapeniMistnosti();
  vypoctiVytapeniZtraty();
}

function updateVytapeniMistnost(id, pole, hodnota) {
  const m = vytapeniMistnosti.find(x => x.id === id);
  if (m) {
    m[pole] = pole === 'nazev' ? hodnota : parseFloat(hodnota);
    renderVytapeniMistnosti();
    vypoctiVytapeniZtraty();
  }
}

function getTepelnaZtrata(plocha, typ, vnitrniTeplota, deltaT) {
  // Měrná tepelná ztráta W/(m²·K) podle typu místnosti a kvality izolace
  // Pro novostavbu s dobrým zateplením cca 0.8-1.2 W/(m²·K)
  // Pro starší dům cca 1.5-2.5 W/(m²·K)
  const qM2K = { obytna: 1.8, kuchyn: 1.6, loznice: 1.7, koupelna: 2.2, chodba: 1.4 };
  const q = qM2K[typ] || 1.8;
  return Math.round(plocha * q * deltaT);
}

function renderVytapeniMistnosti() {
  const cont = document.getElementById('vytapeniMistnostiList');
  const venkovni = parseFloat(document.getElementById('vytapeniVenkovni').value) || -15;
  const vnitrni = parseFloat(document.getElementById('vytapeniVnitrni').value) || 20;
  const deltaT = vnitrni - venkovni;
  
  if (vytapeniMistnosti.length === 0) {
    cont.innerHTML = '<div style="text-align:center;padding:16px;color:var(--g400);font-size:12px;">Přidejte místnosti pro výpočet tepelných ztrát</div>';
    return;
  }
  cont.innerHTML = vytapeniMistnosti.map(m => {
    const mVnitrni = m.typ === 'koupelna' ? 24 : vnitrni;
    const mDeltaT = mVnitrni - venkovni;
    const ztrata = getTepelnaZtrata(m.plocha, m.typ, mVnitrni, mDeltaT);
    return '<div class="mistnost-card' + (m.typ === 'koupelna' ? ' vlhka' : '') + '">' +
      '<div class="mistnost-header"><input class="mistnost-name" value="' + m.nazev + '" onchange="updateVytapeniMistnost(' + m.id + ',\'nazev\',this.value)"><span style="font-weight:600;color:var(--gold-dark);font-size:13px;">' + ztrata + ' W</span><button class="mistnost-remove" onclick="odebratVytapeniMistnost(' + m.id + ')">×</button></div>' +
      '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:6px;margin-top:6px;">' +
        '<div><label style="font-size:9px;color:var(--g400);display:block;">Plocha m²</label><input type="number" style="width:100%;padding:6px;border:1px solid var(--g200);border-radius:6px;font-size:12px;" value="' + m.plocha + '" onchange="updateVytapeniMistnost(' + m.id + ',\'plocha\',this.value)"></div>' +
        '<div><label style="font-size:9px;color:var(--g400);display:block;">Teplota °C</label><input type="number" style="width:100%;padding:6px;border:1px solid var(--g200);border-radius:6px;font-size:12px;" value="' + m.teplota + '" onchange="updateVytapeniMistnost(' + m.id + ',\'teplota\',this.value)"></div>' +
        '<div><label style="font-size:9px;color:var(--g400);display:block;">Typ</label><select style="width:100%;padding:6px;border:1px solid var(--g200);border-radius:6px;font-size:11px;" onchange="updateVytapeniMistnost(' + m.id + ',\'typ\',this.value)">' +
          '<option value="obytna"' + (m.typ === 'obytna' ? ' selected' : '') + '>Obytná</option>' +
          '<option value="kuchyn"' + (m.typ === 'kuchyn' ? ' selected' : '') + '>Kuchyň</option>' +
          '<option value="loznice"' + (m.typ === 'loznice' ? ' selected' : '') + '>Ložnice</option>' +
          '<option value="koupelna"' + (m.typ === 'koupelna' ? ' selected' : '') + '>Koupelna</option>' +
          '<option value="chodba"' + (m.typ === 'chodba' ? ' selected' : '') + '>Chodba</option>' +
        '</select></div>' +
      '</div>' +
    '</div>';
  }).join('');
}

function vypoctiVytapeniZtraty() {
  const venkovni = parseFloat(document.getElementById('vytapeniVenkovni').value) || -15;
  const vnitrni = parseFloat(document.getElementById('vytapeniVnitrni').value) || 20;
  
  let celkem = 0;
  vytapeniMistnosti.forEach(m => {
    const mVnitrni = m.typ === 'koupelna' ? 24 : vnitrni;
    const deltaT = mVnitrni - venkovni;
    celkem += getTepelnaZtrata(m.plocha, m.typ, mVnitrni, deltaT);
  });
  const sRezerva = Math.round(celkem * 1.1);
  document.getElementById('vytapeniPozadovanyVykon').innerHTML = '<span style="font-size:13px;font-weight:600;color:#fff;">Požadovaný výkon (vč. 10% rezervy)</span><span style="font-size:20px;font-weight:700;color:#fff;">' + (sRezerva / 1000).toFixed(2) + ' kW</span>';
  renderVytapeniMistnosti();
  if (vytapeniSystem) vypoctiVytapeniSystem();
}

function selectVytapeniSystem(system) {
  vytapeniSystem = system;
  document.getElementById('btnRadiatory').classList.toggle('active', system === 'radiatory');
  document.getElementById('btnPodlahove').classList.toggle('active', system === 'podlahove');
  document.getElementById('btnInfra').classList.toggle('active', system === 'infra');
  document.getElementById('vytapeniRadiatoryConfig').style.display = system === 'radiatory' ? 'block' : 'none';
  document.getElementById('vytapeniPodlahoveConfig').style.display = system === 'podlahove' ? 'block' : 'none';
  document.getElementById('vytapeniInfraConfig').style.display = system === 'infra' ? 'block' : 'none';
  vypoctiVytapeniSystem();
}

function updateInfraPrice() {
  const sel = document.getElementById('infraModel');
  const opt = sel.options[sel.selectedIndex];
  if (opt.dataset.price) document.getElementById('infraCena').value = opt.dataset.price;
}

function vypoctiVytapeniSystem() {
  if (!vytapeniSystem || vytapeniMistnosti.length === 0) {
    document.getElementById('vytapeniNakupniSeznam').innerHTML = '';
    return;
  }
  
  const venkovni = parseFloat(document.getElementById('vytapeniVenkovni').value) || -15;
  const vnitrni = parseFloat(document.getElementById('vytapeniVnitrni').value) || 20;
  
  let polozky = [];
  let celkem = 0;
  
  if (vytapeniSystem === 'radiatory') {
    const vyska = parseInt(document.getElementById('radiatorVyska').value);
    const typ = document.getElementById('radiatorTyp').value;
    const privod = parseFloat(document.getElementById('radPrivod').value);
    const vrat = parseFloat(document.getElementById('radVrat').value);
    
    const deltaT_std = 49.83;
    const deltaT_actual = (privod - vrat) / Math.log((privod - vnitrni) / (vrat - vnitrni));
    const tempFactor = Math.pow(deltaT_actual / deltaT_std, 1.3);
    const powerPerMeter = { '11': { 300: 298, 400: 397, 500: 497, 600: 596, 900: 894 }, '21s': { 300: 447, 400: 596, 500: 745, 600: 894, 900: 1341 }, '22': { 300: 533, 400: 710, 500: 888, 600: 1065, 900: 1598 }, '33': { 300: 777, 400: 1036, 500: 1295, 600: 1554, 900: 2331 } };
    const basePower = (powerPerMeter[typ] && powerPerMeter[typ][vyska]) || 1065;
    const actualPowerPerMeter = basePower * tempFactor;
    
    vytapeniMistnosti.forEach(m => {
      const mVnitrni = m.typ === 'koupelna' ? 24 : vnitrni;
      const deltaT = mVnitrni - venkovni;
      const potreba = getTepelnaZtrata(m.plocha, m.typ, mVnitrni, deltaT) * 1.1;
      const delka = Math.ceil((potreba / actualPowerPerMeter) * 100) * 10;
      const vykon = Math.round((delka / 1000) * actualPowerPerMeter);
      const cena = Math.round(delka / 100) * 800;
      polozky.push({ nazev: 'Radiátor ' + typ.toUpperCase() + '/' + vyska + ' – ' + delka + 'mm', detail: m.nazev + ' | ' + vykon + ' W', cena });
      celkem += cena;
    });
    
  } else if (vytapeniSystem === 'podlahove') {
    const roztec = parseInt(document.getElementById('podlahaRoztec').value);
    const prumer = document.getElementById('podlahaPrumer').value;
    
    let celkemPotrubi = 0;
    vytapeniMistnosti.forEach(m => {
      const aktivni = m.plocha * 0.85;
      const potrubi = Math.round(aktivni / (roztec / 1000));
      celkemPotrubi += potrubi;
    });
    
    const okruhy = Math.ceil(celkemPotrubi / 100);
    const cenaPotrubi = celkemPotrubi * 25;
    const cenaDeski = vytapeniMistnosti.reduce((s, m) => s + m.plocha, 0) * 180;
    const cenaRozdelovac = okruhy <= 6 ? 4500 : (okruhy <= 9 ? 5800 : 7200);
    const cenaSkrin = 2500;
    
    polozky.push({ nazev: 'Potrubí PE-Xa ' + prumer + '×2 mm', detail: celkemPotrubi + ' m (' + okruhy + ' okruhů)', cena: cenaPotrubi });
    polozky.push({ nazev: 'Systémová deska s výstupky', detail: Math.round(vytapeniMistnosti.reduce((s, m) => s + m.plocha, 0)) + ' m²', cena: cenaDeski });
    polozky.push({ nazev: 'Rozdělovač ' + okruhy + ' okruhů', detail: 'Nerezový s průtokoměry', cena: cenaRozdelovac });
    polozky.push({ nazev: 'Skříň pod omítku', detail: 'Pro rozdělovač', cena: cenaSkrin });
    celkem = cenaPotrubi + cenaDeski + cenaRozdelovac + cenaSkrin;
    
  } else if (vytapeniSystem === 'infra') {
    const model = document.getElementById('infraModel');
    const powerBm = parseInt(model.value);
    const opt = model.options[model.selectedIndex];
    const width = parseInt(opt.dataset.width || 100) / 100;
    const pokryti = parseInt(document.getElementById('infraPokryti').value) / 100;
    const cenaFolieBm = parseFloat(document.getElementById('infraCena').value);
    const termostatCena = parseInt(document.getElementById('infraTermostat').value);
    const termostatNazev = document.getElementById('infraTermostat').options[document.getElementById('infraTermostat').selectedIndex].dataset.name;
    
    let celkemFolie = 0;
    vytapeniMistnosti.forEach(m => {
      const aktivni = m.plocha * pokryti;
      const delka = Math.ceil(aktivni / width);
      const vykon = Math.round(delka * powerBm);
      celkemFolie += delka;
      polozky.push({ nazev: 'Topná fólie – ' + m.nazev, detail: delka + ' bm | ' + vykon + ' W', cena: delka * cenaFolieBm });
      celkem += delka * cenaFolieBm;
    });
    
    const pocetTermostatu = vytapeniMistnosti.length;
    const termostatyCena = pocetTermostatu * termostatCena;
    polozky.push({ nazev: 'Termostat ' + termostatNazev, detail: pocetTermostatu + '× po ' + termostatCena + ' Kč', cena: termostatyCena });
    celkem += termostatyCena;
    
    const sadyCena = pocetTermostatu * 2 * 65;
    polozky.push({ nazev: 'Připojovací sady', detail: (pocetTermostatu * 2) + '× svorky + izolace', cena: sadyCena });
    celkem += sadyCena;
    
    const reflexniCena = Math.round(vytapeniMistnosti.reduce((s, m) => s + m.plocha * pokryti, 0)) * 45;
    polozky.push({ nazev: 'Reflexní podložka', detail: Math.round(vytapeniMistnosti.reduce((s, m) => s + m.plocha * pokryti, 0)) + ' m²', cena: reflexniCena });
    celkem += reflexniCena;
  }
  
  document.getElementById('vytapeniNakupniSeznam').innerHTML = polozky.length ? '<div class="result"><div class="card-title">Nákupní seznam</div>' + polozky.map(p => '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + p.detail + '</div></div><div class="result-item-price">' + formatCena(p.cena) + '</div></div>').join('') + '<div class="result-total"><span class="result-total-label">CELKEM materiál</span><span class="result-total-value">' + formatCena(celkem) + '</span></div></div>' : '';
}

// === VODA A ODPAD ===
const vodaTypyVyvodu = {
  umyvadlo: { nazev: 'Umyvadlo', sv: true, tv: true, dimVoda: '16x2', dimOdpad: 'DN40' },
  wc: { nazev: 'WC', sv: true, tv: false, dimVoda: '16x2', dimOdpad: 'DN110' },
  sprcha: { nazev: 'Sprcha', sv: true, tv: true, dimVoda: '20x2', dimOdpad: 'DN50' },
  vana: { nazev: 'Vana', sv: true, tv: true, dimVoda: '20x2', dimOdpad: 'DN50' },
  drez: { nazev: 'Dřez', sv: true, tv: true, dimVoda: '20x2', dimOdpad: 'DN50' },
  pracka: { nazev: 'Pračka', sv: true, tv: false, dimVoda: '20x2', dimOdpad: 'DN50' },
  mycka: { nazev: 'Myčka', sv: true, tv: false, dimVoda: '16x2', dimOdpad: 'DN50' },
  zahrada: { nazev: 'Zahrada', sv: true, tv: false, dimVoda: '20x2', dimOdpad: null }
};

const vodaAlpex = { '16x2': { cena: 35, izolace: 18 }, '20x2': { cena: 57, izolace: 22 }, '26x3': { cena: 110, izolace: 28 } };
const vodaHT = { DN40: 38, DN50: 48, DN75: 79, DN110: 115 };
const vodaKGCeny = { DN110: 125, DN125: 155, DN160: 195 };
const vodaFitinky = { '16': 85, '20': 95, '26': 125 };
const vodaRozdelovace = { 4: 2850, 5: 3150, 6: 3450, 7: 3750, 8: 4050, 9: 4350, 10: 4650, 11: 4950, 12: 5250 };
const vodaBojlery = { 50: 5500, 80: 6200, 100: 6800, 125: 7500, 160: 8500, 200: 10500 };
const vodaCerpadla = { zadne: 0, 'UP15-14B': 3400, 'UP15-14BA': 5500 };
const vodaDrtice = { zadny: 0, M55: 7500, M65: 9900, M100: 14500, M200: 17800 };

let vodaVyvody = [];
let vodaVyvodId = 0;

function pridatVodaVyvod(typ) {
  const def = vodaTypyVyvodu[typ];
  vodaVyvody.push({ id: vodaVyvodId++, typ, nazev: def.nazev + ' ' + (vodaVyvody.filter(v => v.typ === typ).length + 1), delkaSV: def.sv ? 8 : 0, delkaTV: def.tv ? 8 : 0, delkaOdpad: def.dimOdpad ? 2 : 0 });
  renderVodaVyvody();
  vypoctiVoda();
}

function odebratVodaVyvod(id) {
  vodaVyvody = vodaVyvody.filter(v => v.id !== id);
  renderVodaVyvody();
  vypoctiVoda();
}

function updateVodaVyvod(id, pole, hodnota) {
  const v = vodaVyvody.find(x => x.id === id);
  if (v) { v[pole] = pole === 'nazev' ? hodnota : Math.max(0, parseFloat(hodnota) || 0); vypoctiVoda(); }
}

function renderVodaVyvody() {
  const cont = document.getElementById('vodaVyvodyList');
  if (vodaVyvody.length === 0) {
    cont.innerHTML = '<div style="text-align:center;padding:16px;color:var(--g400);font-size:12px;">Přidejte vývody pomocí tlačítek níže</div>';
    return;
  }
  cont.innerHTML = vodaVyvody.map(v => {
    const def = vodaTypyVyvodu[v.typ];
    return '<div class="vyvod-card ' + (def.tv ? 'sv-tv' : 'sv-only') + '">' +
      '<div class="vyvod-header"><input class="vyvod-name" value="' + v.nazev + '" onchange="updateVodaVyvod(' + v.id + ',\'nazev\',this.value)"><span class="vyvod-typ">' + def.nazev + '</span><button class="mistnost-remove" onclick="odebratVodaVyvod(' + v.id + ')">×</button></div>' +
      '<div class="vyvod-inputs">' +
        '<div class="vyvod-input"><label>SV (m)</label><input type="number" value="' + v.delkaSV + '" ' + (def.sv ? 'onchange="updateVodaVyvod(' + v.id + ',\'delkaSV\',this.value)"' : 'disabled') + '></div>' +
        '<div class="vyvod-input"><label>TV (m)</label><input type="number" value="' + v.delkaTV + '" ' + (def.tv ? 'onchange="updateVodaVyvod(' + v.id + ',\'delkaTV\',this.value)"' : 'disabled') + '></div>' +
        '<div class="vyvod-input"><label>Odpad (m)</label><input type="number" value="' + v.delkaOdpad + '" ' + (def.dimOdpad ? 'onchange="updateVodaVyvod(' + v.id + ',\'delkaOdpad\',this.value)"' : 'disabled') + '></div>' +
      '</div>' +
    '</div>';
  }).join('');
}

function toggleVodaCirculace() {
  const cerp = document.getElementById('vodaCerpadlo').value;
  document.getElementById('vodaCirculaceRow').style.display = cerp === 'zadne' ? 'none' : 'block';
}

function vypoctiVoda() {
  if (vodaVyvody.length === 0) {
    document.getElementById('vodaSumVoda').textContent = '0 Kč';
    document.getElementById('vodaSumOdpad').textContent = '0 Kč';
    document.getElementById('vodaSumCelkem').textContent = '0 Kč';
    document.getElementById('vodaNakupniSeznam').innerHTML = '';
    return;
  }
  
  let polozkyVoda = [], polozkyOdpad = [];
  let cenaVoda = 0, cenaOdpad = 0;
  
  // Součty potrubí
  const souctyVoda = { '16x2': { sv: 0, tv: 0 }, '20x2': { sv: 0, tv: 0 } };
  const souctyOdpad = { DN40: 0, DN50: 0, DN110: 0 };
  let pocetSV = 0, pocetTV = 0;
  
  vodaVyvody.forEach(v => {
    const def = vodaTypyVyvodu[v.typ];
    if (def.sv && v.delkaSV > 0) { souctyVoda[def.dimVoda].sv += v.delkaSV; pocetSV++; }
    if (def.tv && v.delkaTV > 0) { souctyVoda[def.dimVoda].tv += v.delkaTV; pocetTV++; }
    if (def.dimOdpad && v.delkaOdpad > 0) { souctyOdpad[def.dimOdpad] += v.delkaOdpad; }
  });
  
  // Rozdělovače
  if (pocetSV > 0) {
    const vel = Math.min(Math.max(pocetSV, 4), 12);
    const c = vodaRozdelovace[vel];
    polozkyVoda.push({ nazev: 'Rozdělovač SV ' + vel + '× (DEK nerez)', detail: '1 ks', cena: c });
    cenaVoda += c;
  }
  if (pocetTV > 0) {
    const vel = Math.min(Math.max(pocetTV, 4), 12);
    const c = vodaRozdelovace[vel];
    polozkyVoda.push({ nazev: 'Rozdělovač TV ' + vel + '× (DEK nerez)', detail: '1 ks', cena: c });
    cenaVoda += c;
  }
  
  // Potrubí ALPEX
  Object.entries(souctyVoda).forEach(([dim, d]) => {
    const t = vodaAlpex[dim];
    if (d.sv > 0) {
      const c = Math.ceil(d.sv) * (t.cena + t.izolace);
      polozkyVoda.push({ nazev: 'ALPEX ' + dim + ' + izolace (SV)', detail: Math.ceil(d.sv) + ' m', cena: c });
      cenaVoda += c;
    }
    if (d.tv > 0) {
      const c = Math.ceil(d.tv) * (t.cena + t.izolace);
      polozkyVoda.push({ nazev: 'ALPEX ' + dim + ' + izolace (TV)', detail: Math.ceil(d.tv) + ' m', cena: c });
      cenaVoda += c;
    }
  });
  
  // Přívody
  const privodSV = parseFloat(document.getElementById('vodaPrivodSV').value) || 0;
  const privodTV = parseFloat(document.getElementById('vodaPrivodTV').value) || 0;
  const t26 = vodaAlpex['26x3'];
  if (privodSV > 0) {
    const c = privodSV * (t26.cena + t26.izolace);
    polozkyVoda.push({ nazev: 'ALPEX 26×3 + izo (přívod SV)', detail: privodSV + ' m', cena: c });
    cenaVoda += c;
  }
  if (privodTV > 0) {
    const c = privodTV * (t26.cena + t26.izolace);
    polozkyVoda.push({ nazev: 'ALPEX 26×3 + izo (přívod TV)', detail: privodTV + ' m', cena: c });
    cenaVoda += c;
  }
  
  // Fitinky
  const f16 = vodaVyvody.filter(v => vodaTypyVyvodu[v.typ].dimVoda === '16x2' && (v.delkaSV > 0 || v.delkaTV > 0)).length * 2;
  const f20 = vodaVyvody.filter(v => vodaTypyVyvodu[v.typ].dimVoda === '20x2' && (v.delkaSV > 0 || v.delkaTV > 0)).length * 2;
  if (f16 > 0) { polozkyVoda.push({ nazev: 'Press fitink 16', detail: f16 + ' ks', cena: f16 * vodaFitinky['16'] }); cenaVoda += f16 * vodaFitinky['16']; }
  if (f20 > 0) { polozkyVoda.push({ nazev: 'Press fitink 20', detail: f20 + ' ks', cena: f20 * vodaFitinky['20'] }); cenaVoda += f20 * vodaFitinky['20']; }
  polozkyVoda.push({ nazev: 'Press fitink 26 (přívody)', detail: '4 ks', cena: 4 * vodaFitinky['26'] }); cenaVoda += 4 * vodaFitinky['26'];
  
  // Bojler
  const bojlerLitru = parseInt(document.getElementById('vodaBojler').value);
  const bojlerCena = vodaBojlery[bojlerLitru];
  polozkyVoda.push({ nazev: 'Dražice OKCE ' + bojlerLitru, detail: '1 ks', cena: bojlerCena }); cenaVoda += bojlerCena;
  
  // Cirkulace
  const cerpadloTyp = document.getElementById('vodaCerpadlo').value;
  const cerpadloCena = vodaCerpadla[cerpadloTyp];
  if (cerpadloCena > 0) {
    polozkyVoda.push({ nazev: 'Grundfos ' + cerpadloTyp, detail: '1 ks', cena: cerpadloCena }); cenaVoda += cerpadloCena;
    const circDel = parseFloat(document.getElementById('vodaCirculace').value) || 0;
    if (circDel > 0) {
      const c = circDel * (vodaAlpex['16x2'].cena + vodaAlpex['16x2'].izolace);
      polozkyVoda.push({ nazev: 'ALPEX 16×2 + izo (cirkulace)', detail: circDel + ' m', cena: c }); cenaVoda += c;
    }
  }
  
  // Příslušenství voda
  [{ n: 'Pojistný ventil', c: 450 }, { n: 'Expanzka 8l', c: 850 }, { n: 'Vodoměr + kohouty', c: 1200 }, { n: 'Filtr', c: 650 }, { n: 'Redukční ventil', c: 1100 }, { n: 'Skříně rozdělovačů 2×', c: 3700 }].forEach(p => {
    polozkyVoda.push({ nazev: p.n, detail: '1 ks', cena: p.c }); cenaVoda += p.c;
  });
  
  // ODPAD - přípojky
  Object.entries(souctyOdpad).forEach(([dn, del]) => {
    if (del > 0) {
      const c = Math.ceil(del) * vodaHT[dn];
      polozkyOdpad.push({ nazev: 'HT ' + dn + ' (přípojky)', detail: Math.ceil(del) + ' m', cena: c }); cenaOdpad += c;
    }
  });
  
  // Ležatá
  const ht75 = parseFloat(document.getElementById('vodaHT75').value) || 0;
  const ht110 = parseFloat(document.getElementById('vodaHT110').value) || 0;
  if (ht75 > 0) { polozkyOdpad.push({ nazev: 'HT DN75 (ležatá)', detail: ht75 + ' m', cena: ht75 * vodaHT.DN75 }); cenaOdpad += ht75 * vodaHT.DN75; }
  if (ht110 > 0) { polozkyOdpad.push({ nazev: 'HT DN110 (ležatá)', detail: ht110 + ' m', cena: ht110 * vodaHT.DN110 }); cenaOdpad += ht110 * vodaHT.DN110; }
  
  // Tvarovky HT
  const pocetPrip = vodaVyvody.filter(v => vodaTypyVyvodu[v.typ].dimOdpad && v.delkaOdpad > 0).length;
  const pocetWC = vodaVyvody.filter(v => v.typ === 'wc' && v.delkaOdpad > 0).length;
  const cistici = parseInt(document.getElementById('vodaCistici').value) || 0;
  const vetrani = parseInt(document.getElementById('vodaVetrani').value) || 0;
  
  let tvarovkyCena = 0;
  tvarovkyCena += Math.ceil(pocetPrip * 0.5) * 38; // kolena DN50
  tvarovkyCena += Math.ceil(ht110 / 3) * 62; // kolena 87 DN110
  tvarovkyCena += Math.ceil(ht110 / 4) * 55; // kolena 45 DN110
  tvarovkyCena += Math.ceil(pocetPrip * 0.4) * 72; // odbočky DN75/50
  tvarovkyCena += Math.ceil(pocetPrip * 0.3) * 82; // odbočky DN110/50
  tvarovkyCena += pocetWC * 98; // odbočky DN110/110
  if (ht75 > 0) tvarovkyCena += 2 * 62; // redukce
  tvarovkyCena += cistici * 195;
  tvarovkyCena += vetrani * 285;
  
  polozkyOdpad.push({ nazev: 'HT tvarovky (odhad)', detail: 'kolena, odbočky, redukce', cena: tvarovkyCena }); cenaOdpad += tvarovkyCena;
  
  // Venkovní KG
  const kgDel = parseFloat(document.getElementById('vodaKG').value) || 0;
  const kgDim = document.getElementById('vodaKGDim').value;
  const sachty = parseInt(document.getElementById('vodaSachty').value) || 0;
  
  if (kgDel > 0) {
    const c = kgDel * vodaKGCeny[kgDim];
    polozkyOdpad.push({ nazev: 'KG ' + kgDim + ' (venkovní)', detail: kgDel + ' m', cena: c }); cenaOdpad += c;
    const kgTvar = Math.ceil(kgDel / 6) * 2 * 95;
    polozkyOdpad.push({ nazev: 'KG tvarovky (odhad)', detail: Math.ceil(kgDel / 6) * 2 + ' ks', cena: kgTvar }); cenaOdpad += kgTvar;
  }
  if (sachty > 0) { polozkyOdpad.push({ nazev: 'Revizní šachta DN400', detail: sachty + ' ks', cena: sachty * 2500 }); cenaOdpad += sachty * 2500; }
  
  // Drtič
  const drticTyp = document.getElementById('vodaDrtic').value;
  const drticCena = vodaDrtice[drticTyp];
  if (drticCena > 0) { polozkyOdpad.push({ nazev: 'InSinkErator ' + drticTyp, detail: '1 ks', cena: drticCena }); cenaOdpad += drticCena; }
  
  // Souhrn
  document.getElementById('vodaSumVoda').textContent = formatCena(Math.round(cenaVoda));
  document.getElementById('vodaSumOdpad').textContent = formatCena(Math.round(cenaOdpad));
  document.getElementById('vodaSumCelkem').textContent = formatCena(Math.round(cenaVoda + cenaOdpad));
  
  // Nákupní seznam
  const vsechnyPolozky = [...polozkyVoda.map(p => ({...p, sekce: 'voda'})), ...polozkyOdpad.map(p => ({...p, sekce: 'odpad'}))];
  
  let html = '<div class="result"><div class="card-title">Nákupní seznam - Voda</div>';
  html += polozkyVoda.map(p => '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + p.detail + '</div></div><div class="result-item-price" style="color:#3b82f6;">' + formatCena(p.cena) + '</div></div>').join('');
  html += '<div class="result-total" style="background:linear-gradient(135deg, #3b82f6, #1d4ed8);"><span class="result-total-label">Voda celkem</span><span class="result-total-value">' + formatCena(Math.round(cenaVoda)) + '</span></div></div>';
  
  html += '<div class="result" style="margin-top:12px;"><div class="card-title">Nákupní seznam - Odpad</div>';
  html += polozkyOdpad.map(p => '<div class="result-item"><div class="result-item-info"><div class="result-item-name">' + p.nazev + '</div><div class="result-item-detail">' + p.detail + '</div></div><div class="result-item-price" style="color:#f59e0b;">' + formatCena(p.cena) + '</div></div>').join('');
  html += '<div class="result-total" style="background:linear-gradient(135deg, #f59e0b, #d97706);"><span class="result-total-label">Odpad celkem</span><span class="result-total-value">' + formatCena(Math.round(cenaOdpad)) + '</span></div></div>';
  
  document.getElementById('vodaNakupniSeznam').innerHTML = html;
}

// === KLIMATIZACE ===
const klimaJednotkyLG = [
  { name: 'LG Standard S09EC', power: 2.5, seer: 6.1, scop: 4.0, price: 22000, series: 'Standard' },
  { name: 'LG Standard S12EC', power: 3.5, seer: 6.1, scop: 4.0, price: 25000, series: 'Standard' },
  { name: 'LG Standard S18EC', power: 5.0, seer: 6.1, scop: 4.0, price: 32000, series: 'Standard' },
  { name: 'LG Standard S24EC', power: 6.6, seer: 6.1, scop: 4.0, price: 38000, series: 'Standard' },
  { name: 'LG Standard Plus PC09SC', power: 2.5, seer: 6.6, scop: 4.0, price: 27000, series: 'Standard Plus' },
  { name: 'LG Standard Plus PC12SC', power: 3.5, seer: 6.6, scop: 4.0, price: 29000, series: 'Standard Plus' },
  { name: 'LG Artcool Mirror AC09BK', power: 2.5, seer: 7.0, scop: 4.0, price: 35000, series: 'Artcool Mirror' },
  { name: 'LG Artcool Mirror AC12BK', power: 3.5, seer: 6.6, scop: 4.0, price: 38000, series: 'Artcool Mirror' },
  { name: 'LG Deluxe DC09RK', power: 2.5, seer: 7.0, scop: 4.6, price: 33000, series: 'Deluxe' },
  { name: 'LG Deluxe DC12RK', power: 3.5, seer: 7.0, scop: 4.6, price: 36000, series: 'Deluxe' },
];

let klimaMistnosti = [];
let klimaMistnostId = 0;
let klimaOrient = 'S';

function pridatKlimaMistnost() {
  klimaMistnosti.push({ id: klimaMistnostId++, nazev: 'Místnost ' + (klimaMistnosti.length + 1), plocha: 20, vyska: 2.7 });
  renderKlimaMistnosti();
  vypoctiKlima();
}

function odebratKlimaMistnost(id) {
  klimaMistnosti = klimaMistnosti.filter(m => m.id !== id);
  renderKlimaMistnosti();
  vypoctiKlima();
}

function updateKlimaMistnost(id, pole, hodnota) {
  const m = klimaMistnosti.find(x => x.id === id);
  if (m) { m[pole] = pole === 'nazev' ? hodnota : parseFloat(hodnota) || 0; vypoctiKlima(); }
}

function setKlimaOrient(dir) {
  klimaOrient = dir;
  document.querySelectorAll('.klima-orient').forEach(btn => btn.classList.toggle('active', btn.dataset.dir === dir));
  vypoctiKlima();
}

function renderKlimaMistnosti() {
  const cont = document.getElementById('klimaMistnostiList');
  if (klimaMistnosti.length === 0) {
    cont.innerHTML = '<div style="text-align:center;padding:16px;color:var(--g400);font-size:12px;">Přidejte místnosti pro chlazení</div>';
    return;
  }
  cont.innerHTML = klimaMistnosti.map(m => 
    '<div class="klima-mistnost">' +
      '<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">' +
        '<input style="border:none;background:transparent;font-weight:500;font-size:12px;flex:1;" value="' + m.nazev + '" onchange="updateKlimaMistnost(' + m.id + ',\'nazev\',this.value)">' +
        '<span style="font-weight:600;color:#06b6d4;font-size:12px;margin-right:8px;" id="klimaZatez' + m.id + '">0 W</span>' +
        '<button class="mistnost-remove" onclick="odebratKlimaMistnost(' + m.id + ')">×</button>' +
      '</div>' +
      '<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">' +
        '<div><label style="font-size:9px;color:var(--g400);">Plocha m²</label><input type="number" style="width:100%;padding:6px;border:1px solid var(--g200);border-radius:6px;font-size:12px;" value="' + m.plocha + '" onchange="updateKlimaMistnost(' + m.id + ',\'plocha\',this.value)"></div>' +
        '<div><label style="font-size:9px;color:var(--g400);">Výška m</label><input type="number" style="width:100%;padding:6px;border:1px solid var(--g200);border-radius:6px;font-size:12px;" value="' + m.vyska + '" step="0.1" onchange="updateKlimaMistnost(' + m.id + ',\'vyska\',this.value)"></div>' +
      '</div>' +
    '</div>'
  ).join('');
}

function vypoctiKlima() {
  if (klimaMistnosti.length === 0) {
    document.getElementById('klimaSumVykon').textContent = '0 kW';
    document.getElementById('klimaSumNaklady').textContent = '0 Kč';
    document.getElementById('klimaJednotky').innerHTML = '<div style="text-align:center;padding:16px;color:var(--g400);font-size:12px;">Přidejte místnosti</div>';
    return;
  }
  
  const venkovni = parseFloat(document.getElementById('klimaVenkovni').value) || 32;
  const vnitrni = parseFloat(document.getElementById('klimaVnitrni').value) || 24;
  const okna = parseFloat(document.getElementById('klimaOkna').value) || 8;
  const zaskleni = parseFloat(document.getElementById('klimaZaskleni').value) || 0.65;
  const stineni = parseFloat(document.getElementById('klimaStineni').value) || 0.7;
  const osoby = parseFloat(document.getElementById('klimaOsoby').value) || 4;
  const cenaEl = parseFloat(document.getElementById('klimaCenaEl').value) || 4.5;
  const hodiny = parseFloat(document.getElementById('klimaHodiny').value) || 600;
  
  const solarRadiation = { N: 150, E: 450, S: 350, W: 500 };
  const totalPlocha = klimaMistnosti.reduce((s, m) => s + m.plocha, 0);
  
  let totalZatez = 0;
  klimaMistnosti.forEach(m => {
    const roomOkna = okna * (m.plocha / totalPlocha);
    const solarGain = roomOkna * solarRadiation[klimaOrient] * zaskleni * stineni;
    const transmissionGain = m.plocha * 1.5 * (venkovni - vnitrni);
    const internalGains = (osoby * (m.plocha / totalPlocha)) * 100 + 10 * m.plocha;
    const ventilationGain = m.plocha * m.vyska * 0.5 * 0.34 * (venkovni - vnitrni);
    m.zatez = Math.round(solarGain + transmissionGain + internalGains + ventilationGain);
    totalZatez += m.zatez;
    const el = document.getElementById('klimaZatez' + m.id);
    if (el) el.textContent = m.zatez + ' W';
  });
  
  const totalKw = totalZatez / 1000;
  const vhodne = klimaJednotkyLG.filter(u => u.power >= totalKw * 0.85).sort((a, b) => a.power - b.power).slice(0, 3);
  const seer = vhodne.length > 0 ? vhodne[0].seer : 6.1;
  const prikon = totalKw / seer;
  const spotrebaRok = prikon * hodiny * 0.6;
  const nakladyRok = Math.round(spotrebaRok * cenaEl);
  
  document.getElementById('klimaSumVykon').textContent = totalKw.toFixed(2) + ' kW';
  document.getElementById('klimaSumNaklady').textContent = formatCena(nakladyRok) + '/rok';
  
  document.getElementById('klimaJednotky').innerHTML = vhodne.map((u, i) => 
    '<div class="klima-jednotka' + (i === 0 ? ' doporucena' : '') + '">' +
      '<div class="klima-jednotka-header">' +
        '<span class="klima-jednotka-name">' + u.name + '</span>' +
        (i === 0 ? '<span class="klima-jednotka-badge">Doporučeno</span>' : '') +
      '</div>' +
      '<div style="font-size:9px;color:var(--g400);margin-bottom:6px;">Řada: ' + u.series + '</div>' +
      '<div class="klima-jednotka-specs">' +
        '<div class="klima-spec"><div class="klima-spec-label">Chlazení</div><div class="klima-spec-value">' + u.power + ' kW</div></div>' +
        '<div class="klima-spec"><div class="klima-spec-label">SEER</div><div class="klima-spec-value">' + u.seer + '</div></div>' +
        '<div class="klima-spec"><div class="klima-spec-label">SCOP</div><div class="klima-spec-value">' + u.scop + '</div></div>' +
      '</div>' +
      '<div class="klima-jednotka-cena">od ' + (u.price/1000).toFixed(0) + ' 000 Kč</div>' +
    '</div>'
  ).join('');
}
</script>
</body>
</html>